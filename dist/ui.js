(()=>{var Gi=Object.create,ln=Object.defineProperty,Vi=Object.getPrototypeOf,Yi=Object.prototype.hasOwnProperty,Wi=Object.getOwnPropertyNames,Ki=Object.getOwnPropertyDescriptor;var Ji=t=>ln(t,"__esModule",{value:!0});var ot=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Xi=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Wi(e))!Yi.call(t,r)&&r!=="default"&&ln(t,r,{get:()=>e[r],enumerable:!(n=Ki(e,r))||n.enumerable});return t},qt=t=>Xi(Ji(ln(t!=null?Gi(Vi(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Kt=ot((fc,lr)=>{"use strict";function re(t,e,n,r,i,a){return{tag:t,key:e,attrs:n,children:r,text:i,dom:a,domSize:void 0,state:void 0,events:void 0,instance:void 0}}re.normalize=function(t){return Array.isArray(t)?re("[",void 0,void 0,re.normalizeChildren(t),void 0,void 0):t==null||typeof t=="boolean"?null:typeof t=="object"?t:re("#",void 0,void 0,String(t),void 0,void 0)};re.normalizeChildren=function(t){var e=[];if(t.length){for(var n=t[0]!=null&&t[0].key!=null,r=1;r<t.length;r++)if((t[r]!=null&&t[r].key!=null)!==n)throw new TypeError("Vnodes must either always have keys or never have keys!");for(var r=0;r<t.length;r++)e[r]=re.normalize(t[r])}return e};lr.exports=re});var pn=ot((lc,pr)=>{"use strict";var Qi=Kt();pr.exports=function(){var t=arguments[this],e=this+1,n;if(t==null?t={}:(typeof t!="object"||t.tag!=null||Array.isArray(t))&&(t={},e=this),arguments.length===e+1)n=arguments[e],Array.isArray(n)||(n=[n]);else for(n=[];e<arguments.length;)n.push(arguments[e++]);return Qi("",t.key,t,n)}});var dn=ot((pc,dr)=>{"use strict";var mr=Kt(),Zi=pn(),ts=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,hr={},le={}.hasOwnProperty;function gr(t){for(var e in t)if(le.call(t,e))return!1;return!0}function es(t){for(var e,n="div",r=[],i={};e=ts.exec(t);){var a=e[1],c=e[2];if(a===""&&c!=="")n=c;else if(a==="#")i.id=c;else if(a===".")r.push(c);else if(e[3][0]==="["){var u=e[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),e[4]==="class"?r.push(u):i[e[4]]=u===""?u:u||!0}}return r.length>0&&(i.className=r.join(" ")),hr[t]={tag:n,attrs:i}}function ns(t,e){var n=e.attrs,r=mr.normalizeChildren(e.children),i=le.call(n,"class"),a=i?n.class:n.className;if(e.tag=t.tag,e.attrs=null,e.children=void 0,!gr(t.attrs)&&!gr(n)){var c={};for(var u in n)le.call(n,u)&&(c[u]=n[u]);n=c}for(var u in t.attrs)le.call(t.attrs,u)&&u!=="className"&&!le.call(n,u)&&(n[u]=t.attrs[u]);(a!=null||t.attrs.className!=null)&&(n.className=a!=null?t.attrs.className!=null?String(t.attrs.className)+" "+String(a):a:t.attrs.className!=null?t.attrs.className:null),i&&(n.class=null);for(var u in n)if(le.call(n,u)&&u!=="key"){e.attrs=n;break}return Array.isArray(r)&&r.length===1&&r[0]!=null&&r[0].tag==="#"?e.text=r[0].children:e.children=r,e}function rs(t){if(t==null||typeof t!="string"&&typeof t!="function"&&typeof t.view!="function")throw Error("The selector must be either a string or a component.");var e=Zi.apply(1,arguments);return typeof t=="string"&&(e.children=mr.normalizeChildren(e.children),t!=="[")?ns(hr[t]||es(t),e):(e.tag=t,e)}dr.exports=rs});var Er=ot((dc,yr)=>{"use strict";var os=Kt();yr.exports=function(t){return t==null&&(t=""),os("<",void 0,void 0,t,void 0,void 0)}});var Sr=ot((mc,br)=>{"use strict";var is=Kt(),ss=pn();br.exports=function(){var t=ss.apply(0,arguments);return t.tag="[",t.children=is.normalizeChildren(t.children),t}});var wr=ot((hc,Tr)=>{"use strict";var mn=dn();mn.trust=Er();mn.fragment=Sr();Tr.exports=mn});var hn=ot((gc,vr)=>{"use strict";var wt=function(t){if(!(this instanceof wt))throw new Error("Promise must be called with `new`");if(typeof t!="function")throw new TypeError("executor must be a function");var e=this,n=[],r=[],i=l(n,!0),a=l(r,!1),c=e._instance={resolvers:n,rejectors:r},u=typeof setImmediate=="function"?setImmediate:setTimeout;function l(d,m){return function g(y){var b;try{if(m&&y!=null&&(typeof y=="object"||typeof y=="function")&&typeof(b=y.then)=="function"){if(y===e)throw new TypeError("Promise can't be resolved w/ itself");p(b.bind(y))}else u(function(){!m&&d.length===0&&console.error("Possible unhandled promise rejection:",y);for(var S=0;S<d.length;S++)d[S](y);n.length=0,r.length=0,c.state=m,c.retry=function(){g(y)}})}catch(S){a(S)}}}function p(d){var m=0;function g(b){return function(S){m++>0||b(S)}}var y=g(a);try{d(g(i),y)}catch(b){y(b)}}p(t)};wt.prototype.then=function(t,e){var n=this,r=n._instance;function i(l,p,d,m){p.push(function(g){if(typeof l!="function")d(g);else try{a(l(g))}catch(y){c&&c(y)}}),typeof r.retry=="function"&&m===r.state&&r.retry()}var a,c,u=new wt(function(l,p){a=l,c=p});return i(t,r.resolvers,a,!0),i(e,r.rejectors,c,!1),u};wt.prototype.catch=function(t){return this.then(null,t)};wt.prototype.finally=function(t){return this.then(function(e){return wt.resolve(t()).then(function(){return e})},function(e){return wt.resolve(t()).then(function(){return wt.reject(e)})})};wt.resolve=function(t){return t instanceof wt?t:new wt(function(e){e(t)})};wt.reject=function(t){return new wt(function(e,n){n(t)})};wt.all=function(t){return new wt(function(e,n){var r=t.length,i=0,a=[];if(t.length===0)e([]);else for(var c=0;c<t.length;c++)(function(u){function l(p){i++,a[u]=p,i===r&&e(a)}t[u]!=null&&(typeof t[u]=="object"||typeof t[u]=="function")&&typeof t[u].then=="function"?t[u].then(l,n):l(t[u])})(c)})};wt.race=function(t){return new wt(function(e,n){for(var r=0;r<t.length;r++)t[r].then(e,n)})};vr.exports=wt});var gn=ot((yc,Be)=>{"use strict";var Te=hn();typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=Te:window.Promise.prototype.finally||(window.Promise.prototype.finally=Te.prototype.finally),Be.exports=window.Promise):typeof global!="undefined"?(typeof global.Promise=="undefined"?global.Promise=Te:global.Promise.prototype.finally||(global.Promise.prototype.finally=Te.prototype.finally),Be.exports=global.Promise):Be.exports=Te});var Ar=ot((Ec,Nr)=>{"use strict";var pe=Kt();Nr.exports=function(t){var e=t&&t.document,n,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(s){return s.attrs&&s.attrs.xmlns||r[s.tag]}function a(s,o){if(s.state!==o)throw new Error("`vnode.state` must not be modified")}function c(s){var o=s.state;try{return this.apply(o,arguments)}finally{a(s,o)}}function u(){try{return e.activeElement}catch(s){return null}}function l(s,o,f,h,E,w,$){for(var q=f;q<h;q++){var I=o[q];I!=null&&p(s,I,E,$,w)}}function p(s,o,f,h,E){var w=o.tag;if(typeof w=="string")switch(o.state={},o.attrs!=null&&R(o.attrs,o,f),w){case"#":d(s,o,E);break;case"<":g(s,o,h,E);break;case"[":y(s,o,f,h,E);break;default:b(s,o,f,h,E)}else T(s,o,f,h,E)}function d(s,o,f){o.dom=e.createTextNode(o.children),ut(s,o.dom,f)}var m={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function g(s,o,f,h){var E=o.children.match(/^\s*?<(\w+)/im)||[],w=e.createElement(m[E[1]]||"div");f==="http://www.w3.org/2000/svg"?(w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+o.children+"</svg>",w=w.firstChild):w.innerHTML=o.children,o.dom=w.firstChild,o.domSize=w.childNodes.length,o.instance=[];for(var $=e.createDocumentFragment(),q;q=w.firstChild;)o.instance.push(q),$.appendChild(q);ut(s,$,h)}function y(s,o,f,h,E){var w=e.createDocumentFragment();if(o.children!=null){var $=o.children;l(w,$,0,$.length,f,null,h)}o.dom=w.firstChild,o.domSize=w.childNodes.length,ut(s,w,E)}function b(s,o,f,h,E){var w=o.tag,$=o.attrs,q=$&&$.is;h=i(o)||h;var I=h?q?e.createElementNS(h,w,{is:q}):e.createElementNS(h,w):q?e.createElement(w,{is:q}):e.createElement(w);if(o.dom=I,$!=null&&Et(o,$,h),ut(s,I,E),!nt(o)&&(o.text!=null&&(o.text!==""?I.textContent=o.text:o.children=[pe("#",void 0,void 0,o.text,void 0,void 0)]),o.children!=null)){var F=o.children;l(I,F,0,F.length,f,null,h),o.tag==="select"&&$!=null&&Ht(o,$)}}function S(s,o){var f;if(typeof s.tag.view=="function"){if(s.state=Object.create(s.tag),f=s.state.view,f.$$reentrantLock$$!=null)return;f.$$reentrantLock$$=!0}else{if(s.state=void 0,f=s.tag,f.$$reentrantLock$$!=null)return;f.$$reentrantLock$$=!0,s.state=s.tag.prototype!=null&&typeof s.tag.prototype.view=="function"?new s.tag(s):s.tag(s)}if(R(s.state,s,o),s.attrs!=null&&R(s.attrs,s,o),s.instance=pe.normalize(c.call(s.state.view,s)),s.instance===s)throw Error("A view cannot return the vnode it received as argument");f.$$reentrantLock$$=null}function T(s,o,f,h,E){S(o,f),o.instance!=null?(p(s,o.instance,f,h,E),o.dom=o.instance.dom,o.domSize=o.dom!=null?o.instance.domSize:0):o.domSize=0}function N(s,o,f,h,E,w){if(!(o===f||o==null&&f==null))if(o==null||o.length===0)l(s,f,0,f.length,h,E,w);else if(f==null||f.length===0)P(s,o,0,o.length);else{var $=o[0]!=null&&o[0].key!=null,q=f[0]!=null&&f[0].key!=null,I=0,F=0;if(!$)for(;F<o.length&&o[F]==null;)F++;if(!q)for(;I<f.length&&f[I]==null;)I++;if(q===null&&$==null)return;if($!==q)P(s,o,F,o.length),l(s,f,I,f.length,h,E,w);else if(q){for(var Z=o.length-1,at=f.length-1,Gt,vt,ht,It,lt,sn;Z>=F&&at>=I&&(It=o[Z],lt=f[at],It.key===lt.key);)It!==lt&&M(s,It,lt,h,E,w),lt.dom!=null&&(E=lt.dom),Z--,at--;for(;Z>=F&&at>=I&&(vt=o[F],ht=f[I],vt.key===ht.key);)F++,I++,vt!==ht&&M(s,vt,ht,h,K(o,F,E),w);for(;Z>=F&&at>=I&&!(I===at||vt.key!==lt.key||It.key!==ht.key);)sn=K(o,F,E),J(s,It,sn),It!==ht&&M(s,It,ht,h,sn,w),++I<=--at&&J(s,vt,E),vt!==lt&&M(s,vt,lt,h,E,w),lt.dom!=null&&(E=lt.dom),F++,Z--,It=o[Z],lt=f[at],vt=o[F],ht=f[I];for(;Z>=F&&at>=I&&It.key===lt.key;)It!==lt&&M(s,It,lt,h,E,w),lt.dom!=null&&(E=lt.dom),Z--,at--,It=o[Z],lt=f[at];if(I>at)P(s,o,F,Z+1);else if(F>Z)l(s,f,I,at+1,h,E,w);else{var Hi=E,fr=at-I+1,Se=new Array(fr),an=0,mt=0,cn=2147483647,un=0,Gt,fn;for(mt=0;mt<fr;mt++)Se[mt]=-1;for(mt=at;mt>=I;mt--){Gt==null&&(Gt=Y(o,F,Z+1)),lt=f[mt];var fe=Gt[lt.key];fe!=null&&(cn=fe<cn?fe:-1,Se[mt-I]=fe,It=o[fe],o[fe]=null,It!==lt&&M(s,It,lt,h,E,w),lt.dom!=null&&(E=lt.dom),un++)}if(E=Hi,un!==Z-F+1&&P(s,o,F,Z+1),un===0)l(s,f,I,at+1,h,E,w);else if(cn===-1)for(fn=W(Se),an=fn.length-1,mt=at;mt>=I;mt--)ht=f[mt],Se[mt-I]===-1?p(s,ht,h,w,E):fn[an]===mt-I?an--:J(s,ht,E),ht.dom!=null&&(E=f[mt].dom);else for(mt=at;mt>=I;mt--)ht=f[mt],Se[mt-I]===-1&&p(s,ht,h,w,E),ht.dom!=null&&(E=f[mt].dom)}}else{var Pt=o.length<f.length?o.length:f.length;for(I=I<F?I:F;I<Pt;I++)vt=o[I],ht=f[I],!(vt===ht||vt==null&&ht==null)&&(vt==null?p(s,ht,h,w,K(o,I+1,E)):ht==null?X(s,vt):M(s,vt,ht,h,K(o,I+1,E),w));o.length>Pt&&P(s,o,I,o.length),f.length>Pt&&l(s,f,I,f.length,h,E,w)}}}function M(s,o,f,h,E,w){var $=o.tag,q=f.tag;if($===q){if(f.state=o.state,f.events=o.events,_(f,o))return;if(typeof $=="string")switch(f.attrs!=null&&B(f.attrs,f,h),$){case"#":V(o,f);break;case"<":Q(s,o,f,w,E);break;case"[":j(s,o,f,h,E,w);break;default:k(o,f,h,w)}else H(s,o,f,h,E,w)}else X(s,o),p(s,f,h,w,E)}function V(s,o){s.children.toString()!==o.children.toString()&&(s.dom.nodeValue=o.children),o.dom=s.dom}function Q(s,o,f,h,E){o.children!==f.children?(tt(s,o),g(s,f,h,E)):(f.dom=o.dom,f.domSize=o.domSize,f.instance=o.instance)}function j(s,o,f,h,E,w){N(s,o.children,f.children,h,E,w);var $=0,q=f.children;if(f.dom=null,q!=null){for(var I=0;I<q.length;I++){var F=q[I];F!=null&&F.dom!=null&&(f.dom==null&&(f.dom=F.dom),$+=F.domSize||1)}$!==1&&(f.domSize=$)}}function k(s,o,f,h){var E=o.dom=s.dom;h=i(o)||h,o.tag==="textarea"&&(o.attrs==null&&(o.attrs={}),o.text!=null&&(o.attrs.value=o.text,o.text=void 0)),ne(o,s.attrs,o.attrs,h),nt(o)||(s.text!=null&&o.text!=null&&o.text!==""?s.text.toString()!==o.text.toString()&&(s.dom.firstChild.nodeValue=o.text):(s.text!=null&&(s.children=[pe("#",void 0,void 0,s.text,void 0,s.dom.firstChild)]),o.text!=null&&(o.children=[pe("#",void 0,void 0,o.text,void 0,void 0)]),N(E,s.children,o.children,f,null,h)))}function H(s,o,f,h,E,w){if(f.instance=pe.normalize(c.call(f.state.view,f)),f.instance===f)throw Error("A view cannot return the vnode it received as argument");B(f.state,f,h),f.attrs!=null&&B(f.attrs,f,h),f.instance!=null?(o.instance==null?p(s,f.instance,h,w,E):M(s,o.instance,f.instance,h,E,w),f.dom=f.instance.dom,f.domSize=f.instance.domSize):o.instance!=null?(X(s,o.instance),f.dom=void 0,f.domSize=0):(f.dom=o.dom,f.domSize=o.domSize)}function Y(s,o,f){for(var h=Object.create(null);o<f;o++){var E=s[o];if(E!=null){var w=E.key;w!=null&&(h[w]=o)}}return h}var L=[];function W(s){for(var o=[0],f=0,h=0,E=0,w=L.length=s.length,E=0;E<w;E++)L[E]=s[E];for(var E=0;E<w;++E)if(s[E]!==-1){var $=o[o.length-1];if(s[$]<s[E]){L[E]=$,o.push(E);continue}for(f=0,h=o.length-1;f<h;){var q=(f>>>1)+(h>>>1)+(f&h&1);s[o[q]]<s[E]?f=q+1:h=q}s[E]<s[o[f]]&&(f>0&&(L[E]=o[f-1]),o[f]=E)}for(f=o.length,h=o[f-1];f-- >0;)o[f]=h,h=L[h];return L.length=0,o}function K(s,o,f){for(;o<s.length;o++)if(s[o]!=null&&s[o].dom!=null)return s[o].dom;return f}function J(s,o,f){var h=e.createDocumentFragment();pt(s,h,o),ut(s,h,f)}function pt(s,o,f){for(;f.dom!=null&&f.dom.parentNode===s;){if(typeof f.tag!="string"){if(f=f.instance,f!=null)continue}else if(f.tag==="<")for(var h=0;h<f.instance.length;h++)o.appendChild(f.instance[h]);else if(f.tag!=="[")o.appendChild(f.dom);else if(f.children.length===1){if(f=f.children[0],f!=null)continue}else for(var h=0;h<f.children.length;h++){var E=f.children[h];E!=null&&pt(s,o,E)}break}}function ut(s,o,f){f!=null?s.insertBefore(o,f):s.appendChild(o)}function nt(s){if(s.attrs==null||s.attrs.contenteditable==null&&s.attrs.contentEditable==null)return!1;var o=s.children;if(o!=null&&o.length===1&&o[0].tag==="<"){var f=o[0].children;s.dom.innerHTML!==f&&(s.dom.innerHTML=f)}else if(s.text!=null||o!=null&&o.length!==0)throw new Error("Child node of a contenteditable must be trusted");return!0}function P(s,o,f,h){for(var E=f;E<h;E++){var w=o[E];w!=null&&X(s,w)}}function X(s,o){var f=0,h=o.state,E,w;if(typeof o.tag!="string"&&typeof o.state.onbeforeremove=="function"){var $=c.call(o.state.onbeforeremove,o);$!=null&&typeof $.then=="function"&&(f=1,E=$)}if(o.attrs&&typeof o.attrs.onbeforeremove=="function"){var $=c.call(o.attrs.onbeforeremove,o);$!=null&&typeof $.then=="function"&&(f|=2,w=$)}if(a(o,h),!f)it(o),dt(s,o);else{if(E!=null){var q=function(){f&1&&(f&=2,f||I())};E.then(q,q)}if(w!=null){var q=function(){f&2&&(f&=1,f||I())};w.then(q,q)}}function I(){a(o,h),it(o),dt(s,o)}}function tt(s,o){for(var f=0;f<o.instance.length;f++)s.removeChild(o.instance[f])}function dt(s,o){for(;o.dom!=null&&o.dom.parentNode===s;){if(typeof o.tag!="string"){if(o=o.instance,o!=null)continue}else if(o.tag==="<")tt(s,o);else{if(o.tag!=="["&&(s.removeChild(o.dom),!Array.isArray(o.children)))break;if(o.children.length===1){if(o=o.children[0],o!=null)continue}else for(var f=0;f<o.children.length;f++){var h=o.children[f];h!=null&&dt(s,h)}}break}}function it(s){if(typeof s.tag!="string"&&typeof s.state.onremove=="function"&&c.call(s.state.onremove,s),s.attrs&&typeof s.attrs.onremove=="function"&&c.call(s.attrs.onremove,s),typeof s.tag!="string")s.instance!=null&&it(s.instance);else{var o=s.children;if(Array.isArray(o))for(var f=0;f<o.length;f++){var h=o[f];h!=null&&it(h)}}}function Et(s,o,f){for(var h in o)Tt(s,h,null,o[h],f)}function Tt(s,o,f,h,E){if(!(o==="key"||o==="is"||h==null||D(o)||f===h&&!x(s,o)&&typeof h!="object")){if(o[0]==="o"&&o[1]==="n")return O(s,o,h);if(o.slice(0,6)==="xlink:")s.dom.setAttributeNS("http://www.w3.org/1999/xlink",o.slice(6),h);else if(o==="style")Ct(s.dom,f,h);else if(C(s,o,E)){if(o==="value"&&((s.tag==="input"||s.tag==="textarea")&&s.dom.value===""+h&&s.dom===u()||s.tag==="select"&&f!==null&&s.dom.value===""+h||s.tag==="option"&&f!==null&&s.dom.value===""+h))return;s.tag==="input"&&o==="type"?s.dom.setAttribute(o,h):s.dom[o]=h}else typeof h=="boolean"?h?s.dom.setAttribute(o,""):s.dom.removeAttribute(o):s.dom.setAttribute(o==="className"?"class":o,h)}}function kt(s,o,f,h){if(!(o==="key"||o==="is"||f==null||D(o)))if(o[0]==="o"&&o[1]==="n"&&!D(o))O(s,o,void 0);else if(o==="style")Ct(s.dom,f,null);else if(C(s,o,h)&&o!=="className"&&!(o==="value"&&(s.tag==="option"||s.tag==="select"&&s.dom.selectedIndex===-1&&s.dom===u()))&&!(s.tag==="input"&&o==="type"))s.dom[o]=null;else{var E=o.indexOf(":");E!==-1&&(o=o.slice(E+1)),f!==!1&&s.dom.removeAttribute(o==="className"?"class":o)}}function Ht(s,o){if("value"in o)if(o.value===null)s.dom.selectedIndex!==-1&&(s.dom.value=null);else{var f=""+o.value;(s.dom.value!==f||s.dom.selectedIndex===-1)&&(s.dom.value=f)}"selectedIndex"in o&&Tt(s,"selectedIndex",null,o.selectedIndex,void 0)}function ne(s,o,f,h){if(f!=null)for(var E in f)Tt(s,E,o&&o[E],f[E],h);var w;if(o!=null)for(var E in o)(w=o[E])!=null&&(f==null||f[E]==null)&&kt(s,E,w,h)}function x(s,o){return o==="value"||o==="checked"||o==="selectedIndex"||o==="selected"&&s.dom===u()||s.tag==="option"&&s.dom.parentNode===e.activeElement}function D(s){return s==="oninit"||s==="oncreate"||s==="onupdate"||s==="onremove"||s==="onbeforeremove"||s==="onbeforeupdate"}function C(s,o,f){return f===void 0&&(s.tag.indexOf("-")>-1||s.attrs!=null&&s.attrs.is||o!=="href"&&o!=="list"&&o!=="form"&&o!=="width"&&o!=="height")&&o in s.dom}var U=/[A-Z]/g;function G(s){return"-"+s.toLowerCase()}function ft(s){return s[0]==="-"&&s[1]==="-"?s:s==="cssFloat"?"float":s.replace(U,G)}function Ct(s,o,f){if(o!==f)if(f==null)s.style.cssText="";else if(typeof f!="object")s.style.cssText=f;else if(o==null||typeof o!="object"){s.style.cssText="";for(var h in f){var E=f[h];E!=null&&s.style.setProperty(ft(h),String(E))}}else{for(var h in f){var E=f[h];E!=null&&(E=String(E))!==String(o[h])&&s.style.setProperty(ft(h),E)}for(var h in o)o[h]!=null&&f[h]==null&&s.style.removeProperty(ft(h))}}function v(){this._=n}v.prototype=Object.create(null),v.prototype.handleEvent=function(s){var o=this["on"+s.type],f;typeof o=="function"?f=o.call(s.currentTarget,s):typeof o.handleEvent=="function"&&o.handleEvent(s),this._&&s.redraw!==!1&&(0,this._)(),f===!1&&(s.preventDefault(),s.stopPropagation())};function O(s,o,f){if(s.events!=null){if(s.events[o]===f)return;f!=null&&(typeof f=="function"||typeof f=="object")?(s.events[o]==null&&s.dom.addEventListener(o.slice(2),s.events,!1),s.events[o]=f):(s.events[o]!=null&&s.dom.removeEventListener(o.slice(2),s.events,!1),s.events[o]=void 0)}else f!=null&&(typeof f=="function"||typeof f=="object")&&(s.events=new v,s.dom.addEventListener(o.slice(2),s.events,!1),s.events[o]=f)}function R(s,o,f){typeof s.oninit=="function"&&c.call(s.oninit,o),typeof s.oncreate=="function"&&f.push(c.bind(s.oncreate,o))}function B(s,o,f){typeof s.onupdate=="function"&&f.push(c.bind(s.onupdate,o))}function _(s,o){do{if(s.attrs!=null&&typeof s.attrs.onbeforeupdate=="function"){var f=c.call(s.attrs.onbeforeupdate,s,o);if(f!==void 0&&!f)break}if(typeof s.tag!="string"&&typeof s.state.onbeforeupdate=="function"){var f=c.call(s.state.onbeforeupdate,s,o);if(f!==void 0&&!f)break}return!1}while(!1);return s.dom=o.dom,s.domSize=o.domSize,s.instance=o.instance,s.attrs=o.attrs,s.children=o.children,s.text=o.text,!0}return function(s,o,f){if(!s)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var h=[],E=u(),w=s.namespaceURI;s.vnodes==null&&(s.textContent=""),o=pe.normalizeChildren(Array.isArray(o)?o:[o]);var $=n;try{n=typeof f=="function"?f:void 0,N(s,s.vnodes,o,h,null,w==="http://www.w3.org/1999/xhtml"?void 0:w)}finally{n=$}s.vnodes=o,E!=null&&u()!==E&&typeof E.focus=="function"&&E.focus();for(var q=0;q<h.length;q++)h[q]()}}});var yn=ot((bc,Or)=>{"use strict";Or.exports=Ar()(window)});var Cr=ot((Sc,Dr)=>{"use strict";var xr=Kt();Dr.exports=function(t,e,n){var r=[],i=!1,a=!1;function c(){if(i)throw new Error("Nested m.redraw.sync() call");i=!0;for(var p=0;p<r.length;p+=2)try{t(r[p],xr(r[p+1]),u)}catch(d){n.error(d)}i=!1}function u(){a||(a=!0,e(function(){a=!1,c()}))}u.sync=c;function l(p,d){if(d!=null&&d.view==null&&typeof d!="function")throw new TypeError("m.mount(element, component) expects a component, not a vnode");var m=r.indexOf(p);m>=0&&(r.splice(m,2),t(p,[],u)),d!=null&&(r.push(p,d),t(p,xr(d),u))}return{mount:l,redraw:u}}});var ze=ot((Tc,Ir)=>{"use strict";var as=yn();Ir.exports=Cr()(as,requestAnimationFrame,console)});var En=ot((wc,Rr)=>{"use strict";Rr.exports=function(t){if(Object.prototype.toString.call(t)!=="[object Object]")return"";var e=[];for(var n in t)r(n,t[n]);return e.join("&");function r(i,a){if(Array.isArray(a))for(var c=0;c<a.length;c++)r(i+"["+c+"]",a[c]);else if(Object.prototype.toString.call(a)==="[object Object]")for(var c in a)r(i+"["+c+"]",a[c]);else e.push(encodeURIComponent(i)+(a!=null&&a!==""?"="+encodeURIComponent(a):""))}}});var bn=ot((vc,$r)=>{"use strict";$r.exports=Object.assign||function(t,e){e&&Object.keys(e).forEach(function(n){t[n]=e[n]})}});var He=ot((Nc,Pr)=>{"use strict";var cs=En(),us=bn();Pr.exports=function(t,e){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names *must* be separated");if(e==null)return t;var n=t.indexOf("?"),r=t.indexOf("#"),i=r<0?t.length:r,a=n<0?i:n,c=t.slice(0,a),u={};us(u,e);var l=c.replace(/:([^\/\.-]+)(\.{3})?/g,function(S,T,N){return delete u[T],e[T]==null?S:N?e[T]:encodeURIComponent(String(e[T]))}),p=l.indexOf("?"),d=l.indexOf("#"),m=d<0?l.length:d,g=p<0?m:p,y=l.slice(0,g);n>=0&&(y+=t.slice(n,i)),p>=0&&(y+=(n<0?"?":"&")+l.slice(p,m));var b=cs(u);return b&&(y+=(n<0&&p<0?"?":"&")+b),r>=0&&(y+=t.slice(r)),d>=0&&(y+=(r<0?"":"&")+l.slice(d)),y}});var Mr=ot((Ac,_r)=>{"use strict";var fs=He();_r.exports=function(t,e,n){var r=0;function i(u){return new e(u)}i.prototype=e.prototype,i.__proto__=e;function a(u){return function(l,p){typeof l!="string"?(p=l,l=l.url):p==null&&(p={});var d=new e(function(b,S){u(fs(l,p.params),p,function(T){if(typeof p.type=="function")if(Array.isArray(T))for(var N=0;N<T.length;N++)T[N]=new p.type(T[N]);else T=new p.type(T);b(T)},S)});if(p.background===!0)return d;var m=0;function g(){--m==0&&typeof n=="function"&&n()}return y(d);function y(b){var S=b.then;return b.constructor=i,b.then=function(){m++;var T=S.apply(b,arguments);return T.then(g,function(N){if(g(),m===0)throw N}),y(T)},b}}}function c(u,l){for(var p in u.headers)if({}.hasOwnProperty.call(u.headers,p)&&l.test(p))return!0;return!1}return{request:a(function(u,l,p,d){var m=l.method!=null?l.method.toUpperCase():"GET",g=l.body,y=(l.serialize==null||l.serialize===JSON.serialize)&&!(g instanceof t.FormData),b=l.responseType||(typeof l.extract=="function"?"":"json"),S=new t.XMLHttpRequest,T=!1,N=S,M,V=S.abort;S.abort=function(){T=!0,V.call(this)},S.open(m,u,l.async!==!1,typeof l.user=="string"?l.user:void 0,typeof l.password=="string"?l.password:void 0),y&&g!=null&&!c(l,/^content-type$/i)&&S.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof l.deserialize!="function"&&!c(l,/^accept$/i)&&S.setRequestHeader("Accept","application/json, text/*"),l.withCredentials&&(S.withCredentials=l.withCredentials),l.timeout&&(S.timeout=l.timeout),S.responseType=b;for(var Q in l.headers)({}).hasOwnProperty.call(l.headers,Q)&&S.setRequestHeader(Q,l.headers[Q]);S.onreadystatechange=function(j){if(!T&&j.target.readyState===4)try{var k=j.target.status>=200&&j.target.status<300||j.target.status===304||/^file:\/\//i.test(u),H=j.target.response,Y;if(b==="json"?!j.target.responseType&&typeof l.extract!="function"&&(H=JSON.parse(j.target.responseText)):(!b||b==="text")&&H==null&&(H=j.target.responseText),typeof l.extract=="function"?(H=l.extract(j.target,l),k=!0):typeof l.deserialize=="function"&&(H=l.deserialize(H)),k)p(H);else{try{Y=j.target.responseText}catch(W){Y=H}var L=new Error(Y);L.code=j.target.status,L.response=H,d(L)}}catch(W){d(W)}},typeof l.config=="function"&&(S=l.config(S,l,u)||S,S!==N&&(M=S.abort,S.abort=function(){T=!0,M.call(this)})),g==null?S.send():typeof l.serialize=="function"?S.send(l.serialize(g)):g instanceof t.FormData?S.send(g):S.send(JSON.stringify(g))}),jsonp:a(function(u,l,p,d){var m=l.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+r++,g=t.document.createElement("script");t[m]=function(y){delete t[m],g.parentNode.removeChild(g),p(y)},g.onerror=function(){delete t[m],g.parentNode.removeChild(g),d(new Error("JSONP request failed"))},g.src=u+(u.indexOf("?")<0?"?":"&")+encodeURIComponent(l.callbackKey||"callback")+"="+encodeURIComponent(m),t.document.documentElement.appendChild(g)})}}});var kr=ot((Oc,jr)=>{"use strict";var ls=gn(),ps=ze();jr.exports=Mr()(window,ls,ps.redraw)});var Sn=ot((Dc,Fr)=>{"use strict";Fr.exports=function(t){if(t===""||t==null)return{};t.charAt(0)==="?"&&(t=t.slice(1));for(var e=t.split("&"),n={},r={},i=0;i<e.length;i++){var a=e[i].split("="),c=decodeURIComponent(a[0]),u=a.length===2?decodeURIComponent(a[1]):"";u==="true"?u=!0:u==="false"&&(u=!1);var l=c.split(/\]\[?|\[/),p=r;c.indexOf("[")>-1&&l.pop();for(var d=0;d<l.length;d++){var m=l[d],g=l[d+1],y=g==""||!isNaN(parseInt(g,10));if(m===""){var c=l.slice(0,d).join();n[c]==null&&(n[c]=Array.isArray(p)?p.length:0),m=n[c]++}else if(m==="__proto__")break;if(d===l.length-1)p[m]=u;else{var b=Object.getOwnPropertyDescriptor(p,m);b!=null&&(b=b.value),b==null&&(p[m]=b=y?[]:{}),p=b}}}return r}});var Ge=ot((xc,Lr)=>{"use strict";var ds=Sn();Lr.exports=function(t){var e=t.indexOf("?"),n=t.indexOf("#"),r=n<0?t.length:n,i=e<0?r:e,a=t.slice(0,i).replace(/\/{2,}/g,"/");return a?(a[0]!=="/"&&(a="/"+a),a.length>1&&a[a.length-1]==="/"&&(a=a.slice(0,-1))):a="/",{path:a,params:e<0?{}:ds(t.slice(e+1,r))}}});var qr=ot((Cc,Ur)=>{"use strict";var ms=Ge();Ur.exports=function(t){var e=ms(t),n=Object.keys(e.params),r=[],i=new RegExp("^"+e.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(a,c,u){return c==null?"\\"+a:(r.push({k:c,r:u==="..."}),u==="..."?"(.*)":u==="."?"([^/]+)\\.":"([^/]+)"+(u||""))})+"$");return function(a){for(var c=0;c<n.length;c++)if(e.params[n[c]]!==a.params[n[c]])return!1;if(!r.length)return i.test(a.path);var u=i.exec(a.path);if(u==null)return!1;for(var c=0;c<r.length;c++)a.params[r[c].k]=r[c].r?u[c+1]:decodeURIComponent(u[c+1]);return!0}}});var Gr=ot((Ic,Br)=>{"use strict";var hs=Kt(),gs=dn(),ys=gn(),Es=He(),zr=Ge(),bs=qr(),Hr=bn(),Tn={};Br.exports=function(t,e){var n;function r(m,g,y){if(m=Es(m,g),n!=null){n();var b=y?y.state:null,S=y?y.title:null;y&&y.replace?t.history.replaceState(b,S,d.prefix+m):t.history.pushState(b,S,d.prefix+m)}else t.location.href=d.prefix+m}var i=Tn,a,c,u,l,p=d.SKIP={};function d(m,g,y){if(m==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var b=0,S=Object.keys(y).map(function(k){if(k[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(k))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:k,component:y[k],check:bs(k)}}),T=typeof setImmediate=="function"?setImmediate:setTimeout,N=ys.resolve(),M=!1,V;if(n=null,g!=null){var Q=zr(g);if(!S.some(function(k){return k.check(Q)}))throw new ReferenceError("Default route doesn't match any known routes")}function j(){M=!1;var k=t.location.hash;d.prefix[0]!=="#"&&(k=t.location.search+k,d.prefix[0]!=="?"&&(k=t.location.pathname+k,k[0]!=="/"&&(k="/"+k)));var H=k.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(d.prefix.length),Y=zr(H);Hr(Y.params,t.history.state);function L(){if(H===g)throw new Error("Could not resolve default route "+g);r(g,null,{replace:!0})}W(0);function W(K){for(;K<S.length;K++)if(S[K].check(Y)){var J=S[K].component,pt=S[K].route,ut=J,nt=l=function(P){if(nt===l){if(P===p)return W(K+1);a=P!=null&&(typeof P.view=="function"||typeof P=="function")?P:"div",c=Y.params,u=H,l=null,i=J.render?J:null,b===2?e.redraw():(b=2,e.redraw.sync())}};J.view||typeof J=="function"?(J={},nt(ut)):J.onmatch?N.then(function(){return J.onmatch(Y.params,H,pt)}).then(nt,L):nt("div");return}L()}}return n=function(){M||(M=!0,T(j))},typeof t.history.pushState=="function"?(V=function(){t.removeEventListener("popstate",n,!1)},t.addEventListener("popstate",n,!1)):d.prefix[0]==="#"&&(n=null,V=function(){t.removeEventListener("hashchange",j,!1)},t.addEventListener("hashchange",j,!1)),e.mount(m,{onbeforeupdate:function(){return b=b?2:1,!(!b||Tn===i)},oncreate:j,onremove:V,view:function(){if(!(!b||Tn===i)){var k=[hs(a,c.key,c)];return i&&(k=i.render(k[0])),k}}})}return d.set=function(m,g,y){l!=null&&(y=y||{},y.replace=!0),l=null,r(m,g,y)},d.get=function(){return u},d.prefix="#!",d.Link={view:function(m){var g=m.attrs.options,y={},b,S;Hr(y,m.attrs),y.selector=y.options=y.key=y.oninit=y.oncreate=y.onbeforeupdate=y.onupdate=y.onbeforeremove=y.onremove=null;var T=gs(m.attrs.selector||"a",y,m.children);return(T.attrs.disabled=Boolean(T.attrs.disabled))?(T.attrs.href=null,T.attrs["aria-disabled"]="true",T.attrs.onclick=null):(b=T.attrs.onclick,S=T.attrs.href,T.attrs.href=d.prefix+S,T.attrs.onclick=function(N){var M;typeof b=="function"?M=b.call(N.currentTarget,N):b==null||typeof b!="object"||typeof b.handleEvent=="function"&&b.handleEvent(N),M!==!1&&!N.defaultPrevented&&(N.button===0||N.which===0||N.which===1)&&(!N.currentTarget.target||N.currentTarget.target==="_self")&&!N.ctrlKey&&!N.metaKey&&!N.shiftKey&&!N.altKey&&(N.preventDefault(),N.redraw=!1,d.set(S,null,g))}),T}},d.param=function(m){return c&&m!=null?c[m]:c},d}});var Yr=ot((Rc,Vr)=>{"use strict";var Ss=ze();Vr.exports=Gr()(window,Ss)});var oe=ot(($c,Wr)=>{"use strict";var Ve=wr(),Kr=kr(),Jr=ze(),Rt=function(){return Ve.apply(this,arguments)};Rt.m=Ve;Rt.trust=Ve.trust;Rt.fragment=Ve.fragment;Rt.mount=Jr.mount;Rt.route=Yr();Rt.render=yn();Rt.redraw=Jr.redraw;Rt.request=Kr.request;Rt.jsonp=Kr.jsonp;Rt.parseQueryString=Sn();Rt.buildQueryString=En();Rt.parsePathname=Ge();Rt.buildPathname=He();Rt.vnode=Kt();Rt.PromisePolyfill=hn();Wr.exports=Rt});var we=ot((_c,Xr)=>{Xr.exports={seconds:Ts,makeDebouncer:Ye,makeThrottler:vs,runAfter:Ns,runOnce:As,runFnPeriodically:Qr,makeValueChangeDetector:wn,makeValueInPredicateDetector:Os,runFnWhenValueChanges:Ds,Delay:ws};function Ts(t){return t*1e3}function ws(t,e){let[n]=Ye(e,t);return(...r)=>n(...r)}function Ye(t,e){let n,r=()=>clearTimeout(n);return[(...a)=>{r(),n=setTimeout(e,t,...a)},r]}function vs(t,e){let n=!0,[r,i]=Ye(e,()=>n=!0);return[(...c)=>{n&&(n=!1,r(),t(...c))},i]}function Ns(t,e){let[n,r]=Ye(t,e);return n(),r}function As(t){let e=!0,n=()=>!0,r=(...i)=>{e&&n()&&(e=!1,t(...i))};return r.when=i=>(n=i,r),r}function Qr(t,e=16){let n=()=>clearInterval(r),r=setInterval(t,e,{cleanup:n});return n}function wn({onChange:t=()=>{},getValueFn:e=()=>NaN,equalityFn:n=(r,i)=>r===i}){let r=e();return(...a)=>{let c=e();if(!n(c,r)){let u=r;r=c,t(c,u,...a)}}}function Os({onChange:t=()=>{},getValueFn:e=()=>NaN,predicateFn:n=()=>!0}){return wn({getValueFn:e,onChange:i=>n(i)&&t()})}function Ds({fn:t,getValueFn:e}){let n=wn({getValueFn:e,onChange:t});return Qr(n,16)}});var vn=ot((Mc,Zr)=>{Zr.exports={isThennable:Cs,makePromise:ve,delay:Is,unzip:xs,makeIdleDetectorWithTimeout:Rs,poolPromises:$s,runPromisesInSequence:Ps};var{seconds:_s,runOnce:Ms,makeDebouncer:to}=we();function eo(){return[(t,[e,n])=>[[...t[0],e],[...t[1],n]],[[],[]]]}function xs(t){return t.reduce(...eo())}function Cs(t){return t&&typeof t.then=="function"}function ve(){let t,e;return[new Promise((r,i)=>{t=r,e=i}),t,e]}function Is(t){let[e,n]=ve();return setTimeout(n,t||0),e}function Rs(t=()=>{},{withinMs:e=500,timeoutInMs:n=_s(5)}){let[r,i,a]=ve(),[c,u]=to(i,e),[l,p]=to(a,n),d=t(c);return c(),l(),r.finally(()=>{d&&d(),u(),p()})}function $s(t,...e){let n=()=>a.forEach(c=>c()),r=ks(t,n),[i,a]=e.map(c=>js(r,c)).reduce(...eo());return n(),Promise.allSettled(i)}function js(t,e){let{allowedToStartNext:n,bumpRunCount:r,unbump:i}=t,[a,c,u]=ve();return[a,Ms(()=>{r(),e().then(c,u).finally(i)}).when(n)]}function ks(t,e){let n=0;return{allowedToStartNext:()=>n<Math.max(1,t),bumpRunCount:()=>e(++n),unbump:()=>e(--n)}}function Ps(t,...e){let[n,r,i]=ve();return e.reduce(Fs(i),Promise.resolve(t)).then(r).catch(i),n}function Fs(t){return(e,n)=>e.then(n,t)}});var Xo=ot(ce=>{"use strict";function Po(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r&&r.push(n)||t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&r.splice(r.indexOf(n)>>>0,1)},emit:function(e,n){(t.get(e)||[]).slice().map(function(r){r(n)}),(t.get("*")||[]).slice().map(function(r){r(e,n)})}}}function _o(t){return Array.isArray(t)}function Mt(t){return typeof t=="function"}function Dt(t){return typeof t=="string"}function Mo(t){return typeof t=="object"}function Xt(t){return!(t===null||!Mo(t))&&Object.getPrototypeOf(t)===Object.prototype}function tn(t){return!!Dt(t)||!!_o(t)&&t.every(Dt)}Object.defineProperty(ce,"__esModule",{value:!0});function Gn(t){return function(e,n,...r){let i=Object.entries(n).map(([u,l])=>({argName:u,argType:l})),a=r.map((...u)=>((l,p,d)=>{let{argName:m,argType:g}=l[d];if(p===void 0)return`Argument undefined: "${m}"`;let y=Array.isArray(g)?g:[g],b=y.map(S=>Mt(S)?((T,N,M)=>N(M)?void 0:`${N.name}(${T}) did not return true`)(m,S,p):((T,N,M)=>typeof M===N?void 0:`Argument "${T}" should be a ${N}`)(m,S,p)).filter(Dt);return(y.length>1?b.length>1:b.length)?`${b.join(`
| `)}
> typeof ${m} === ${typeof p}(${JSON.stringify(p)})`:void 0})(i,...u)).filter(Dt);if(!a.length)return;let c=Object.keys(n).join(", ");return`
${t||""}${e}(${c}):
${a.map(u=>`| ${u}`).join(`
`)}`}}function Vn(t){let e=t.addListener?(...i)=>t.addListener(...i):(...i)=>t.on(...i),n=t.removeListener?(...i)=>t.removeListener(...i):(...i)=>t.off(...i),r=new Map;return{emit:(i,...a)=>t.emit(i,a),on:function(i,a){let c=r.get(a);c||(c={handleEvent:u=>a(...u||[]),refCount:0},r.set(a,c)),c.refCount+=1,e(i,c.handleEvent)},off:function(i,a){let c=r.get(a);c&&(n(i,c.handleEvent),c.refCount-=1,c.refCount===0&&r.delete(a))}}}function jo(t){return t.reduce((e,n)=>e.indexOf(n)===-1?[...e,n]:e,[])}function Ea(t){return(...e)=>function(n,...r){let i=setTimeout(n,0,...r);return()=>{clearTimeout(i)}}(t,...e)}function ko(t){let e,n=!1;return{fn:(...r)=>(n||(e=t(...r)),e),revoke:()=>{n=!0}}}function Yn(t,e,n,...r){let i=[...r].flat().reduce((u,l)=>({...u,[l]:0}),{});function a(u){let l=c(u)-1;i[u]=Math.max(l,0)}function c(u){return i[u]||0}return{increase:function(u){return i[u]=c(u)+1,()=>{a(u)}},decrease:a,countOf:c,toValue:function(){return{description:`Statebot[${t}]: ${n}:`,table:Object.keys(i).sort().map(u=>[u,i[u]]).map(([u,l])=>({[e]:u,refs:l||"None"}))}},refs:function(){return{...i}}}}function Fo(t,e){function n(){return t>=1}function r(){return t>=2}function i(){return t>=3}Dt(t)&&(t={info:3,log:2,warn:1,none:0}[t]||3);let{info:a,table:c,log:u,warn:l,error:p}=e||console;return{canWarn:n,canLog:r,canInfo:i,info:(...d)=>{i()&&a(...d)},table:(...d)=>{r()&&c(...d)},log:(...d)=>{r()&&u(...d)},warn:(...d)=>{n()&&l(...d)},error:(...d)=>{p(...d)}}}var ba=/[\r\n]/,Lo="|",Ce="->",Sa=[Lo,Ce].map(t=>t.replace("|","\\|")).join("|"),Ta=new RegExp(`(${Sa})$`),wa=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,va=/(\/\/[^\n\r]*)/,Uo=Gn("statebot.");function zo(t){let e=Uo("decomposeRoute",{templateLiteral:tn},t);if(e)throw TypeError(e);return Bo(qo(t)).flat(2)}function Wn(t){let e=Uo("decomposeChart",{chart:tn},t);if(e)throw TypeError(e);let n=Bo(qo(t)),r=n.map(Na).flat(1).map(Aa).flat(1),i=!1,a=jo(r.map(u=>(u.includes("")&&(i=!0),u.join(Ce)))),c=jo(n.flat(3));return{transitions:a.map(u=>u.split(Ce)),routes:a,states:i?c:c.filter(Boolean)}}function qo(t){let e=function(a){return[a].flat().reduce((c,u)=>[...c,...u.split(ba)],[])}(t),n=[],r=!1,i=e.reduce((a,c)=>{let u=c.replace(va,"").replace(wa,"");return u?(r=Ta.test(u),r?a+u:(n.push(a+u),"")):a},"");return r||i?[...n,i]:[...n]}function Bo(t){return t.map(e=>e.split(Ce).map(n=>n.split(Lo)))}function Na(t){let e=[];return t.reduce((n,r)=>(n===!1||e.push([n,[...r]]),[...r]),!1),e}function Aa([t,e]){return t.reduce((n,r)=>[...n,...e.map(i=>[r,i])],[])}var Ho="onExiting",Go="onEntering",Vo="onExited",Yo="onEntered",Ie="onSwitching",Re="onSwitched",$e={[Ie]:"(ANY)state:changing",[Re]:"(ANY)state:changed"};function Wo(t,e){let n=[],r=[];return{configs:t.reduce((i,a)=>{let{routeChart:c,action:u}=a,{states:l,routes:p,transitions:d}=Wn(c);return e()&&(n.push(...l),r.push(...p)),[...i,...d.map(([m,g])=>({fromState:m,toState:g,action:u}))]},[]),states:n,routes:r}}function Kn(t){return Xt(t)&&typeof t.__STATEBOT__=="number"}var Ko=Gn("statebot."),Jo=0;function Jn(){let t=Date.now();function e(n,r){return n.toFixed(r).replace(/\.0+$/,"")}return function(){let n=Date.now()-t;return n<500?`${e(n)} ms`:n<5e3?`${e(n/1e3,2)} s `:n<6e4?`${e(n/1e3,1)} s `:`${e(n/1e3/60,1)} m `}}ce.Statebot=function(t,e){if(!Dt(t))throw new TypeError(`
Statebot: Please specify a name for this machine`);let n=`Statebot[${t}]`;if(!Xt(e))throw new TypeError(`
${n}: Please specify options for this machine`);let{chart:r,logLevel:i=3,historyLimit:a=2}=e||{},c=e.events===void 0?Vn(Po()):Mo(u=e.events)&&Mt(u.emit)&&(Mt(u.addListener)||Mt(u.on))&&(Mt(u.removeListener)||Mt(u.off))&&Vn(e.events);var u;if(!c)throw new TypeError(`
${n}: Invalid event-emitter specified in options`);let{states:l=[],routes:p=[]}=r?Wn(r):e,{startIn:d=l[0]}=e;if(!l.includes(d))throw new Error(`${n}: Starting-state not in chart: "${d}"`);let m=Gn(`${n}#`),g=Fo(i,console),{canWarn:y}=g,b=[d],S=Math.max(a,2),T=0,{pause:N,resume:M,paused:V,Pausable:Q}=function(x,D){D=D||function(){};let C=!!x;return{Pausable:function(U){return(...G)=>C?(D(),!1):U(...G)},paused:()=>C,pause:()=>{C=!0},resume:()=>{C=!1}}}(!1,()=>g.warn(`${n}: Ignoring callback, paused`)),j=Vn(Po()),k=Q(j.emit);function H(x,D){return j.on(x,D),()=>j.off(x,D)}let Y=Yn(t,"states","Listening for the following state-changes",[...l]),L=Yn(t,"transitions","Listening for the following transitions",[...p]),W=Yn(t,"events","Listening for the following events");function K(x,D){let C=Mt(x)?x({enter:tt,emit:X,Enter:kt,Emit:Tt}):Xt(x)?x:null;if(!Xt(C))throw new TypeError(`Statebot[${t}]#${D}(): Expected an object, or a function that returns an object`);let U=[],G=[],{transitionsForEvents:ft,transitionsOnly:Ct}=function(_){let s={},o=[];return Object.entries(_).map(([f,h])=>{if(Mt(h))return void o.push({routeChart:f,action:h});if(!Xt(h))return;let{on:E,then:w}=h;Dt(E)||_o(E)?[E].flat().map($=>{s[$]=s[$]||[],s[$].push({routeChart:f,action:w})}):Mt(w)&&o.push({routeChart:f,action:h})}),{transitionsForEvents:s,transitionsOnly:o}}(C),v=Object.entries(ft).reduce(function(_,[s,o]){let{states:f,routes:h,configs:E}=Wo(o,y);return y()&&(U.push(...f),G.push(...h)),{..._,[s]:E}},{}),O=Wo(Ct,y),R=Object.entries(v).map(function([_,s]){return[W.increase(_),dt(_,(...o)=>{s.map(f=>({...f,args:o})).some(B)||Ht(`Event not handled: "${_}"`)})]}).concat(O.configs.map(function(_){let{fromState:s,toState:o,action:f}=_,h=`${s}->${o}`;return[L.increase(h),H(h,f)]})).flat();if(y()){U.push(...O.states),G.push(...O.routes);let _=U.filter(o=>!l.includes(o)),s=G.filter(o=>!p.includes(o));_.length&&g.warn(`Statebot[${t}]#${D}(): Invalid states specified:
`+_.map(o=>`  > "${o}"`).join(`
`)),s.length&&g.warn(`Statebot[${t}]#${D}(): Invalid transitions specified:
`+s.map(o=>`  > "${o}"`).join(`
`))}return()=>R.map(_=>_());function B({fromState:_,toState:s,action:o,args:f}){return P(_,()=>(tt(s,...f),Mt(o)&&o(...f),!0))}}function J(){return b[b.length-2]}function pt(){return b[b.length-1]}function ut(x){let D=x!==void 0?x:pt(),C=m("statesAvailableFromHere",{state:Dt},D);if(C)throw new TypeError(C);return p.reduce((U,G)=>{let[ft,Ct]=G.split(Ce).map(v=>v.trim());return ft===D?[...U,Ct]:U},[])}function nt(x,D,...C){let U=pt()===x;return D===void 0?U:U?Mt(D)?D(...C):D:null}function P(...x){let D=m("inState",{state:[Dt,Xt]},x[0]);if(D)throw new TypeError(D);return Xt(x[0])?function(C,...U){let G=Object.entries(C).find(([ft])=>nt(ft));return G?nt(...G.concat(U)):null}(...x):nt(...x)}let X=Q((x,...D)=>{let C=m("emit",{eventName:Dt},x);if(C)throw new TypeError(C);return c.emit(x,...D)}),tt=Q((x,...D)=>{let C=m("enter",{state:Dt},x);if(C)throw new TypeError(C);let U=pt(),G=x;if(G===U)return Ht(`Already in state: "${G}"`),!1;if(!l.includes(G))return Ht(`Invalid state "${G}", not switching`),!1;let ft=`${U}->${G}`;return p.includes(ft)?(g.info(`${n}: tId<${++T}>: ${ft}`),b.push(G),b.length>S&&b.shift(),k($e[Ie],G,U,...D),k(ft,...D),k($e[Re],G,U,...D),!0):(Ht(`Invalid transition "${ft}", not switching`),!1)});function dt(x,D){let C=m("onEvent",{eventName:Dt,cb:Mt},x,D);if(C)throw new TypeError(C);return c.on(x,D),()=>c.off(x,D)}let it=Object.keys($e).reduce((x,D)=>({...x,[D]:C=>{let U=m(D,{cb:Mt},C);if(U)throw new TypeError(U);let G=Y.increase($e[D]),ft=H($e[D],C);return()=>{ft(),G()}}}),{}),Et=[[Ho,Ie],[Go,Ie],[Vo,Re],[Yo,Re]].reduce((x,D)=>{let[C,U]=D,G=C.slice(2),ft=G.toLowerCase();return{...x,[C]:(Ct,v)=>{let O=m(C,{state:Dt,cb:Mt},Ct,v);if(O)throw new TypeError(O);let R=[Y.increase(Ct),Y.increase(`${Ct}:${ft}`)],B=it[U]((_,s,...o)=>{G.indexOf("Exit")===0?Ct===s&&v(_,...o):Ct===_&&v(s,...o)});return()=>{B(),R.map(_=>_())}}}},{});function Tt(x,...D){let C=m("Emit",{eventName:Dt},x);if(C)throw new TypeError(C);return(...U)=>X(x,...D,...U)}function kt(x,...D){let C=m("Enter",{state:Dt},x);if(C)throw new TypeError(C);return(...U)=>tt(x,...D,...U)}function Ht(x){let D=J(),C=pt(),U=`${D===void 0?"[undefined]":D}->${C}`,G=ut();G.length?g.info(`${n}: ${x}
  > Previous transition: "${U}"
  > From "${C}", valid states are: [${G.map(ft=>`"${ft}"`).join(", ")}]`):g.info(`${n}: ${x}
  > Previous transition: "${U}"
  > There are no states available from "${C}"`)}function ne(x){let{description:D,table:C}=x.toValue();g.log(D),C.length?g.table(C):g.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(...x){let D=x.flat(),C=m("canTransitionTo",{state:Dt},D[0]);if(C)throw new TypeError(C);if(!D.length)return!1;let U=ut();return D.every(G=>U.includes(G))},currentState:pt,emit:X,Emit:Tt,enter:tt,Enter:kt,history:()=>[...b],info:()=>(g.log(`${n}: Information about this state-machine`),ne(Y),ne(L),void ne(W)),inspect:()=>({states:Y.refs(),transitions:L.refs(),events:W.refs()}),inState:P,InState:function(...x){let D=m("InState",{state:[Dt,Xt]},x[0]);if(D)throw new TypeError(D);return Xt(x[0])?function(C,...U){return(...G)=>P(C,...U,...G)}(...x):function(C,U,...G){return(...ft)=>P(C,U,...G,...ft)}(...x)},name:()=>t,onEntered:Et[Yo],onEntering:Et[Go],onEvent:dt,onExited:Et[Vo],onExiting:Et[Ho],onSwitched:it[Re],onSwitching:it[Ie],onTransitions:x=>K(x,"onTransitions"),pause:N,paused:V,performTransitions:x=>K(x,"performTransitions"),previousState:J,reset:function(){g.warn(`${n}: State-machine reset!`),b.length=0,b.push(d)},resume:M,statesAvailableFromHere:ut}},ce.assertRoute=function(t,e,n){let r=Ko("assertRoute",{machine:Kn,expectedRoute:tn},t,e);if(r)throw TypeError(r);Jo+=1;let{description:i="Assertion complete",fromState:a="",run:c=()=>{},permittedDeviations:u=0,timeoutInMs:l=1e3,logLevel:p=3}=n||{},d=Fo(p),m=`Statebot[${t.name()}]: aId<${Jo}>`,g=zo(e);d.log(`
${m}: Asserting route: [${g.join(" > ")}]`),d.log(`${m}: > Assertion will start from state: "${a}"`);let y=Ea(c),b=()=>{},S=Jn(),T,N=Jn(),M=0,V=!0,Q=!1,j=[...g],k=function(L,W){W=W||[];let K=[],J=(L=L||[]).map((tt,dt)=>W[dt]||"center"),pt=!1;function ut(){pt=!0}function nt(...tt){if(pt)return;let dt=L.reduce((it,Et,Tt)=>({...it,[Et]:tt[Tt]||""}),{});K.push(dt)}function P(){return K.reduce((tt,dt)=>L.map((it,Et)=>Math.max(dt[it].length,tt[Et])),L.map(()=>0))}function X(){let tt=P();function dt(it,Et){let Tt=tt[Et],kt=J[Et];return kt==="left"?it.padEnd(Tt):kt==="right"?it.padStart(Tt):it}return K.reduce((it,Et)=>[...it,L.reduce((Tt,kt,Ht)=>({...Tt,[kt]:dt(Et[kt],Ht)}),{})],[])}return{lock:ut,addRow:nt,content:X}}(["state","expected","info","took"],["center","center","left","right"]),H=function(L){let{revoke:W,fn:K}=ko(L),J;return function(...pt){return J=K(...pt),W(),J}}(L=>(Y("","","","TOTAL: "+S()),k.lock(),d.log(`
${m}: ${i}: [${L?"FAILED":"SUCCESS"}]`),d.table(k.content()),L)),{addRow:Y}=k;return new Promise((L,W)=>{if(j.length===0)return void W(H(new Error("NO ROUTE TO TEST")));let K=nt=>{for(;j.length;){let P=j.shift();Y(t.currentState(),`(${P})`,nt),Q=!1}(P=>{clearTimeout(T),b(),ut(),W(P)})(H(new Error(nt)))};t.inState(a)&&(V=!1,b=y());let{revoke:J,fn:pt}=ko(nt=>{T=setTimeout(()=>{J(),K("TIMEOUT")},l),function(P){if(V)Y(P,"-","PENDING");else{let X=j[0];X===P?(Y(P,X,Q?"REALIGNED":"OKAY",N()),Q=!1,j.shift()):(Y(P,X,"WRONG STATE",N()),Q=!0,M+=1),N=Jn()}}(nt),V&&nt===a&&(V=!1,b=y()),M>u&&(J(),K("TOO MANY DEVIATIONS")),j.length<=0&&(J(),((...P)=>{clearTimeout(T),b(),ut(),L(...P)})(H()))}),ut=t.onSwitching(pt)})},ce.decomposeChart=Wn,ce.isStatebot=Kn,ce.routeIsPossible=function(t,e){let n=Ko("routeIsPossible",{machine:Kn,route:tn},t,e);if(n)throw TypeError(n);let r=zo(e);return r.every((i,a)=>{if(a===r.length-1)return!0;{let c=r[a+1];return t.statesAvailableFromHere(i).includes(c)}})}});var gi=ot(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});function Qo(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r&&r.push(n)||t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&r.splice(r.indexOf(n)>>>0,1)},emit:function(e,n){(t.get(e)||[]).slice().map(function(r){r(n)}),(t.get("*")||[]).slice().map(function(r){r(e,n)})}}}function Oa(t){return Zo(t)&&jt(t.emit)&&(jt(t.addListener)||jt(t.on))&&(jt(t.removeListener)||jt(t.off))}function ti(t){return Array.isArray(t)}function jt(t){return typeof t=="function"}function xt(t){return typeof t=="string"}function Zo(t){return typeof t=="object"}function Qt(t){return t===null||!Zo(t)?!1:Object.getPrototypeOf(t)===Object.prototype}function en(t){return xt(t)?!0:ti(t)?t.every(xt):!1}var Da=(t,e,n)=>e(n)?void 0:`${e.name}(${t}) did not return true`,xa=(t,e,n)=>typeof n===e?void 0:`Argument "${t}" should be a ${e}`,Ca=(t,e,n)=>{let{argName:r,argType:i}=t[n];if(e===void 0)return`Argument undefined: "${r}"`;let a=Array.isArray(i)?i:[i],c=a.map(p=>jt(p)?Da(r,p,e):xa(r,p,e)).filter(xt);if(a.length>1?c.length>1:c.length)return`${c.join(`
| `)}
> typeof ${r} === ${typeof e}(${JSON.stringify(e)})`};function Xn(t){return function(e,n,...r){let i=Object.entries(n).map(([u,l])=>({argName:u,argType:l})),a=r.map((...u)=>Ca(i,...u)).filter(xt);if(!a.length)return;let c=Object.keys(n).join(", ");return`
${t||""}${e}(${c}):
${a.map(u=>`| ${u}`).join(`
`)}`}}function Qn(t){let e=(u,...l)=>t.emit(u,l),n=t.addListener?(...u)=>t.addListener(...u):(...u)=>t.on(...u),r=t.removeListener?(...u)=>t.removeListener(...u):(...u)=>t.off(...u),i=new Map;function a(u,l){let p=i.get(l);p||(p={handleEvent:d=>l(...d||[]),refCount:0},i.set(l,p)),p.refCount+=1,n(u,p.handleEvent)}function c(u,l){let p=i.get(l);!p||(r(u,p.handleEvent),p.refCount-=1,p.refCount===0&&i.delete(l))}return{emit:e,on:a,off:c}}function ei(t){return t.reduce((e,n)=>e.indexOf(n)===-1?[...e,n]:e,[])}function Ia(t,...e){let n=setTimeout(t,0,...e);return()=>{clearTimeout(n)}}function Ra(t){return(...e)=>Ia(t,...e)}function $a(t){let{revoke:e,fn:n}=ni(t),r;return function(...i){return r=n(...i),e(),r}}function ni(t){let e=!1,n;return{fn:(...r)=>(e||(n=t(...r)),n),revoke:()=>{e=!0}}}function Pa(t,e){e=e||function(){};let n=!!t;function r(i){return(...a)=>n?(e(),!1):i(...a)}return{Pausable:r,paused:()=>n,pause:()=>{n=!0},resume:()=>{n=!1}}}function Zn(t,e,n,...r){let i=[...r].flat().reduce((m,g)=>({...m,[g]:0}),{});function a(m){return i[m]=u(m)+1,()=>{c(m)}}function c(m){let g=u(m)-1;i[m]=Math.max(g,0)}function u(m){return i[m]||0}function l(){return{...i}}function p(){return Object.keys(i).sort().map(m=>[m,i[m]]).map(([m,g])=>({[e]:m,refs:g||"None"}))}function d(){return{description:`Statebot[${t}]: ${n}:`,table:p()}}return{increase:a,decrease:c,countOf:u,toValue:d,refs:l}}function ri(t,e){xt(t)&&(t={info:3,log:2,warn:1,none:0}[t]||3);function n(){return t>=1}function r(){return t>=2}function i(){return t>=3}let{info:a,table:c,log:u,warn:l,error:p}=e||console;return{canWarn:n,canLog:r,canInfo:i,info:(...d)=>{i()&&a(...d)},table:(...d)=>{r()&&c(...d)},log:(...d)=>{r()&&u(...d)},warn:(...d)=>{n()&&l(...d)},error:(...d)=>{p(...d)}}}var _a=/[\r\n]/,oi="|",Pe="->",Ma=[oi,Pe].map(t=>t.replace("|","\\|")).join("|"),ja=new RegExp(`(${Ma})$`),ka=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,Fa=/(\/\/[^\n\r]*)/,ii=Xn("statebot.");function ci(t){let e=ii("decomposeRoute",{templateLiteral:en},t);if(e)throw TypeError(e);let n=si(t);return ai(n).flat(2)}function tr(t){let e=ii("decomposeChart",{chart:en},t);if(e)throw TypeError(e);let n=si(t),r=ai(n),a=r.map(La).flat(1).map(Ua).flat(1),c=!1,u=a.map(d=>(d.includes("")&&(c=!0),d.join(Pe))),l=ei(u),p=ei(r.flat(3));return{transitions:l.map(d=>d.split(Pe)),routes:l,states:c?p:p.filter(Boolean)}}function qa(t){return[t].flat().reduce((e,n)=>[...e,...n.split(_a)],[])}function si(t){let e=qa(t),n=[],r=!1,i=(c,u)=>{let l=u.replace(Fa,"").replace(ka,"");return l?(r=ja.test(l),r?c+l:(n.push(c+l),"")):c},a=e.reduce(i,"");return r||a?[...n,a]:[...n]}function ai(t){return t.map(e=>e.split(Pe).map(n=>n.split(oi)))}function La(t){let e=[];return t.reduce((n,r)=>n===!1?[...r]:(e.push([n,[...r]]),[...r]),!1),e}function Ua([t,e]){return t.reduce((n,r)=>[...n,...e.map(i=>[r,i])],[])}var ui="onExiting",fi="onEntering",li="onExited",pi="onEntered",_e="onSwitching",Me="onSwitched",je={[_e]:"(ANY)state:changing",[Me]:"(ANY)state:changed"};function za(t,e){if(!xt(t))throw new TypeError(`
Statebot: Please specify a name for this machine`);let n=`Statebot[${t}]`;if(!Qt(e))throw new TypeError(`
${n}: Please specify options for this machine`);let{chart:r=void 0,logLevel:i=3,historyLimit:a=2}=e||{},c=e.events===void 0?Qn(Qo()):Oa(e.events)&&Qn(e.events);if(!c)throw new TypeError(`
${n}: Invalid event-emitter specified in options`);let{states:u=[],routes:l=[]}=r?tr(r):e,{startIn:p=u[0]}=e;if(!u.includes(p))throw new Error(`${n}: Starting-state not in chart: "${p}"`);let d=Xn(`${n}#`),m=ri(i,console),{canWarn:g}=m,y=[p],b=Math.max(a,2),S=0,{pause:T,resume:N,paused:M,Pausable:V}=Pa(!1,()=>m.warn(`${n}: Ignoring callback, paused`)),Q=Qn(Qo()),j=V(Q.emit);function k(v,O){return Q.on(v,O),()=>Q.off(v,O)}let H=Zn(t,"states","Listening for the following state-changes",[...u]),Y=Zn(t,"transitions","Listening for the following transitions",[...l]),L=Zn(t,"events","Listening for the following events");function W(v,O){let R=jt(v)?v({enter:dt,emit:tt,Enter:Ht,Emit:kt}):Qt(v)?v:null;if(!Qt(R))throw new TypeError(`Statebot[${t}]#${O}(): Expected an object, or a function that returns an object`);let B=[],_=[],{transitionsForEvents:s,transitionsOnly:o}=Ba(R),f=Object.entries(s).reduce($,{}),h=di(o,g),E=Object.entries(f).map(I).concat(h.configs.map(w)).flat();if(g()){B.push(...h.states),_.push(...h.routes);let F=B.filter(Z=>!u.includes(Z)),Pt=_.filter(Z=>!l.includes(Z));F.length&&m.warn(`Statebot[${t}]#${O}(): Invalid states specified:
`+F.map(Z=>`  > "${Z}"`).join(`
`)),Pt.length&&m.warn(`Statebot[${t}]#${O}(): Invalid transitions specified:
`+Pt.map(Z=>`  > "${Z}"`).join(`
`))}return()=>E.map(F=>F());function w(F){let{fromState:Pt,toState:Z,action:at}=F,Gt=`${Pt}->${Z}`;return[Y.increase(Gt),k(Gt,at)]}function $(F,[Pt,Z]){let{states:at,routes:Gt,configs:vt}=di(Z,g);return g()&&(B.push(...at),_.push(...Gt)),{...F,[Pt]:vt}}function q({fromState:F,toState:Pt,action:Z,args:at}){return X(F,()=>(dt(Pt,...at),jt(Z)&&Z(...at),!0))}function I([F,Pt]){return[L.increase(F),it(F,(...Z)=>{Pt.map(Gt=>({...Gt,args:Z})).some(q)||U(`Event not handled: "${F}"`)})]}}function K(){return y[y.length-2]}function J(){return y[y.length-1]}function pt(...v){let O=v.flat(),R=d("canTransitionTo",{state:xt},O[0]);if(R)throw new TypeError(R);if(!O.length)return!1;let B=ut();return O.every(_=>B.includes(_))}function ut(v){let O=v!==void 0?v:J(),R=d("statesAvailableFromHere",{state:xt},O);if(R)throw new TypeError(R);return l.reduce((B,_)=>{let[s,o]=_.split(Pe).map(f=>f.trim());return s===O?[...B,o]:B},[])}function nt(v,O,...R){let B=J()===v;return O===void 0?B:B?jt(O)?O(...R):O:null}function P(v,...O){let R=Object.entries(v).find(([B])=>nt(B));return R?nt(...R.concat(O)):null}function X(...v){let O=d("inState",{state:[xt,Qt]},v[0]);if(O)throw new TypeError(O);return Qt(v[0])?P(...v):nt(...v)}let tt=V((v,...O)=>{let R=d("emit",{eventName:xt},v);if(R)throw new TypeError(R);return c.emit(v,...O)}),dt=V((v,...O)=>{let R=d("enter",{state:xt},v);if(R)throw new TypeError(R);let B=J(),_=v;if(_===B)return U(`Already in state: "${_}"`),!1;if(!u.includes(_))return U(`Invalid state "${_}", not switching`),!1;let s=`${B}->${_}`;return l.includes(s)?(m.info(`${n}: tId<${++S}>: ${s}`),y.push(_),y.length>b&&y.shift(),j(je[_e],_,B,...O),j(s,...O),j(je[Me],_,B,...O),!0):(U(`Invalid transition "${s}", not switching`),!1)});function it(v,O){let R=d("onEvent",{eventName:xt,cb:jt},v,O);if(R)throw new TypeError(R);return c.on(v,O),()=>c.off(v,O)}let Et=Object.keys(je).reduce((v,O)=>({...v,[O]:R=>{let B=d(O,{cb:jt},R);if(B)throw new TypeError(B);let _=H.increase(je[O]),s=k(je[O],R);return()=>{s(),_()}}}),{}),Tt=[[ui,_e],[fi,_e],[li,Me],[pi,Me]].reduce((v,O)=>{let[R,B]=O,_=R.slice(2),s=_.toLowerCase();return{...v,[R]:(o,f)=>{let h=d(R,{state:xt,cb:jt},o,f);if(h)throw new TypeError(h);let E=[H.increase(o),H.increase(`${o}:${s}`)],w=Et[B](($,q,...I)=>{_.indexOf("Exit")===0?o===q&&f($,...I):o===$&&f(q,...I)});return()=>{w(),E.map($=>$())}}}},{});function kt(v,...O){let R=d("Emit",{eventName:xt},v);if(R)throw new TypeError(R);return(...B)=>tt(v,...O,...B)}function Ht(v,...O){let R=d("Enter",{state:xt},v);if(R)throw new TypeError(R);return(...B)=>dt(v,...O,...B)}function ne(v,O,...R){return(...B)=>X(v,O,...R,...B)}function x(v,...O){return(...R)=>X(v,...O,...R)}function D(...v){let O=d("InState",{state:[xt,Qt]},v[0]);if(O)throw new TypeError(O);return Qt(v[0])?x(...v):ne(...v)}function C(){m.warn(`${n}: State-machine reset!`),y.length=0,y.push(p)}function U(v){let O=K(),R=J(),B=`${O===void 0?"[undefined]":O}->${R}`,_=ut();_.length?m.info(`${n}: ${v}
  > Previous transition: "${B}"
  > From "${R}", valid states are: [${_.map(s=>`"${s}"`).join(", ")}]`):m.info(`${n}: ${v}
  > Previous transition: "${B}"
  > There are no states available from "${R}"`)}function G(){return{states:H.refs(),transitions:Y.refs(),events:L.refs()}}function ft(){m.log(`${n}: Information about this state-machine`),Ct(H),Ct(Y),Ct(L)}function Ct(v){let{description:O,table:R}=v.toValue();m.log(O),R.length?m.table(R):m.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:pt,currentState:J,emit:tt,Emit:kt,enter:dt,Enter:Ht,history:()=>[...y],info:()=>ft(),inspect:()=>G(),inState:X,InState:D,name:()=>t,onEntered:Tt[pi],onEntering:Tt[fi],onEvent:it,onExited:Tt[li],onExiting:Tt[ui],onSwitched:Et[Me],onSwitching:Et[_e],onTransitions:v=>W(v,"onTransitions"),pause:T,paused:M,performTransitions:v=>W(v,"performTransitions"),previousState:K,reset:C,resume:N,statesAvailableFromHere:ut}}function Ba(t){let e={},n=[];return Object.entries(t).map(([r,i])=>{if(jt(i)){n.push({routeChart:r,action:i});return}if(!Qt(i))return;let{on:a,then:c}=i;if(xt(a)||ti(a)){[a].flat().map(p=>{e[p]=e[p]||[],e[p].push({routeChart:r,action:c})});return}jt(c)&&n.push({routeChart:r,action:i})}),{transitionsForEvents:e,transitionsOnly:n}}function di(t,e){let n=[],r=[];return{configs:t.reduce((a,c)=>{let{routeChart:u,action:l}=c,{states:p,routes:d,transitions:m}=tr(u);return e()&&(n.push(...p),r.push(...d)),[...a,...m.map(([g,y])=>({fromState:g,toState:y,action:l}))]},[]),states:n,routes:r}}function er(t){return Qt(t)&&typeof t.__STATEBOT__=="number"}var mi=Xn("statebot.");function Ha(t,e){let n=mi("routeIsPossible",{machine:er,route:en},t,e);if(n)throw TypeError(n);let r=ci(e);return r.every((i,a)=>{if(a===r.length-1)return!0;{let c=r[a+1];return t.statesAvailableFromHere(i).includes(c)}})}var hi=0;function Va(t,e,n){let r=mi("assertRoute",{machine:er,expectedRoute:en},t,e);if(r)throw TypeError(r);hi+=1;let{description:i="Assertion complete",fromState:a="",run:c=()=>{},permittedDeviations:u=0,timeoutInMs:l=1e3,logLevel:p=3}=n||{},d=ri(p),m=`Statebot[${t.name()}]: aId<${hi}>`,g=ci(e);d.log(`
${m}: Asserting route: [${g.join(" > ")}]`),d.log(`${m}: > Assertion will start from state: "${a}"`);let y=Ra(c),b=()=>{},S=nr(),T=nr(),N,M=0,V=!0,Q=!1,j=[...g],k=Ga(["state","expected","info","took"],["center","center","left","right"]),H=$a(W=>(Y("","","","TOTAL: "+S()),k.lock(),d.log(`
${m}: ${i}: [${W?"FAILED":"SUCCESS"}]`),d.table(k.content()),W)),{addRow:Y}=k;function L(W){if(V)Y(W,"-","PENDING");else{let K=j[0];K===W?(Y(W,K,Q?"REALIGNED":"OKAY",T()),Q=!1,j.shift()):(Y(W,K,"WRONG STATE",T()),Q=!0,M+=1),T=nr()}}return new Promise((W,K)=>{if(j.length===0){K(H(new Error("NO ROUTE TO TEST")));return}let J=(...tt)=>{clearTimeout(N),b(),X(),W(...tt)},pt=tt=>{clearTimeout(N),b(),X(),K(tt)},ut=tt=>{for(;j.length;){let dt=j.shift();Y(t.currentState(),`(${dt})`,tt),Q=!1}pt(H(new Error(tt)))};t.inState(a)&&(V=!1,b=y());let{revoke:nt,fn:P}=ni(tt=>{N=setTimeout(()=>{nt(),ut("TIMEOUT")},l),L(tt),V&&tt===a&&(V=!1,b=y()),M>u&&(nt(),ut("TOO MANY DEVIATIONS")),j.length<=0&&(nt(),J(H()))}),X=t.onSwitching(P)})}function Ga(t,e){t=t||[],e=e||[];let n=[],r=t.map((p,d)=>e[d]||"center"),i=!1;function a(){i=!0}function c(...p){if(i)return;let d=t.reduce((m,g,y)=>{let b=p[y]||"";return{...m,[g]:b}},{});n.push(d)}function u(){return n.reduce((p,d)=>t.map((m,g)=>Math.max(d[m].length,p[g])),t.map(()=>0))}function l(){let p=u();function d(g,y){let b=p[y],S=r[y];return S==="left"?g.padEnd(b):S==="right"?g.padStart(b):g}return n.reduce((g,y)=>{let b=t.reduce((S,T,N)=>({...S,[T]:d(y[T],N)}),{});return[...g,b]},[])}return{lock:a,addRow:c,content:l}}function nr(){let t=Date.now();function e(n,r){return n.toFixed(r).replace(/\.0+$/,"")}return function(){let n=Date.now()-t;return n<500?`${e(n)} ms`:n<5e3?`${e(n/1e3,2)} s `:n<6e4?`${e(n/1e3,1)} s `:`${e(n/1e3/60,1)} m `}}ue.Statebot=za;ue.assertRoute=Va;ue.decomposeChart=tr;ue.isStatebot=er;ue.routeIsPossible=Ha});var yi=ot((Ju,rr)=>{"use strict";typeof process!="undefined"?rr.exports=Xo():rr.exports=gi()});var Ue=qt(oe());var Ui=qt(we()),ur=qt(vn());var z={FIRST_RUN:"first-run",STORE_HYDRATED:"ui/store-hydrated",STORE_UPDATED:"ui/store-updated",ui:{RENDERING:"ui/rendering",RENDERED:"ui/rendered",TOGGLE_OPEN:"ui/toggle-open",FIND_ACCOUNTS:"ui/find-accounts",FIND_STATEMENTS:"ui/find-statements",VIEW_STATEMENTS:"ui/view-statements",DOWNLOAD_STATEMENTS:"ui/download-statements",DOWNLOADED_STATEMENTS:"ui/downloaded-statements",UPDATE_PROGRESS_BAR:"ui/update-progress-bar",STATEMENTS_WINDOW_READY:"ui/statements-window-ready",STATEMENTS_WINDOW_CLOSED:"ui/statements-window-closed",CLOSE_STATEMENTS_WINDOW:"ui/close-statements-window",CHANGE_STATEMENT:"ui/change-statement"},get:{ACCOUNTS:"get/accounts",STATEMENTS:"get/statements",ENTRIES:"get/entries"},error:{ACCOUNTS:"error/accounts",STATEMENTS:"error/statements",ENTRIES:"error/entries"},got:{ACCOUNTS:"got/accounts",STATEMENTS:"got/statements",ENTRIES:"got/entries"},add:{ACCOUNTS:"add/accounts",STATEMENTS:"add/statements",ENTRIES:"add/entries"},update:{ACCOUNTS:"update/accounts",STATEMENTS:"update/statements",ENTRIES:"update/entries"}};function Vt(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(!1)var i,a;throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(c){return"'"+c+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function de(t){return!!t&&!!t[Ft]}function ie(t){return!!t&&(function(e){if(!e||typeof e!="object")return!1;var n=Object.getPrototypeOf(e);if(n===null)return!0;var r=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return typeof r=="function"&&Function.toString.call(r)===Ls}(t)||Array.isArray(t)||!!t[no]||!!t.constructor[no]||Nn(t)||An(t))}function Ne(t,e,n){n===void 0&&(n=!1),me(t)===0?(n?Object.keys:On)(t).forEach(function(r){n&&typeof r=="symbol"||e(r,t[r],t)}):t.forEach(function(r,i){return e(i,r,t)})}function me(t){var e=t[Ft];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Nn(t)?2:An(t)?3:0}function Dn(t,e){return me(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Us(t,e){return me(t)===2?t.get(e):t[e]}function ro(t,e,n){var r=me(t);r===2?t.set(e,n):r===3?(t.delete(e),t.add(n)):t[e]=n}function qs(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function Nn(t){return Bs&&t instanceof Map}function An(t){return zs&&t instanceof Set}function se(t){return t.o||t.t}function xn(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Hs(t);delete e[Ft];for(var n=On(e),r=0;r<n.length;r++){var i=n[r],a=e[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function Cn(t,e){return e===void 0&&(e=!1),In(t)||de(t)||!ie(t)||(me(t)>1&&(t.set=t.add=t.clear=t.delete=Gs),Object.freeze(t),e&&Ne(t,function(n,r){return Cn(r,!0)},!0)),t}function Gs(){Vt(2)}function In(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function Jt(t){var e=Vs[t];return e||Vt(18,t),e}function oo(){return Ae}function Rn(t,e){e&&(Jt("Patches"),t.u=[],t.s=[],t.v=e)}function We(t){$n(t),t.p.forEach(Ys),t.p=null}function $n(t){t===Ae&&(Ae=t.l)}function io(t){return Ae={p:[],l:Ae,h:t,m:!0,_:0}}function Ys(t){var e=t[Ft];e.i===0||e.i===1?e.j():e.g=!0}function Pn(t,e){e._=e.p.length;var n=e.p[0],r=t!==void 0&&t!==n;return e.h.O||Jt("ES5").S(e,t,r),r?(n[Ft].P&&(We(e),Vt(4)),ie(t)&&(t=Ke(e,t),e.l||Je(e,t)),e.u&&Jt("Patches").M(n[Ft],t,e.u,e.s)):t=Ke(e,n,[]),We(e),e.u&&e.v(e.u,e.s),t!==so?t:void 0}function Ke(t,e,n){if(In(e))return e;var r=e[Ft];if(!r)return Ne(e,function(a,c){return ao(t,r,e,a,c,n)},!0),e;if(r.A!==t)return e;if(!r.P)return Je(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=xn(r.k):r.o;Ne(r.i===3?new Set(i):i,function(a,c){return ao(t,r,i,a,c,n)}),Je(t,i,!1),n&&t.u&&Jt("Patches").R(r,n,t.u,t.s)}return r.o}function ao(t,e,n,r,i,a){if(de(i)){var c=Ke(t,i,a&&e&&e.i!==3&&!Dn(e.D,r)?a.concat(r):void 0);if(ro(n,r,c),!de(c))return;t.m=!1}if(ie(i)&&!In(i)){if(!t.h.F&&t._<1)return;Ke(t,i),e&&e.A.l||Je(t,i)}}function Je(t,e,n){n===void 0&&(n=!1),t.h.F&&t.m&&Cn(e,n)}function _n(t,e){var n=t[Ft];return(n?se(n):t)[e]}function co(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function Mn(t){t.P||(t.P=!0,t.l&&Mn(t.l))}function jn(t){t.o||(t.o=xn(t.t))}function kn(t,e,n){var r=Nn(e)?Jt("MapSet").N(e,n):An(e)?Jt("MapSet").T(e,n):t.O?function(i,a){var c=Array.isArray(i),u={i:c?1:0,A:a?a.A:oo(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},l=u,p=Xe;c&&(l=[u],p=Qe);var d=Proxy.revocable(l,p),m=d.revoke,g=d.proxy;return u.k=g,u.j=m,g}(e,n):Jt("ES5").J(e,n);return(n?n.A:oo()).p.push(r),r}function Ws(t){return de(t)||Vt(22,t),function e(n){if(!ie(n))return n;var r,i=n[Ft],a=me(n);if(i){if(!i.P&&(i.i<4||!Jt("ES5").K(i)))return i.t;i.I=!0,r=uo(n,a),i.I=!1}else r=uo(n,a);return Ne(r,function(c,u){i&&Us(i.t,c)===u||ro(r,c,e(u))}),a===3?new Set(r):r}(t)}function uo(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return xn(t)}var fo,Ae,Fn=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",Bs=typeof Map!="undefined",zs=typeof Set!="undefined",lo=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",so=Fn?Symbol.for("immer-nothing"):((fo={})["immer-nothing"]=!0,fo),no=Fn?Symbol.for("immer-draftable"):"__$immer_draftable",Ft=Fn?Symbol.for("immer-state"):"__$immer_state",Fc=typeof Symbol!="undefined"&&Symbol.iterator||"@@iterator";var Ls=""+Object.prototype.constructor,On=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Hs=Object.getOwnPropertyDescriptors||function(t){var e={};return On(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},Vs={},Xe={get:function(t,e){if(e===Ft)return t;var n=se(t);if(!Dn(n,e))return function(i,a,c){var u,l=co(a,c);return l?"value"in l?l.value:(u=l.get)===null||u===void 0?void 0:u.call(i.k):void 0}(t,n,e);var r=n[e];return t.I||!ie(r)?r:r===_n(t.t,e)?(jn(t),t.o[e]=kn(t.A.h,r,t)):r},has:function(t,e){return e in se(t)},ownKeys:function(t){return Reflect.ownKeys(se(t))},set:function(t,e,n){var r=co(se(t),e);if(r==null?void 0:r.set)return r.set.call(t.k,n),!0;if(!t.P){var i=_n(se(t),e),a=i==null?void 0:i[Ft];if(a&&a.t===n)return t.o[e]=n,t.D[e]=!1,!0;if(qs(n,i)&&(n!==void 0||Dn(t.t,e)))return!0;jn(t),Mn(t)}return t.o[e]===n&&typeof n!="number"||(t.o[e]=n,t.D[e]=!0,!0)},deleteProperty:function(t,e){return _n(t.t,e)!==void 0||e in t.t?(t.D[e]=!1,jn(t),Mn(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=se(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty:function(){Vt(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){Vt(12)}},Qe={};Ne(Xe,function(t,e){Qe[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Qe.deleteProperty=function(t,e){return Xe.deleteProperty.call(this,t[0],e)},Qe.set=function(t,e,n){return Xe.set.call(this,t[0],e,n,t[0])};var Ks=function(){function t(n){var r=this;this.O=lo,this.F=!0,this.produce=function(i,a,c){if(typeof i=="function"&&typeof a!="function"){var u=a;a=i;var l=r;return function(y){var b=this;y===void 0&&(y=u);for(var S=arguments.length,T=Array(S>1?S-1:0),N=1;N<S;N++)T[N-1]=arguments[N];return l.produce(y,function(M){var V;return(V=a).call.apply(V,[b,M].concat(T))})}}var p;if(typeof a!="function"&&Vt(6),c!==void 0&&typeof c!="function"&&Vt(7),ie(i)){var d=io(r),m=kn(r,i,void 0),g=!0;try{p=a(m),g=!1}finally{g?We(d):$n(d)}return typeof Promise!="undefined"&&p instanceof Promise?p.then(function(y){return Rn(d,c),Pn(y,d)},function(y){throw We(d),y}):(Rn(d,c),Pn(p,d))}if(!i||typeof i!="object")return(p=a(i))===so?void 0:(p===void 0&&(p=i),r.F&&Cn(p,!0),p);Vt(21,i)},this.produceWithPatches=function(i,a){return typeof i=="function"?function(l){for(var p=arguments.length,d=Array(p>1?p-1:0),m=1;m<p;m++)d[m-1]=arguments[m];return r.produceWithPatches(l,function(g){return i.apply(void 0,[g].concat(d))})}:[r.produce(i,a,function(l,p){c=l,u=p}),c,u];var c,u},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){ie(n)||Vt(8),de(n)&&(n=Ws(n));var r=io(this),i=kn(this,n,void 0);return i[Ft].C=!0,$n(r),i},e.finishDraft=function(n,r){var i=n&&n[Ft],a=i.A;return Rn(a,r),Pn(void 0,a)},e.setAutoFreeze=function(n){this.F=n},e.setUseProxies=function(n){n&&!lo&&Vt(20),this.O=n},e.applyPatches=function(n,r){var i;for(i=r.length-1;i>=0;i--){var a=r[i];if(a.path.length===0&&a.op==="replace"){n=a.value;break}}var c=Jt("Patches").$;return de(n)?c(n,r):this.produce(n,function(u){return c(u,r.slice(i+1))})},t}(),Lt=new Ks,he=Lt.produce,Lc=Lt.produceWithPatches.bind(Lt),Uc=Lt.setAutoFreeze.bind(Lt),qc=Lt.setUseProxies.bind(Lt),Bc=Lt.applyPatches.bind(Lt),zc=Lt.createDraft.bind(Lt),Hc=Lt.finishDraft.bind(Lt);(function(){if(typeof window.CustomEvent=="function")return!1;function t(e,n){n=n||{bubbles:!1,cancelable:!1,detail:null};let r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),r}window.CustomEvent=t})();var Zt=function(){let t;try{t=window}catch(l){t=self}let e="message-bus",n=new Map;function r(l,...p){let d={eventName:l,args:p,timestamp:Date.now()},m=new CustomEvent(e,{detail:d});t.dispatchEvent(m)}function i(l,p){if(typeof p!="function")throw new TypeError("Callback is not a function");let d=n.has(l)?n.get(l):n.set(l,new Map).get(l);if(d.has(p))throw new Error("Callback already deals with this event");let m=typeof l=="string"&&l.indexOf("*")===-1,g=typeof l=="string"?c(l):l instanceof RegExp?l:null;if(g===null){let b="Could not figure-out eventNameOrPattern";throw new Error(`${b} = ${l}`)}let y=b=>{let{eventName:S,args:T}=b.detail;g.test(S)&&(m?p(...T):p(S,...T))};return d.set(p,y),t.addEventListener(e,y),()=>a(l,p)}function a(l,p){if(typeof p!="function")throw new TypeError("Callback is not a function");if(!n.has(l))throw new Error("No event-listener for that name/pattern");let d=n.get(l);if(!d.has(p))throw new Error("Event callback not found for name/pattern");let m=d.get(p);t.removeEventListener(e,m),d.delete(p)}function c(l){if(!l.length)throw new Error("String should not be empty");let p=l.split("*").map(m=>m.trim()).map(u),d=p.join(".*");return p.length===1?d=`^${d}$`:(p[0]!==""&&(d=`^${d}`),p[p.length-1]!==""&&(d=`${d}$`)),new RegExp(d)}function u(l){return l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return{emit:r,on:i,off:a}}();function Js(t){return Ze(t)&&te(t.emit)&&(te(t.addListener)||te(t.on))&&(te(t.removeListener)||te(t.off))}Js.displayName="isEventEmitter";function Nt(t){return t==null}Ln.displayName="isUnset";function Ln(t){return Array.isArray(t)}Ln.displayName="isArray";function po(t){if(!Ze(t))return!1;let e=te(t.map),n=$t(t.length);return t.__proto__===Object.prototype&&n&&!e}po.displayName="isArguments";function te(t){return typeof t=="function"}te.displayName="isFunction";function et(t){return typeof t=="string"}et.displayName="isString";function $t(t){return typeof t=="number"}$t.displayName="isNumber";function Ze(t){return typeof t=="object"&&t!==null}Ze.displayName="isObject";function Xs(t){return t===null||!Ze(t)?!1:Object.getPrototypeOf(t)===Object.prototype}Xs.displayName="isPojo";function Qs(t){return et(t)?!0:Ln(t)?t.every(et):!1}Qs.displayName="isTemplateLiteral";var Zs=(t,e,n)=>e(n)?void 0:(e.displayName||e.name)+`(${t}) did not return true`,ta=(t,e,n)=>typeof n===e?void 0:`Argument "${t}" should be a ${e}`,ea=t=>(e,n)=>{if(n>=t.length)return;let{argName:r,argType:i}=t[n];if(e===void 0)return`Argument undefined: "${r}"`;let a=Array.isArray(i)?i:[i],c=a.map(p=>te(p)?Zs(r,p,e):ta(r,p,e)).filter(et);if(a.length>1?c.length>1:c.length)return c.join(`
| `)+`
> typeof ${r} === ${typeof e}(${JSON.stringify(e)})`};function na(t){return e=>{let n=Object.entries(e).map(([r,i])=>({argName:r,argType:i}));return r=>(...i)=>{let c=Array.from(i,l=>po(l)?Array.from(l):l).flat(1).map(ea(n)).filter(et);if(!c.length)return;let u=Object.keys(e).join(", ");return`
${t||""}${r}(${u}):
${c.map(l=>`| ${l}`).join(`
`)}`}}}function mo(t){return e=>{let n=Object.keys(e),r=na(t)(e);return i=>a=>{let c=ra(a,{keys:n});return r(i)(...c)}}}function ra(t,e){let{keys:n}=e;return Array.isArray(n)?n.reduce((r,i)=>[...r,t[i]],[]):Object.values(t)}var oa=10,ge=[{accounts:[],statements:[],entries:[]}];function ia(t){ye(t),Zt.emit(z.STORE_HYDRATED)}function gt(){return ge[ge.length-1]}gt.history=ge;gt.hydrate=ia;function ye(t){ge.push(t),ge.length>oa&&ge.shift(),Zt.emit(z.STORE_UPDATED)}var Oe=mo("store#");var sa=Oe({id:et,accountNumber:et,sortCode:et,name:[et,Nt],type:[et,Nt],iban:[et,Nt],bic:[et,Nt]})(z.add.ACCOUNTS),aa=Oe({id:et,accountNumber:[et,Nt],sortCode:[et,Nt],name:[et,Nt],type:[et,Nt],iban:[et,Nt],bic:[et,Nt]})(z.update.ACCOUNTS);Zt.on(z.add.ACCOUNTS,t=>{let e=gt(),n=he(e,r=>{t.forEach(i=>{let a=sa(i);if(a)throw TypeError(a);let c=r.accounts.find(u=>u.id===i.id);if(c){console.log("Account exists",c);return}r.accounts.push({...i})})});n!==e&&ye(n)});Zt.on(z.update.ACCOUNTS,t=>{let e=[],n=gt(),r=he(n,i=>{t.forEach(a=>{let c=aa(a);if(c)throw TypeError(c);let u=i.accounts.find(l=>l.id===a.id);if(!u){e.push(a);return}Object.entries(a).forEach(([l,p])=>{Nt(p)||(u[l]=p)})})});e.length&&console.log("Not updating unseen accounts: ",e),r!==n&&ye(r)});var ca=Oe({id:et,accountId:et,endDate:$t,startDate:[$t,Nt],startBalance:[$t,Nt],endBalance:[$t,Nt]})(z.add.STATEMENTS),ua=Oe({id:et,accountId:[et,Nt],endDate:$t,startDate:$t,startBalance:$t,endBalance:$t})(z.update.STATEMENTS);Zt.on(z.add.STATEMENTS,t=>{let e=[],n=gt(),r=he(n,i=>{t.forEach(a=>{let c=ca(a);if(c)throw TypeError(c);let u=i.statements.find(l=>l.id===a.id);if(u){e.push(u);return}i.statements.push({...a})})});e.length&&console.log("Not overwriting existing statements: ",e),r!==n&&ye(r)});Zt.on(z.update.STATEMENTS,t=>{let e=[],n=gt(),r=he(n,i=>{t.forEach(a=>{let c=ua(a);if(c)throw TypeError(c);let u=i.statements.find(l=>l.id===a.id);if(!u){e.push(a);return}Object.entries(a).forEach(([l,p])=>{Nt(p)||(u[l]=p)})})});e.length&&console.log("Not updating unseen statements: ",e),r!==n&&ye(r)});var fa=Oe({id:et,accountId:et,statementId:et,date:$t,type:et,payee:et,note:et,debit:$t,credit:$t,balance:$t})(z.add.ENTRIES);Zt.on(z.add.ENTRIES,t=>{let e=[],n=gt(),r=he(n,i=>{t.forEach(a=>{let c=fa(a);if(c)throw TypeError(c);let u=i.entries.find(l=>l.id===a.id);if(u){e.push(u);return}i.entries.push({...a})})});e.length&&console.log("Not overwriting existing entries: ",e),r!==n&&ye(r)});var zn=qt(vn());function At(t){return String(t).replace(/</g,"&lt;").replace(/>/g,"&gt;").trim()}function yt(t){return String(t).replace(/"/g,'""').replace(/\r\n|\r|\n/g," ").trim()}function Wt(t){return String(t).replace(/\r\n|\r|\n/g," ").trim()}function Un(t){let e=new Date(t);return String(Bt(e.getMonth()+1)+"/"+Bt(e.getDate())+"/"+e.getFullYear())}function De(t){let e=new Date(t);return String(Bt(e.getDate())+"/"+Bt(e.getMonth()+1)+"/"+e.getFullYear())}function xe(t){let e=new Date(t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return String(e.getDate()+" "+n[e.getMonth()]+" "+e.getFullYear())}function zt(t,e=""){let n=new Date(t);return[n.getFullYear(),Bt(n.getMonth()+1),Bt(n.getDate()),Bt(n.getHours()),Bt(n.getMinutes()),Bt(n.getSeconds())].join(e)}function Bt(t){return t<10?"0"+t:""+t}function rt(t){return!t||typeof t!="number"?"-":(t/100).toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}function ho(){return{id:"CSV",folder:"csv",extension:"csv",description:"CSV RFC4180 (Excel, Numbers)",generate:t=>{let e=['"Transaction ID","Date","Account type","Account number","Payee","Memo","Type","Amount"',""];return t.entries.forEach(n=>{let{debit:r,credit:i,id:a,date:c,payee:u,note:l,type:p}=n,d=rt(r+i);e.push('"'+yt(a)+'","'+yt(xe(c))+'","'+yt(t.type)+'","'+yt(t.sortCode+" "+t.accountNumber)+'","'+yt(u)+'","'+yt(l||"")+'","'+yt(p)+'","'+yt(d)+'"')}),e.push(""),e.join(`\r
`)}}}function qn(t,e){if(!t)return"";for(t=""+t;t.length<e;)t=t+" ";return t.length>e&&(t.length=e),t}function go(){return{id:"HSBC",folder:"hsbc-legacy",extension:"csv",description:"CSV Legacy HSBC (\xE0 la Recent Transactions)",generate:t=>{let e=[];return t.entries.forEach(n=>{let{debit:r,credit:i,id:a,date:c,payee:u,note:l,type:p}=n,d=rt(r+i);e.push('"'+yt(De(c))+'","'+yt(qn(u,25)+qn(l||"",25)+p)+'","'+yt(d)+'"')}),e.push(""),e.join(`\r
`)}}}function yo(){return{id:"JSON",folder:"json",extension:"json",description:"JSON (JavaScript Object Notation)",generate:t=>JSON.stringify(t,(e,n)=>{if(["debit","credit","balance"].indexOf(e)!==-1){let r=parseFloat(rt(n));return isNaN(r)?e==="balance"?void 0:0:r}return n},2)}}function ae(t){return t?function(n,r){return+n[t]-+r[t]}:function(n,r){return+n-+r}}function Eo(){return{id:"MIDATA",folder:"midata",extension:"csv",description:"midata (non-standard, CSV)",generate:t=>{let n=(t.balances||[{date:0,balance:0}]).sort(ae("date"))[0].balance,r=[" Date,Type,Merchant/Description,Debit/Credit,Balance",""];return t.entries.forEach(i=>{let{debit:a,credit:c,date:u,type:l,payee:p,note:d}=i,m=a+c;n+=m,r.push('"'+yt(De(u))+'","'+yt(l)+'","'+yt(p+(d||""))+'","'+yt(rt(m))+'","'+yt(rt(n))+'"')}),r.push("","Arranged overdraft limit,"+yt(De(t.date))+",\xA30.00",""),r.join(`\r
`)}}}var Bn={INTU_BID:"01267",LANGUAGE:"ENG",CURDEF:"GBP"};function bo(){return{id:"OFX",folder:"ofx",extension:"ofx",description:"OFX 1.0.2 (Money, Quicken)",generate:t=>{let e,n=t.balances.length-1;function r(a){switch(a){case"ATM":break;case"TFR":a="XFER";break;default:a="OTHER"}return a}e=`OFXHEADER:100
DATA:OFXSGML
VERSION:102
SECURITY:NONE
ENCODING:USASCII
CHARSET:1252
COMPRESSION:NONE
OLDFILEUID:NONE
NEWFILEUID:NONE

<OFX>

	<SIGNONMSGSRSV1>
		<SONRS>
			<STATUS>
				<CODE>0</CODE>
				<SEVERITY>INFO</SEVERITY>
			</STATUS>
			<DTSERVER>`+At(zt(new Date))+`</DTSERVER>
			<LANGUAGE>`+At(Bn.LANGUAGE)+`</LANGUAGE>
			<INTU.BID>`+At(Bn.INTU_BID)+`</INTU.BID>
		</SONRS>
	</SIGNONMSGSRSV1>

	<BANKMSGSRSV1>

		<STMTTRNRS>

			<TRNUID>1</TRNUID>

			<STATUS>
				<CODE>0</CODE>
				<SEVERITY>INFO</SEVERITY>
			</STATUS>

			<STMTRS>

				<CURDEF>`+At(Bn.CURDEF)+`</CURDEF>

				<BANKACCTFROM>
					<BANKID>`+At(t.sortCode)+`</BANKID>
					<ACCTID>`+At(t.sortCode+t.accountNumber)+`</ACCTID>
					<ACCTTYPE>CHECKING</ACCTTYPE>
				</BANKACCTFROM>

				<BANKTRANLIST>

					<DTSTART>`+At(zt(t.balances[0].date))+`</DTSTART>
					<DTEND>`+At(zt(t.balances[n].date))+`</DTEND>

`,t.entries.forEach(a=>{let{debit:c,credit:u,type:l,date:p,id:d,payee:m,note:g}=a,y=rt(c+u);e+=`					<STMTTRN>
						<TRNTYPE>`+At(r(l))+`</TRNTYPE>
						<DTPOSTED>`+At(zt(p))+`</DTPOSTED>
						<TRNAMT>`+At(y)+`</TRNAMT>
						<FITID>`+At(d)+`</FITID>
						<NAME>`+At(m)+`</NAME>
`+(g?"						<MEMO>"+At(g)+`</MEMO>
`:"")+`					</STMTTRN>

`});let i=t.balances[n].balance;return e+=`				</BANKTRANLIST>

				<LEDGERBAL>
					<BALAMT>`+At(rt(i))+`</BALAMT>
					<DTASOF>`+At(zt(t.balances[n].date))+`</DTASOF>
				</LEDGERBAL>

			</STMTRS>
		</STMTTRNRS>
	</BANKMSGSRSV1>

</OFX>
`,e}}}function So(){return{id:"QIF",folder:"qif",extension:"qif",description:"QIF (Quicken)",generate:t=>{let e,n=t.balances.length-1;return e=`!Account
N`+Wt(t.type)+`
A`+Wt(t.sortCode+"/"+t.sortCode+t.accountNumber)+`
/`+Wt(Un(t.balances[n].date))+`
$`+Wt(rt(t.balances[n].balance))+`
TBank
^
!Type:Bank
`,t.entries.forEach(r=>{let{debit:i,credit:a,id:c,date:u,payee:l,note:p,type:d}=r,m=rt(i+a);e+="D"+Wt(Un(u))+`
N`+Wt(i+a<0?"WITHD":"DEP")+`
T`+Wt(m)+`
C
P`+Wt(l)+`
`+(p?"M"+Wt(p)+`
`:"")+`^
`}),e+=`
`,e}}}var{SparkMD5:la}=obis.deps;function To(t){return la.hash(t)}function wo(){return[ho(),go(),yo(),Eo(),bo(),So()]}function vo(t){let{date:e,debit:n,credit:r,index:i,accountNumber:a,sortCode:c,type:u,payee:l,note:p}=t,d=zt(e)||"UNKNOWN_DATE",m=rt(n+r);return d+"_"+To(d+(i!==void 0?i:"")+(a||"")+(c||"")+(u||"")+(l||"")+(p||"")+m)}function Ao(){let{accounts:t,statements:e,entries:n}=gt();return e.reduce((i,a)=>{let c=t.find(S=>S.id===a.accountId),u=[No(a,"start"),No(a,"end")],l=n.filter(S=>S.statementId===a.id).map(S=>{let{id:T,date:N,type:M,payee:V,note:Q,debit:j,credit:k,balance:H}=S;return{id:T,date:N,type:M,payee:V,note:Q,debit:j,credit:k,balance:H}}),{iban:p,bic:d,type:m,name:g,accountNumber:y,sortCode:b}=c;return[...i,{id:`${p}_${zt(a.endDate)}`,iban:p,bic:d,type:m,name:g,accountNumber:y,sortCode:b,date:a.endDate,entries:l,balances:u}]},[])}function No(t,e){let n=e==="start"?"start":"end",r=n==="start"?"Opening":"Closing",i={debit:0,credit:0,balance:t[`${n}Balance`],date:t[`${n}Date`],payee:"",memo:`${r} balance this month`};return{id:vo(i),...i}}var{fflate:Oo,saveAs:pa}=obis.deps;function Do(){let{filename:t,content:e}=ma(),[n,r,i]=(0,zn.makePromise)();return Oo.zip(e,(a,c)=>{if(a){i(a);return}r(c)}),n.then(da).then(a=>{pa(a,t)})}function da(t){let[e,n]=(0,zn.makePromise)();return n(new Blob([t])),e}function ma(){let{filename:t,content:e}=ha();return{filename:t,content:e.reduce((n,{folder:r,files:i})=>({...n,[r]:i.reduce((a,{name:c,content:u})=>a[c]?a:{...a,[c]:Oo.strToU8(u)},{})}),{})}}function ha(){let t=Ao(),e=wo(),n=[],r;return e.forEach(i=>{let{generate:a,extension:c,folder:u}=i,l={folder:u,files:[]};t.forEach(p=>{let d=ga(p,c),m=a(p);l.files.push({name:d,content:m}),r||(r=ya(p))}),n.push(l)}),{filename:r,content:n}}function ga(t,e){let{date:n,type:r,sortCode:i,accountNumber:a}=t,c=new Date(n);return`${r} ${i} ${a}`.replace(/[^a-zA-Z0-9-]/g,"_")+"-"+c.getFullYear()+"-"+Bt(c.getMonth()+1)+"-"+Bt(c.getDate())+"."+e}function ya(t){let{date:e}=t,n=new Date(e);return"OBIS-Statements-"+n.getFullYear()+"-"+zt(new Date,"_")+".zip"}var St=qt(oe());var xo=qt(oe()),_t,Co=Function.prototype.call.bind(Function.prototype.call),Io=()=>xo.default.redraw(),Ro=t=>{let e=_t,n=e.depsIndex++,r=e.depsStates[n]||[],i=t===void 0?!0:Array.isArray(t)?t.length>0?!t.every((a,c)=>a===r[c]):!e.setup:!1;return t!==void 0&&(e.depsStates[n]=t),i},$o=(t=!1)=>(e,n)=>{let r=_t;if(Ro(n)){let a=r.depsIndex,c=()=>{let l=e();typeof l=="function"&&(r.teardowns.set(a,l),r.teardowns.set("_",Io))},u=r.teardowns.get(a);try{typeof u=="function"&&u()}finally{r.teardowns.delete(a)}r.updates.push(t?()=>new Promise(l=>requestAnimationFrame(l)).then(c):c)}},Hn=(t,e)=>{let n=_t,r=n.statesIndex++;return n.setup||(n.states[r]=t),[n.states[r],i=>{let a=n.states[r],c=e?e(i,r):i;n.states[r]=c,JSON.stringify(c)!==JSON.stringify(a)&&Io()},r]},st=t=>{let e=_t;return Hn(t,(r,i)=>typeof r=="function"?r(e.states[i],i):r)},Ot=$o(!0),Yu=$o();var Ee=(t,e)=>{let n=_t,r=Ro(e),[i,a]=n.setup?Hn():Hn(t());return n.setup&&r&&a(t()),i},bt=(t,e)=>Ee(()=>t,e),ct=(t,e)=>{let n=c=>{Object.assign(c.state,{setup:!1,states:[],statesIndex:0,depsStates:[],depsIndex:0,updates:[],cleanups:new Map,teardowns:new Map})},r=c=>{let u=_t;_t=c.state;try{c.state.updates.forEach(Co)}finally{Object.assign(c.state,{setup:!0,updates:[],depsIndex:0,statesIndex:0}),_t=u}};return{oninit:n,oncreate:r,onupdate:r,view:c=>{let u=_t;_t=c.state;try{return t({...e,...c.attrs,vnode:c,children:c.children})}catch(l){console.error(l)}finally{_t=u}},onremove:c=>{let u=_t;_t=c.state;try{[...c.state.teardowns.values()].forEach(Co)}finally{_t=u}}}};var Ei=qt(yi());function or(t){let[e,n]=st(t.currentState());return Ot(()=>{let r=!1,i=t.onSwitched(a=>{r||n(a)});return()=>{r=!0,i()}},[t]),e}function bi(t,e){let{bot:n,listeners:r}=Ee(()=>{let{performTransitions:a={},onTransitions:c={},...u}=e||{},l=(0,Ei.Statebot)(t,u),p=[l.performTransitions(a),l.onTransitions(c)];return{bot:l,listeners:p}},[]);return Ot(()=>()=>{typeof n.pause=="function"&&n.pause(),r.forEach(a=>a())},[n,r]),{state:or(n),bot:n}}function Si(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=Si(t[e]))&&(r&&(r+=" "),r+=n);else for(e in t)t[e]&&(r&&(r+=" "),r+=e);return r}function Yt(){for(var t=0,e,n,r="";t<arguments.length;)(e=arguments[t++])&&(n=Si(e))&&(r&&(r+=" "),r+=n);return r}var nn=qt(oe());var ir=qt(we()),Ya=ct(t=>{let{children:e}=t||{},{setRef:n=()=>{}}=t||{};return(0,nn.default)("div",{oncreate:r=>n(r.dom)},e)}),ee={TOGGLE_OPEN:"toggle-open",OPEN_FINISHED:"open-finished",CLOSE_FINISHED:"close-finished"},Wa=`
  closed -> opening -> opened
  opened -> closing -> closed
`,Ti=ct(t=>{let{children:e}=t||{},{opened:n=!1,durationInMs:r=250}=t||{},{state:i,bot:a}=bi("animated-close/open",{chart:Wa,startIn:n?"opened":"closed",logLevel:2,performTransitions:({Emit:g})=>({"closed -> opening":{on:ee.TOGGLE_OPEN,then:(0,ir.Delay)(g(ee.OPEN_FINISHED),r)},"opening -> opened":{on:ee.OPEN_FINISHED},"opened -> closing":{on:ee.TOGGLE_OPEN,then:(0,ir.Delay)(g(ee.CLOSE_FINISHED),r)},"closing -> closed":{on:ee.CLOSE_FINISHED}})}),[c,u]=st(!0);Ot(()=>{if(c){u(!1);return}let g=n?"opened":"closed",y=a.onSwitched(b=>{["opened","closed"].includes(b)&&b!==g&&a.emit(ee.TOGGLE_OPEN)});return a.emit(ee.TOGGLE_OPEN),y},[a,n]);let[l,p]=st(void 0),[d,m]=st(void 0);return Ot(()=>void(l&&m(l.scrollHeight)),[l,e]),(0,nn.default)("div",{className:`vertical-animation-container ${i}`,style:`max-height: ${d}px`},(0,nn.default)(Ya,{setRef:p},e))});var Ut=qt(oe());var wi=ct(t=>{let{children:e,hidden:n}=t||{};return(0,Ut.default)("div",{className:Yt("dialog",{hidden:n})},e)}),vi=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("h1",null,"OBIS | ",e)}),Ni=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("h2",null,e)}),ke=ct(t=>{let{children:e}=t||{},{className:n,handleClick:r,disabled:i}=t||{};return(0,Ut.default)("button",{className:n,onclick:r,disabled:i},e)}),Ai=ct(t=>{let{value:e,max:n=15,handleUpdate:r,disabled:i}=t||{};return(0,Ut.default)("input",{className:"fetch-slider",type:"range",min:"1",max:n,oninput:r,onchange:r,value:e,disabled:i})}),Oi=ct(t=>{let{value:e,max:n}=t||{};return(0,Ut.default)("progress",{value:e,max:n})}),Di=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("div",{className:"account"},e)}),xi=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("div",{className:"accounts"},e)}),Ci=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("div",{className:"statements-loaded"},e)}),Ii=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("div",{className:"years-loaded"},e)}),Ri=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("h3",{className:"account-name"},e)}),$i=ct(t=>{let{children:e}=t||{};return(0,Ut.default)("div",{className:"actions"},e)});var rn=qt(we());var{fetchMachine:be}=obis,{Statebot:Ka,messages:Ja}=obis.deps,{Emit:Fe}=be,Xa=10,Pi=3,_i=Ka("UI",{events:Ja,chart:`

    loading ->
    rendering-ui ->
      closed -> opened -> closed

  `,startIn:"loading",logLevel:2});_i.performTransitions({"loading -> rendering-ui":{on:z.ui.RENDERED,then:(0,rn.Delay)(Fe(z.FIRST_RUN),(0,rn.seconds)(.1))},"rendering-ui -> closed":{on:z.FIRST_RUN},"closed -> opened -> closed":{on:z.ui.TOGGLE_OPEN}});var on={max:0,value:0},Mi=ct(()=>{let t=or(_i),e=!["idle","loading"].includes(t),n=t==="closed",r=t==="opened",[i,a]=st(Pi),c=bt(Fe(z.ui.TOGGLE_OPEN),[]),u=bt(m=>{let g=parseInt(m?.target?.value,10);a(isNaN(g)?Pi:g)},[a]),l=bt(Fe(z.get.ACCOUNTS,i),[i]),p=bt(Fe(z.ui.VIEW_STATEMENTS),[]),d=bt(Fe(z.ui.DOWNLOAD_STATEMENTS),[]);return(0,St.default)(wi,{hidden:!e},e&&(0,St.default)(ke,{className:Yt("toggle-button",{opened:r,closed:n}),handleClick:c,disabled:!r&&!n},"\u21E7"),(0,St.default)(vi,null,obis.plugin.name),(0,St.default)(Ni,null,e?r?"Hit the button below to try and download everything automatically.":"Welcome! Click that button on the right to see if we can download some statements.":"Loading...",(0,St.default)("br",null),(0,St.default)("br",null),be.inState({"getting-accounts":"Finding accounts...","getting-statements":"Getting statements...","getting-entries":"Getting transactions..."}),(0,St.default)(Oi,{...on})),e&&(0,St.default)(Ti,{opened:r},(0,St.default)(xi,null,gt().accounts.map(m=>{let g=gt().statements.filter(b=>b.accountId===m.id).map(b=>new Date(b.endDate).getFullYear()),y=[...new Set(g)];return(0,St.default)(Di,{key:m.id},(0,St.default)(Ci,null,"Statements: ",g.length),(0,St.default)(Ii,null,y.join(" ")),(0,St.default)(Ri,null,m.sortCode," ",m.accountNumber))})),(0,St.default)($i,null,(0,St.default)(Ai,{max:Xa,value:i,handleUpdate:u,disabled:!be.inState("idle")}),(0,St.default)(ke,{handleClick:l,className:"fetch-everything",disabled:!be.inState("idle")},"Fetch ",i," ",i==1?"year":"years"),(0,St.default)(ke,{handleClick:p,disabled:!be.inState("found-entries")},"View statements"),(0,St.default)(ke,{handleClick:d,disabled:!be.inState("found-entries")},"Download all"))))});var A=qt(oe());var{messages:sr}=obis.deps;function Le(){let[t,e]=st(gt().accounts);return Ot(()=>{let n=sr.on(z.STORE_UPDATED,()=>{e(gt().accounts)});return()=>n()},[]),t}function ar(){let[t,e]=st(gt().statements);return Ot(()=>{let n=sr.on(z.STORE_UPDATED,()=>{let r=[...gt().statements].sort(ae("endDate")).reverse();e(r)});return()=>n()},[]),t}function ji(){let[t,e]=st(gt().entries);return Ot(()=>{let n=sr.on(z.STORE_UPDATED,()=>{let r=[...gt().entries].sort(ae("date")).reverse();e(r)});return()=>n()},[]),t}var Qa={sortCode:"",accountNumber:""};function ki(t){let e=Le(),[n,r]=st(),[i,a]=st();Ot(()=>{let g=e.find(T=>T.id===t),{sortCode:y,accountNumber:b}=g??Qa,S=`${y} ${b}`;r(g),a(S)},[e,t,r,a]);let c=ar(),u=Ee(()=>c.filter(g=>g.accountId===t),[c,t]),l=bt(()=>u[0]?.id,[u]),p=bt(g=>{let y=u.map((b,S)=>b.id===g?S:null).filter(b=>b!==null)[0];return u[Math.max(0,y-1)]?.id},[u]),d=bt(g=>{let y=u.map((b,S)=>b.id===g?S:null).filter(b=>b!==null)[0];return u[Math.min(u.length-1,y+1)]?.id},[u]),m=bt(g=>u.map(b=>({dateDelta:Math.abs(g-b.endDate),id:b.id})).sort(ae("dateDelta"))[0]?.id??l(),[u]);return{account:n,accountInfo:i,accountStatements:u,getNewest:l,getNewerThan:p,getOlderThan:d,getNearestToDate:m}}function cr(t){let e=ar(),{startDate:n,startBalance:r,endDate:i,endBalance:a}=Ee(()=>e.find(S=>S.id===t)??{},[e,t]),c=ji(),[u,l]=st([]),[p,d]=st(0),[m,g]=st(0),[y,b]=st(0);return Ot(()=>{let S=c.filter(V=>V.statementId===t);l(S);let T=S.reduce((V,Q)=>V+Q.debit,0),N=S.reduce((V,Q)=>V+Q.credit,0),M=N-T;d(isNaN(T)?0:T),g(isNaN(N)?0:N),b(isNaN(M)?0:M)},[t,c,l]),{entries:u,startDate:n,startBalance:r,endDate:i,endBalance:a,totalDebit:p,totalCredit:m,creditDebitDiff:y}}function Fi(){let t=window.open("text/html","obis","width=1000,height=750,menubar=0,toolbar=0,status=0,scrollbars=1,resizable=1");return t.document.writeln(`
    <html>
      <head>
        <title>Statements</title>
        <style type="text/css">
          @import url('${obis.rootPath}/statement.css');
        </style>
      </head>
      <body
        onload="opener.messages.emit('${z.ui.STATEMENTS_WINDOW_READY}');"
        onunload="opener.messages.emit('${z.ui.STATEMENTS_WINDOW_CLOSED}');"
      >
      </body>
    </html>
  `),t.document.close(),t}var Za=ct(t=>{let{children:e=[]}=t||{};return e}),tc=ct(t=>{let{selectedAccountId:e,handleClick:n}=t,r=Le(),i=bt(a=>{let c=a?.path.map(u=>u?.dataset?.account).filter(Boolean)[0];n(c)},[n]);return r.map(a=>(0,A.default)("div",{onclick:i,key:a.id,"data-account":a.id,className:Yt("account",{selected:a.id===e})},(0,A.default)("div",{className:"statements-loaded"}),(0,A.default)("div",{className:"years-loaded"}),(0,A.default)("div",{className:"account-name"},a.sortCode," ",a.accountNumber)))}),ec=ct(t=>{let{children:e=[]}=t||{};return e}),nc=ct(t=>{let e="Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec".split("|"),{selectedMonth:n,months:r=[],handleClick:i}=t||{},a=bt(c=>i(c?.target?.dataset?.month),[i]);return e.map((c,u)=>(0,A.default)("div",{onclick:a,key:c,"data-month":u,className:Yt("month",{selected:u===n,"no-entries":!r.includes(u)})},c))}),rc=ct(t=>{let{selectedYear:e,years:n=[],handleClick:r}=t||{},i=bt(a=>r(a?.target?.dataset?.year),[r]);return n.map(a=>(0,A.default)("div",{onclick:i,key:a,"data-year":a,className:Yt("year",{selected:a==e})},a))}),oc=ct(t=>{let{selectedStatementId:e}=t,{entries:n,startBalance:r,endBalance:i}=cr(e),a=0,c=0,u=r??0,l=n.map(d=>{let{id:m,date:g,type:y,payee:b,note:S,debit:T,credit:N,balance:M}=d;return c-=T,a+=N,u+=N-T,(0,A.default)("tr",{key:m},(0,A.default)("td",{className:"no-wrap"},xe(g)),(0,A.default)("td",null,y),(0,A.default)("td",null,b),(0,A.default)("td",null,S),(0,A.default)("td",{className:"currency"},rt(T)),(0,A.default)("td",{className:"currency"},rt(N)),(0,A.default)("td",{className:Yt("currency",{negative:M<0})},rt(M)),(0,A.default)("td",{className:Yt("currency",{negative:u<0})},rt(u)))}),p;return l.length||(p=(0,A.default)("tr",null,(0,A.default)("td",{className:"no-wrap no-entries",colspan:"8"},"No entries for this period"))),(0,A.default)("table",{className:"statement"},(0,A.default)("thead",null,(0,A.default)("tr",{className:"table-header"},(0,A.default)("th",null,"Date"),(0,A.default)("th",null,"Type"),(0,A.default)("th",null,"Description"),(0,A.default)("th",null,"Memo"),(0,A.default)("th",null,"Debit"),(0,A.default)("th",null,"Credit"),(0,A.default)("th",null,"Balance"),(0,A.default)("th",null,"(Calculated)"))),(0,A.default)("tbody",null,l.length?l:p),(0,A.default)("tfoot",null,(0,A.default)("tr",{className:"table-footer"},(0,A.default)("th",null,"\xA0"),(0,A.default)("th",null,"\xA0"),(0,A.default)("th",null,"\xA0"),(0,A.default)("th",null,"\xA0"),(0,A.default)("th",{className:"currency"},rt(c)),(0,A.default)("th",{className:"currency"},rt(a)),(0,A.default)("th",{className:"currency"},rt(i)),(0,A.default)("th",{className:"currency"},rt(u)))))}),Li=ct(()=>{let t=Le(),[e,n]=st(t[0]?.id),{accountInfo:r,accountStatements:i,getNewest:a,getNewerThan:c,getOlderThan:u,getNearestToDate:l}=ki(e),[p,d]=st(a()),[m,g]=st(i.find(P=>P.id===p)?.endDate);Ot(()=>{let P=i.find(X=>X.id===p);if(P)g(P.endDate);else{let X=l(m);d(X)}},[i,p,m,d,g,l]);let y=new Date(m),[b,S]=st(y.getMonth()),[T,N]=st(y.getFullYear());Ot(()=>{let P=new Date(m);S(P.getMonth()),N(P.getFullYear())},[m]);let[M,V]=st([]),[Q,j]=st([]);Ot(()=>{let P=i.map(it=>new Date(it.endDate).getFullYear()),X=[...new Set(P)],tt=i.filter(it=>new Date(it.endDate).getFullYear()==T).map(it=>new Date(it.endDate).getMonth()),dt=[...new Set(tt)];V(X),j(dt)},[i,m,T]);let k=cr(p),{totalDebit:H,totalCredit:Y,creditDebitDiff:L}=k,W=bt(P=>n(P),[n]),K=bt(()=>d(a()),[d,a]),J=bt(()=>d(u(p)),[d,u,p]),pt=bt(()=>d(c(p)),[d,c,p]),ut=P=>{let X=new Date(m);X.setMonth(P),d(l(X))},nt=P=>{let X=new Date(m);X.setFullYear(P),d(l(X))};return(0,A.default)("div",{className:"grid-container"},(0,A.default)("div",{className:"header"},(0,A.default)("div",{className:"info-and-accounts"},(0,A.default)("div",{className:"info"},(0,A.default)(Za,null,(0,A.default)("h1",null,"OBIS | Statements Browser"),(0,A.default)("h2",null,r," \u2022"," ",!isNaN(m)&&xe(m)),(0,A.default)("div",{className:"balance-summary"},Y>0&&(0,A.default)("span",null,rt(Y)," in"),H>0&&(0,A.default)("span",null,rt(H)," out"),L!==0&&(0,A.default)("span",{className:Yt({black:L>0,red:L<0})},L<=0?"\u{1F4C9} ":"\u{1F4C8} ",rt(L))))),(0,A.default)("div",{className:"accounts"},(0,A.default)(tc,{selectedAccountId:e,handleClick:W}))),(0,A.default)("div",{className:"cursor-and-months"},(0,A.default)("div",{className:"months"},(0,A.default)(nc,{months:Q,selectedMonth:b,handleClick:ut})),(0,A.default)("div",{className:"cursor"},(0,A.default)(ec,null,(0,A.default)("div",{onclick:J},"Older"),(0,A.default)("div",{onclick:K},"\u2022"),(0,A.default)("div",{onclick:pt},"Newer"))))),(0,A.default)("div",{className:"main"},(0,A.default)(oc,{selectedStatementId:p})),(0,A.default)("div",{className:"years"},(0,A.default)("div",null,(0,A.default)(rc,{years:M,selectedYear:T,handleClick:nt}))),(0,A.default)("div",{className:"spacing"}))});var{fetchMachine:qi}=obis,{messages:Bi}=obis.deps,{on:qe,emit:ic}=Bi,{Emit:zi}=qi;window.store=gt;window.actions=z;window.messages=Bi;function sc(){let t=Fi();Ue.default.mount(t.document.body,Li);let e=qe(z.ui.CLOSE_STATEMENTS_WINDOW,()=>{e(),t.close()})}qe(z.ui.VIEW_STATEMENTS,sc);qe(z.ui.DOWNLOAD_STATEMENTS,()=>{Do().finally(()=>(0,ur.delay)((0,Ui.seconds)(3))).finally(zi(z.ui.DOWNLOADED_STATEMENTS))});function cc(){ic(z.ui.RENDERING,Ue.default);let t=document.querySelector("#obis-root")||document.body.appendChild(ac(document.createElement("div"),{id:"obis-root"}));Ue.default.mount(t,Mi);let e=()=>requestAnimationFrame(()=>Ue.default.redraw());qi.onSwitched(e),qe(z.STORE_UPDATED,e),qe(z.ui.UPDATE_PROGRESS_BAR,n=>{let r=n.max,i=n.value;on.max=r,on.value=i,e()}),(0,ur.delay)().then(zi(z.ui.RENDERED))}function ac(t,e){return Object.entries(e).reduce((n,[r,i])=>(n[r]=i,n),t)}cc();})();
