(()=>{var lr=Object.create,me=Object.defineProperty,hr=Object.getPrototypeOf,pr=Object.prototype.hasOwnProperty,vr=Object.getOwnPropertyNames,dr=Object.getOwnPropertyDescriptor;var yr=t=>me(t,"__esModule",{value:!0});var jt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var gr=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of vr(e))!pr.call(t,i)&&i!=="default"&&me(t,i,{get:()=>e[i],enumerable:!(n=dr(e,i))||n.enumerable});return t},Xt=t=>gr(yr(me(t!=null?lr(hr(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Qe=jt((Ve,Xe)=>{(function(t){if(typeof Ve=="object")Xe.exports=t();else if(typeof define=="function"&&define.amd)define(t);else{var e;try{e=window}catch(n){e=self}e.SparkMD5=t()}})(function(t){"use strict";var e=function(w,g){return w+g&4294967295},n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(w,g,s,o,l,u){return g=e(e(g,w),e(o,u)),e(g<<l|g>>>32-l,s)}function f(w,g){var s=w[0],o=w[1],l=w[2],u=w[3];s+=(o&l|~o&u)+g[0]-680876936|0,s=(s<<7|s>>>25)+o|0,u+=(s&o|~s&l)+g[1]-389564586|0,u=(u<<12|u>>>20)+s|0,l+=(u&s|~u&o)+g[2]+606105819|0,l=(l<<17|l>>>15)+u|0,o+=(l&u|~l&s)+g[3]-1044525330|0,o=(o<<22|o>>>10)+l|0,s+=(o&l|~o&u)+g[4]-176418897|0,s=(s<<7|s>>>25)+o|0,u+=(s&o|~s&l)+g[5]+1200080426|0,u=(u<<12|u>>>20)+s|0,l+=(u&s|~u&o)+g[6]-1473231341|0,l=(l<<17|l>>>15)+u|0,o+=(l&u|~l&s)+g[7]-45705983|0,o=(o<<22|o>>>10)+l|0,s+=(o&l|~o&u)+g[8]+1770035416|0,s=(s<<7|s>>>25)+o|0,u+=(s&o|~s&l)+g[9]-1958414417|0,u=(u<<12|u>>>20)+s|0,l+=(u&s|~u&o)+g[10]-42063|0,l=(l<<17|l>>>15)+u|0,o+=(l&u|~l&s)+g[11]-1990404162|0,o=(o<<22|o>>>10)+l|0,s+=(o&l|~o&u)+g[12]+1804603682|0,s=(s<<7|s>>>25)+o|0,u+=(s&o|~s&l)+g[13]-40341101|0,u=(u<<12|u>>>20)+s|0,l+=(u&s|~u&o)+g[14]-1502002290|0,l=(l<<17|l>>>15)+u|0,o+=(l&u|~l&s)+g[15]+1236535329|0,o=(o<<22|o>>>10)+l|0,s+=(o&u|l&~u)+g[1]-165796510|0,s=(s<<5|s>>>27)+o|0,u+=(s&l|o&~l)+g[6]-1069501632|0,u=(u<<9|u>>>23)+s|0,l+=(u&o|s&~o)+g[11]+643717713|0,l=(l<<14|l>>>18)+u|0,o+=(l&s|u&~s)+g[0]-373897302|0,o=(o<<20|o>>>12)+l|0,s+=(o&u|l&~u)+g[5]-701558691|0,s=(s<<5|s>>>27)+o|0,u+=(s&l|o&~l)+g[10]+38016083|0,u=(u<<9|u>>>23)+s|0,l+=(u&o|s&~o)+g[15]-660478335|0,l=(l<<14|l>>>18)+u|0,o+=(l&s|u&~s)+g[4]-405537848|0,o=(o<<20|o>>>12)+l|0,s+=(o&u|l&~u)+g[9]+568446438|0,s=(s<<5|s>>>27)+o|0,u+=(s&l|o&~l)+g[14]-1019803690|0,u=(u<<9|u>>>23)+s|0,l+=(u&o|s&~o)+g[3]-187363961|0,l=(l<<14|l>>>18)+u|0,o+=(l&s|u&~s)+g[8]+1163531501|0,o=(o<<20|o>>>12)+l|0,s+=(o&u|l&~u)+g[13]-1444681467|0,s=(s<<5|s>>>27)+o|0,u+=(s&l|o&~l)+g[2]-51403784|0,u=(u<<9|u>>>23)+s|0,l+=(u&o|s&~o)+g[7]+1735328473|0,l=(l<<14|l>>>18)+u|0,o+=(l&s|u&~s)+g[12]-1926607734|0,o=(o<<20|o>>>12)+l|0,s+=(o^l^u)+g[5]-378558|0,s=(s<<4|s>>>28)+o|0,u+=(s^o^l)+g[8]-2022574463|0,u=(u<<11|u>>>21)+s|0,l+=(u^s^o)+g[11]+1839030562|0,l=(l<<16|l>>>16)+u|0,o+=(l^u^s)+g[14]-35309556|0,o=(o<<23|o>>>9)+l|0,s+=(o^l^u)+g[1]-1530992060|0,s=(s<<4|s>>>28)+o|0,u+=(s^o^l)+g[4]+1272893353|0,u=(u<<11|u>>>21)+s|0,l+=(u^s^o)+g[7]-155497632|0,l=(l<<16|l>>>16)+u|0,o+=(l^u^s)+g[10]-1094730640|0,o=(o<<23|o>>>9)+l|0,s+=(o^l^u)+g[13]+681279174|0,s=(s<<4|s>>>28)+o|0,u+=(s^o^l)+g[0]-358537222|0,u=(u<<11|u>>>21)+s|0,l+=(u^s^o)+g[3]-722521979|0,l=(l<<16|l>>>16)+u|0,o+=(l^u^s)+g[6]+76029189|0,o=(o<<23|o>>>9)+l|0,s+=(o^l^u)+g[9]-640364487|0,s=(s<<4|s>>>28)+o|0,u+=(s^o^l)+g[12]-421815835|0,u=(u<<11|u>>>21)+s|0,l+=(u^s^o)+g[15]+530742520|0,l=(l<<16|l>>>16)+u|0,o+=(l^u^s)+g[2]-995338651|0,o=(o<<23|o>>>9)+l|0,s+=(l^(o|~u))+g[0]-198630844|0,s=(s<<6|s>>>26)+o|0,u+=(o^(s|~l))+g[7]+1126891415|0,u=(u<<10|u>>>22)+s|0,l+=(s^(u|~o))+g[14]-1416354905|0,l=(l<<15|l>>>17)+u|0,o+=(u^(l|~s))+g[5]-57434055|0,o=(o<<21|o>>>11)+l|0,s+=(l^(o|~u))+g[12]+1700485571|0,s=(s<<6|s>>>26)+o|0,u+=(o^(s|~l))+g[3]-1894986606|0,u=(u<<10|u>>>22)+s|0,l+=(s^(u|~o))+g[10]-1051523|0,l=(l<<15|l>>>17)+u|0,o+=(u^(l|~s))+g[1]-2054922799|0,o=(o<<21|o>>>11)+l|0,s+=(l^(o|~u))+g[8]+1873313359|0,s=(s<<6|s>>>26)+o|0,u+=(o^(s|~l))+g[15]-30611744|0,u=(u<<10|u>>>22)+s|0,l+=(s^(u|~o))+g[6]-1560198380|0,l=(l<<15|l>>>17)+u|0,o+=(u^(l|~s))+g[13]+1309151649|0,o=(o<<21|o>>>11)+l|0,s+=(l^(o|~u))+g[4]-145523070|0,s=(s<<6|s>>>26)+o|0,u+=(o^(s|~l))+g[11]-1120210379|0,u=(u<<10|u>>>22)+s|0,l+=(s^(u|~o))+g[2]+718787259|0,l=(l<<15|l>>>17)+u|0,o+=(u^(l|~s))+g[9]-343485551|0,o=(o<<21|o>>>11)+l|0,w[0]=s+w[0]|0,w[1]=o+w[1]|0,w[2]=l+w[2]|0,w[3]=u+w[3]|0}function d(w){var g=[],s;for(s=0;s<64;s+=4)g[s>>2]=w.charCodeAt(s)+(w.charCodeAt(s+1)<<8)+(w.charCodeAt(s+2)<<16)+(w.charCodeAt(s+3)<<24);return g}function y(w){var g=[],s;for(s=0;s<64;s+=4)g[s>>2]=w[s]+(w[s+1]<<8)+(w[s+2]<<16)+(w[s+3]<<24);return g}function h(w){var g=w.length,s=[1732584193,-271733879,-1732584194,271733878],o,l,u,L,O,D;for(o=64;o<=g;o+=64)f(s,d(w.substring(o-64,o)));for(w=w.substring(o-64),l=w.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<l;o+=1)u[o>>2]|=w.charCodeAt(o)<<(o%4<<3);if(u[o>>2]|=128<<(o%4<<3),o>55)for(f(s,u),o=0;o<16;o+=1)u[o]=0;return L=g*8,L=L.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(L[2],16),D=parseInt(L[1],16)||0,u[14]=O,u[15]=D,f(s,u),s}function v(w){var g=w.length,s=[1732584193,-271733879,-1732584194,271733878],o,l,u,L,O,D;for(o=64;o<=g;o+=64)f(s,y(w.subarray(o-64,o)));for(w=o-64<g?w.subarray(o-64):new Uint8Array(0),l=w.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<l;o+=1)u[o>>2]|=w[o]<<(o%4<<3);if(u[o>>2]|=128<<(o%4<<3),o>55)for(f(s,u),o=0;o<16;o+=1)u[o]=0;return L=g*8,L=L.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(L[2],16),D=parseInt(L[1],16)||0,u[14]=O,u[15]=D,f(s,u),s}function m(w){var g="",s;for(s=0;s<4;s+=1)g+=n[w>>s*8+4&15]+n[w>>s*8&15];return g}function c(w){var g;for(g=0;g<w.length;g+=1)w[g]=m(w[g]);return w.join("")}c(h("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(w,g){var s=(w&65535)+(g&65535),o=(w>>16)+(g>>16)+(s>>16);return o<<16|s&65535}),typeof ArrayBuffer!="undefined"&&!ArrayBuffer.prototype.slice&&function(){function w(g,s){return g=g|0||0,g<0?Math.max(g+s,0):Math.min(g,s)}ArrayBuffer.prototype.slice=function(g,s){var o=this.byteLength,l=w(g,o),u=o,L,O,D,z;return s!==t&&(u=w(s,o)),l>u?new ArrayBuffer(0):(L=u-l,O=new ArrayBuffer(L),D=new Uint8Array(O),z=new Uint8Array(this,l,L),D.set(z),O)}}();function E(w){return/[\u0080-\uFFFF]/.test(w)&&(w=unescape(encodeURIComponent(w))),w}function S(w,g){var s=w.length,o=new ArrayBuffer(s),l=new Uint8Array(o),u;for(u=0;u<s;u+=1)l[u]=w.charCodeAt(u);return g?l:o}function b(w){return String.fromCharCode.apply(null,new Uint8Array(w))}function R(w,g,s){var o=new Uint8Array(w.byteLength+g.byteLength);return o.set(new Uint8Array(w)),o.set(new Uint8Array(g),w.byteLength),s?o:o.buffer}function M(w){var g=[],s=w.length,o;for(o=0;o<s-1;o+=2)g.push(parseInt(w.substr(o,2),16));return String.fromCharCode.apply(String,g)}function x(){this.reset()}return x.prototype.append=function(w){return this.appendBinary(E(w)),this},x.prototype.appendBinary=function(w){this._buff+=w,this._length+=w.length;var g=this._buff.length,s;for(s=64;s<=g;s+=64)f(this._hash,d(this._buff.substring(s-64,s)));return this._buff=this._buff.substring(s-64),this},x.prototype.end=function(w){var g=this._buff,s=g.length,o,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u;for(o=0;o<s;o+=1)l[o>>2]|=g.charCodeAt(o)<<(o%4<<3);return this._finish(l,s),u=c(this._hash),w&&(u=M(u)),this.reset(),u},x.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},x.prototype.setState=function(w){return this._buff=w.buff,this._length=w.length,this._hash=w.hash,this},x.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},x.prototype._finish=function(w,g){var s=g,o,l,u;if(w[s>>2]|=128<<(s%4<<3),s>55)for(f(this._hash,w),s=0;s<16;s+=1)w[s]=0;o=this._length*8,o=o.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(o[2],16),u=parseInt(o[1],16)||0,w[14]=l,w[15]=u,f(this._hash,w)},x.hash=function(w,g){return x.hashBinary(E(w),g)},x.hashBinary=function(w,g){var s=h(w),o=c(s);return g?M(o):o},x.ArrayBuffer=function(){this.reset()},x.ArrayBuffer.prototype.append=function(w){var g=R(this._buff.buffer,w,!0),s=g.length,o;for(this._length+=w.byteLength,o=64;o<=s;o+=64)f(this._hash,y(g.subarray(o-64,o)));return this._buff=o-64<s?new Uint8Array(g.buffer.slice(o-64)):new Uint8Array(0),this},x.ArrayBuffer.prototype.end=function(w){var g=this._buff,s=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,u;for(l=0;l<s;l+=1)o[l>>2]|=g[l]<<(l%4<<3);return this._finish(o,s),u=c(this._hash),w&&(u=M(u)),this.reset(),u},x.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.ArrayBuffer.prototype.getState=function(){var w=x.prototype.getState.call(this);return w.buff=b(w.buff),w},x.ArrayBuffer.prototype.setState=function(w){return w.buff=S(w.buff,!0),x.prototype.setState.call(this,w)},x.ArrayBuffer.prototype.destroy=x.prototype.destroy,x.ArrayBuffer.prototype._finish=x.prototype._finish,x.ArrayBuffer.hash=function(w,g){var s=v(new Uint8Array(w)),o=c(s);return g?M(o):o},x})});var tn=jt(Qt=>{(function(t){"use strict";function e(r){return r!==null?Object.prototype.toString.call(r)==="[object Array]":!1}function n(r){return r!==null?Object.prototype.toString.call(r)==="[object Object]":!1}function i(r,a){if(r===a)return!0;var p=Object.prototype.toString.call(r);if(p!==Object.prototype.toString.call(a))return!1;if(e(r)===!0){if(r.length!==a.length)return!1;for(var _=0;_<r.length;_++)if(i(r[_],a[_])===!1)return!1;return!0}if(n(r)===!0){var T={};for(var $ in r)if(hasOwnProperty.call(r,$)){if(i(r[$],a[$])===!1)return!1;T[$]=!0}for(var B in a)if(hasOwnProperty.call(a,B)&&T[B]!==!0)return!1;return!0}return!1}function f(r){if(r===""||r===!1||r===null)return!0;if(e(r)&&r.length===0)return!0;if(n(r)){for(var a in r)if(r.hasOwnProperty(a))return!1;return!0}else return!1}function d(r){for(var a=Object.keys(r),p=[],_=0;_<a.length;_++)p.push(r[a[_]]);return p}function y(r,a){var p={};for(var _ in r)p[_]=r[_];for(var T in a)p[T]=a[T];return p}var h;typeof String.prototype.trimLeft=="function"?h=function(r){return r.trimLeft()}:h=function(r){return r.match(/^\s*(.*)/)[1]};var v=0,m=1,c=2,E=3,S=4,b=5,R=6,M=7,x=8,w=9,g="EOF",s="UnquotedIdentifier",o="QuotedIdentifier",l="Rbracket",u="Rparen",L="Comma",O="Colon",D="Rbrace",z="Number",Z="Current",K="Expref",tt="Pipe",Q="Or",J="And",W="EQ",q="GT",G="LT",rt="GTE",ut="LTE",nt="NE",it="Flatten",ot="Star",st="Filter",ct="Dot",F="Not",C="Lbrace",k="Lbracket",P="Lparen",Y="Literal",at={".":ct,"*":ot,",":L,":":O,"{":C,"}":D,"]":l,"(":P,")":u,"@":Z},pt={"<":!0,">":!0,"=":!0,"!":!0},N={" ":!0,"	":!0,"\n":!0};function I(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="_"}function j(r){return r>="0"&&r<="9"||r==="-"}function V(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="_"}function U(){}U.prototype={tokenize:function(r){var a=[];this._current=0;for(var p,_,T;this._current<r.length;)if(I(r[this._current]))p=this._current,_=this._consumeUnquotedIdentifier(r),a.push({type:s,value:_,start:p});else if(at[r[this._current]]!==void 0)a.push({type:at[r[this._current]],value:r[this._current],start:this._current}),this._current++;else if(j(r[this._current]))T=this._consumeNumber(r),a.push(T);else if(r[this._current]==="[")T=this._consumeLBracket(r),a.push(T);else if(r[this._current]==='"')p=this._current,_=this._consumeQuotedIdentifier(r),a.push({type:o,value:_,start:p});else if(r[this._current]==="'")p=this._current,_=this._consumeRawStringLiteral(r),a.push({type:Y,value:_,start:p});else if(r[this._current]==="`"){p=this._current;var $=this._consumeLiteral(r);a.push({type:Y,value:$,start:p})}else if(pt[r[this._current]]!==void 0)a.push(this._consumeOperator(r));else if(N[r[this._current]]!==void 0)this._current++;else if(r[this._current]==="&")p=this._current,this._current++,r[this._current]==="&"?(this._current++,a.push({type:J,value:"&&",start:p})):a.push({type:K,value:"&",start:p});else if(r[this._current]==="|")p=this._current,this._current++,r[this._current]==="|"?(this._current++,a.push({type:Q,value:"||",start:p})):a.push({type:tt,value:"|",start:p});else{var B=new Error("Unknown character:"+r[this._current]);throw B.name="LexerError",B}return a},_consumeUnquotedIdentifier:function(r){var a=this._current;for(this._current++;this._current<r.length&&V(r[this._current]);)this._current++;return r.slice(a,this._current)},_consumeQuotedIdentifier:function(r){var a=this._current;this._current++;for(var p=r.length;r[this._current]!=='"'&&this._current<p;){var _=this._current;r[_]==="\\"&&(r[_+1]==="\\"||r[_+1]==='"')?_+=2:_++,this._current=_}return this._current++,JSON.parse(r.slice(a,this._current))},_consumeRawStringLiteral:function(r){var a=this._current;this._current++;for(var p=r.length;r[this._current]!=="'"&&this._current<p;){var _=this._current;r[_]==="\\"&&(r[_+1]==="\\"||r[_+1]==="'")?_+=2:_++,this._current=_}this._current++;var T=r.slice(a+1,this._current-1);return T.replace("\\'","'")},_consumeNumber:function(r){var a=this._current;this._current++;for(var p=r.length;j(r[this._current])&&this._current<p;)this._current++;var _=parseInt(r.slice(a,this._current));return{type:z,value:_,start:a}},_consumeLBracket:function(r){var a=this._current;return this._current++,r[this._current]==="?"?(this._current++,{type:st,value:"[?",start:a}):r[this._current]==="]"?(this._current++,{type:it,value:"[]",start:a}):{type:k,value:"[",start:a}},_consumeOperator:function(r){var a=this._current,p=r[a];if(this._current++,p==="!")return r[this._current]==="="?(this._current++,{type:nt,value:"!=",start:a}):{type:F,value:"!",start:a};if(p==="<")return r[this._current]==="="?(this._current++,{type:ut,value:"<=",start:a}):{type:G,value:"<",start:a};if(p===">")return r[this._current]==="="?(this._current++,{type:rt,value:">=",start:a}):{type:q,value:">",start:a};if(p==="="&&r[this._current]==="=")return this._current++,{type:W,value:"==",start:a}},_consumeLiteral:function(r){this._current++;for(var a=this._current,p=r.length,_;r[this._current]!=="`"&&this._current<p;){var T=this._current;r[T]==="\\"&&(r[T+1]==="\\"||r[T+1]==="`")?T+=2:T++,this._current=T}var $=h(r.slice(a,this._current));return $=$.replace("\\`","`"),this._looksLikeJSON($)?_=JSON.parse($):_=JSON.parse('"'+$+'"'),this._current++,_},_looksLikeJSON:function(r){var a='[{"',p=["true","false","null"],_="-0123456789";if(r==="")return!1;if(a.indexOf(r[0])>=0)return!0;if(p.indexOf(r)>=0)return!0;if(_.indexOf(r[0])>=0)try{return JSON.parse(r),!0}catch(T){return!1}else return!1}};var A={};A[g]=0,A[s]=0,A[o]=0,A[l]=0,A[u]=0,A[L]=0,A[D]=0,A[z]=0,A[Z]=0,A[K]=0,A[tt]=1,A[Q]=2,A[J]=3,A[W]=5,A[q]=5,A[G]=5,A[rt]=5,A[ut]=5,A[nt]=5,A[it]=9,A[ot]=20,A[st]=21,A[ct]=40,A[F]=45,A[C]=50,A[k]=55,A[P]=60;function X(){}X.prototype={parse:function(r){this._loadTokens(r),this.index=0;var a=this.expression(0);if(this._lookahead(0)!==g){var p=this._lookaheadToken(0),_=new Error("Unexpected token type: "+p.type+", value: "+p.value);throw _.name="ParserError",_}return a},_loadTokens:function(r){var a=new U,p=a.tokenize(r);p.push({type:g,value:"",start:r.length}),this.tokens=p},expression:function(r){var a=this._lookaheadToken(0);this._advance();for(var p=this.nud(a),_=this._lookahead(0);r<A[_];)this._advance(),p=this.led(_,p),_=this._lookahead(0);return p},_lookahead:function(r){return this.tokens[this.index+r].type},_lookaheadToken:function(r){return this.tokens[this.index+r]},_advance:function(){this.index++},nud:function(r){var a,p,_;switch(r.type){case Y:return{type:"Literal",value:r.value};case s:return{type:"Field",name:r.value};case o:var T={type:"Field",name:r.value};if(this._lookahead(0)===P)throw new Error("Quoted identifier not allowed for function names.");return T;case F:return p=this.expression(A.Not),{type:"NotExpression",children:[p]};case ot:return a={type:"Identity"},p=null,this._lookahead(0)===l?p={type:"Identity"}:p=this._parseProjectionRHS(A.Star),{type:"ValueProjection",children:[a,p]};case st:return this.led(r.type,{type:"Identity"});case C:return this._parseMultiselectHash();case it:return a={type:it,children:[{type:"Identity"}]},p=this._parseProjectionRHS(A.Flatten),{type:"Projection",children:[a,p]};case k:return this._lookahead(0)===z||this._lookahead(0)===O?(p=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},p)):this._lookahead(0)===ot&&this._lookahead(1)===l?(this._advance(),this._advance(),p=this._parseProjectionRHS(A.Star),{type:"Projection",children:[{type:"Identity"},p]}):this._parseMultiselectList();case Z:return{type:Z};case K:return _=this.expression(A.Expref),{type:"ExpressionReference",children:[_]};case P:for(var $=[];this._lookahead(0)!==u;)this._lookahead(0)===Z?(_={type:Z},this._advance()):_=this.expression(0),$.push(_);return this._match(u),$[0];default:this._errorToken(r)}},led:function(r,a){var p;switch(r){case ct:var _=A.Dot;return this._lookahead(0)!==ot?(p=this._parseDotRHS(_),{type:"Subexpression",children:[a,p]}):(this._advance(),p=this._parseProjectionRHS(_),{type:"ValueProjection",children:[a,p]});case tt:return p=this.expression(A.Pipe),{type:tt,children:[a,p]};case Q:return p=this.expression(A.Or),{type:"OrExpression",children:[a,p]};case J:return p=this.expression(A.And),{type:"AndExpression",children:[a,p]};case P:for(var T=a.name,$=[],B,et;this._lookahead(0)!==u;)this._lookahead(0)===Z?(B={type:Z},this._advance()):B=this.expression(0),this._lookahead(0)===L&&this._match(L),$.push(B);return this._match(u),et={type:"Function",name:T,children:$},et;case st:var _t=this.expression(0);return this._match(l),this._lookahead(0)===it?p={type:"Identity"}:p=this._parseProjectionRHS(A.Filter),{type:"FilterProjection",children:[a,p,_t]};case it:var Lt={type:it,children:[a]},vt=this._parseProjectionRHS(A.Flatten);return{type:"Projection",children:[Lt,vt]};case W:case nt:case q:case rt:case G:case ut:return this._parseComparator(a,r);case k:var H=this._lookaheadToken(0);return H.type===z||H.type===O?(p=this._parseIndexExpression(),this._projectIfSlice(a,p)):(this._match(ot),this._match(l),p=this._parseProjectionRHS(A.Star),{type:"Projection",children:[a,p]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(r){if(this._lookahead(0)===r)this._advance();else{var a=this._lookaheadToken(0),p=new Error("Expected "+r+", got: "+a.type);throw p.name="ParserError",p}},_errorToken:function(r){var a=new Error("Invalid token ("+r.type+'): "'+r.value+'"');throw a.name="ParserError",a},_parseIndexExpression:function(){if(this._lookahead(0)===O||this._lookahead(1)===O)return this._parseSliceExpression();var r={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(l),r},_projectIfSlice:function(r,a){var p={type:"IndexExpression",children:[r,a]};return a.type==="Slice"?{type:"Projection",children:[p,this._parseProjectionRHS(A.Star)]}:p},_parseSliceExpression:function(){for(var r=[null,null,null],a=0,p=this._lookahead(0);p!==l&&a<3;){if(p===O)a++,this._advance();else if(p===z)r[a]=this._lookaheadToken(0).value,this._advance();else{var _=this._lookahead(0),T=new Error("Syntax error, unexpected token: "+_.value+"("+_.type+")");throw T.name="Parsererror",T}p=this._lookahead(0)}return this._match(l),{type:"Slice",children:r}},_parseComparator:function(r,a){var p=this.expression(A[a]);return{type:"Comparator",name:a,children:[r,p]}},_parseDotRHS:function(r){var a=this._lookahead(0),p=[s,o,ot];if(p.indexOf(a)>=0)return this.expression(r);if(a===k)return this._match(k),this._parseMultiselectList();if(a===C)return this._match(C),this._parseMultiselectHash()},_parseProjectionRHS:function(r){var a;if(A[this._lookahead(0)]<10)a={type:"Identity"};else if(this._lookahead(0)===k)a=this.expression(r);else if(this._lookahead(0)===st)a=this.expression(r);else if(this._lookahead(0)===ct)this._match(ct),a=this._parseDotRHS(r);else{var p=this._lookaheadToken(0),_=new Error("Sytanx error, unexpected token: "+p.value+"("+p.type+")");throw _.name="ParserError",_}return a},_parseMultiselectList:function(){for(var r=[];this._lookahead(0)!==l;){var a=this.expression(0);if(r.push(a),this._lookahead(0)===L&&(this._match(L),this._lookahead(0)===l))throw new Error("Unexpected token Rbracket")}return this._match(l),{type:"MultiSelectList",children:r}},_parseMultiselectHash:function(){for(var r=[],a=[s,o],p,_,T,$;;){if(p=this._lookaheadToken(0),a.indexOf(p.type)<0)throw new Error("Expecting an identifier token, got: "+p.type);if(_=p.value,this._advance(),this._match(O),T=this.expression(0),$={type:"KeyValuePair",name:_,value:T},r.push($),this._lookahead(0)===L)this._match(L);else if(this._lookahead(0)===D){this._match(D);break}}return{type:"MultiSelectHash",children:r}}};function lt(r){this.runtime=r}lt.prototype={search:function(r,a){return this.visit(r,a)},visit:function(r,a){var p,_,T,$,B,et,_t,Lt,vt,H;switch(r.type){case"Field":return a===null?null:n(a)?(et=a[r.name],et===void 0?null:et):null;case"Subexpression":for(T=this.visit(r.children[0],a),H=1;H<r.children.length;H++)if(T=this.visit(r.children[1],T),T===null)return null;return T;case"IndexExpression":return _t=this.visit(r.children[0],a),Lt=this.visit(r.children[1],_t),Lt;case"Index":if(!e(a))return null;var $t=r.value;return $t<0&&($t=a.length+$t),T=a[$t],T===void 0&&(T=null),T;case"Slice":if(!e(a))return null;var fr=r.children.slice(0),he=this.computeSliceParams(a.length,fr),Ge=he[0],Ye=he[1],pe=he[2];if(T=[],pe>0)for(H=Ge;H<Ye;H+=pe)T.push(a[H]);else for(H=Ge;H>Ye;H+=pe)T.push(a[H]);return T;case"Projection":var At=this.visit(r.children[0],a);if(!e(At))return null;for(vt=[],H=0;H<At.length;H++)_=this.visit(r.children[1],At[H]),_!==null&&vt.push(_);return vt;case"ValueProjection":if(At=this.visit(r.children[0],a),!n(At))return null;vt=[];var We=d(At);for(H=0;H<We.length;H++)_=this.visit(r.children[1],We[H]),_!==null&&vt.push(_);return vt;case"FilterProjection":if(At=this.visit(r.children[0],a),!e(At))return null;var ve=[],qe=[];for(H=0;H<At.length;H++)p=this.visit(r.children[2],At[H]),f(p)||ve.push(At[H]);for(var de=0;de<ve.length;de++)_=this.visit(r.children[1],ve[de]),_!==null&&qe.push(_);return qe;case"Comparator":switch($=this.visit(r.children[0],a),B=this.visit(r.children[1],a),r.name){case W:T=i($,B);break;case nt:T=!i($,B);break;case q:T=$>B;break;case rt:T=$>=B;break;case G:T=$<B;break;case ut:T=$<=B;break;default:throw new Error("Unknown comparator: "+r.name)}return T;case it:var ye=this.visit(r.children[0],a);if(!e(ye))return null;var Vt=[];for(H=0;H<ye.length;H++)_=ye[H],e(_)?Vt.push.apply(Vt,_):Vt.push(_);return Vt;case"Identity":return a;case"MultiSelectList":if(a===null)return null;for(vt=[],H=0;H<r.children.length;H++)vt.push(this.visit(r.children[H],a));return vt;case"MultiSelectHash":if(a===null)return null;vt={};var ge;for(H=0;H<r.children.length;H++)ge=r.children[H],vt[ge.name]=this.visit(ge.value,a);return vt;case"OrExpression":return p=this.visit(r.children[0],a),f(p)&&(p=this.visit(r.children[1],a)),p;case"AndExpression":return $=this.visit(r.children[0],a),f($)===!0?$:this.visit(r.children[1],a);case"NotExpression":return $=this.visit(r.children[0],a),f($);case"Literal":return r.value;case tt:return _t=this.visit(r.children[0],a),this.visit(r.children[1],_t);case Z:return a;case"Function":var Ze=[];for(H=0;H<r.children.length;H++)Ze.push(this.visit(r.children[H],a));return this.runtime.callFunction(r.name,Ze);case"ExpressionReference":var Je=r.children[0];return Je.jmespathType=K,Je;default:throw new Error("Unknown node type: "+r.type)}},computeSliceParams:function(r,a){var p=a[0],_=a[1],T=a[2],$=[null,null,null];if(T===null)T=1;else if(T===0){var B=new Error("Invalid slice, step cannot be 0");throw B.name="RuntimeError",B}var et=T<0;return p===null?p=et?r-1:0:p=this.capSliceRange(r,p,T),_===null?_=et?-1:r:_=this.capSliceRange(r,_,T),$[0]=p,$[1]=_,$[2]=T,$},capSliceRange:function(r,a,p){return a<0?(a+=r,a<0&&(a=p<0?-1:0)):a>=r&&(a=p<0?r-1:r),a}};function ht(r){this._interpreter=r,this.functionTable={abs:{_func:this._functionAbs,_signature:[{types:[v]}]},avg:{_func:this._functionAvg,_signature:[{types:[x]}]},ceil:{_func:this._functionCeil,_signature:[{types:[v]}]},contains:{_func:this._functionContains,_signature:[{types:[c,E]},{types:[m]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[c]},{types:[c]}]},floor:{_func:this._functionFloor,_signature:[{types:[v]}]},length:{_func:this._functionLength,_signature:[{types:[c,E,S]}]},map:{_func:this._functionMap,_signature:[{types:[R]},{types:[E]}]},max:{_func:this._functionMax,_signature:[{types:[x,w]}]},merge:{_func:this._functionMerge,_signature:[{types:[S],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[E]},{types:[R]}]},sum:{_func:this._functionSum,_signature:[{types:[x]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[c]},{types:[c]}]},min:{_func:this._functionMin,_signature:[{types:[x,w]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[E]},{types:[R]}]},type:{_func:this._functionType,_signature:[{types:[m]}]},keys:{_func:this._functionKeys,_signature:[{types:[S]}]},values:{_func:this._functionValues,_signature:[{types:[S]}]},sort:{_func:this._functionSort,_signature:[{types:[w,x]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[E]},{types:[R]}]},join:{_func:this._functionJoin,_signature:[{types:[c]},{types:[w]}]},reverse:{_func:this._functionReverse,_signature:[{types:[c,E]}]},to_array:{_func:this._functionToArray,_signature:[{types:[m]}]},to_string:{_func:this._functionToString,_signature:[{types:[m]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[m]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[m],variadic:!0}]}}}ht.prototype={callFunction:function(r,a){var p=this.functionTable[r];if(p===void 0)throw new Error("Unknown function: "+r+"()");return this._validateArgs(r,a,p._signature),p._func.call(this,a)},_validateArgs:function(r,a,p){var _;if(p[p.length-1].variadic){if(a.length<p.length)throw _=p.length===1?" argument":" arguments",new Error("ArgumentError: "+r+"() takes at least"+p.length+_+" but received "+a.length)}else if(a.length!==p.length)throw _=p.length===1?" argument":" arguments",new Error("ArgumentError: "+r+"() takes "+p.length+_+" but received "+a.length);for(var T,$,B,et=0;et<p.length;et++){B=!1,T=p[et].types,$=this._getTypeName(a[et]);for(var _t=0;_t<T.length;_t++)if(this._typeMatches($,T[_t],a[et])){B=!0;break}if(!B)throw new Error("TypeError: "+r+"() expected argument "+(et+1)+" to be type "+T+" but received type "+$+" instead.")}},_typeMatches:function(r,a,p){if(a===m)return!0;if(a===w||a===x||a===E){if(a===E)return r===E;if(r===E){var _;a===x?_=v:a===w&&(_=c);for(var T=0;T<p.length;T++)if(!this._typeMatches(this._getTypeName(p[T]),_,p[T]))return!1;return!0}}else return r===a},_getTypeName:function(r){switch(Object.prototype.toString.call(r)){case"[object String]":return c;case"[object Number]":return v;case"[object Array]":return E;case"[object Boolean]":return b;case"[object Null]":return M;case"[object Object]":return r.jmespathType===K?R:S}},_functionStartsWith:function(r){return r[0].lastIndexOf(r[1])===0},_functionEndsWith:function(r){var a=r[0],p=r[1];return a.indexOf(p,a.length-p.length)!==-1},_functionReverse:function(r){var a=this._getTypeName(r[0]);if(a===c){for(var p=r[0],_="",T=p.length-1;T>=0;T--)_+=p[T];return _}else{var $=r[0].slice(0);return $.reverse(),$}},_functionAbs:function(r){return Math.abs(r[0])},_functionCeil:function(r){return Math.ceil(r[0])},_functionAvg:function(r){for(var a=0,p=r[0],_=0;_<p.length;_++)a+=p[_];return a/p.length},_functionContains:function(r){return r[0].indexOf(r[1])>=0},_functionFloor:function(r){return Math.floor(r[0])},_functionLength:function(r){return n(r[0])?Object.keys(r[0]).length:r[0].length},_functionMap:function(r){for(var a=[],p=this._interpreter,_=r[0],T=r[1],$=0;$<T.length;$++)a.push(p.visit(_,T[$]));return a},_functionMerge:function(r){for(var a={},p=0;p<r.length;p++){var _=r[p];for(var T in _)a[T]=_[T]}return a},_functionMax:function(r){if(r[0].length>0){var a=this._getTypeName(r[0][0]);if(a===v)return Math.max.apply(Math,r[0]);for(var p=r[0],_=p[0],T=1;T<p.length;T++)_.localeCompare(p[T])<0&&(_=p[T]);return _}else return null},_functionMin:function(r){if(r[0].length>0){var a=this._getTypeName(r[0][0]);if(a===v)return Math.min.apply(Math,r[0]);for(var p=r[0],_=p[0],T=1;T<p.length;T++)p[T].localeCompare(_)<0&&(_=p[T]);return _}else return null},_functionSum:function(r){for(var a=0,p=r[0],_=0;_<p.length;_++)a+=p[_];return a},_functionType:function(r){switch(this._getTypeName(r[0])){case v:return"number";case c:return"string";case E:return"array";case S:return"object";case b:return"boolean";case R:return"expref";case M:return"null"}},_functionKeys:function(r){return Object.keys(r[0])},_functionValues:function(r){for(var a=r[0],p=Object.keys(a),_=[],T=0;T<p.length;T++)_.push(a[p[T]]);return _},_functionJoin:function(r){var a=r[0],p=r[1];return p.join(a)},_functionToArray:function(r){return this._getTypeName(r[0])===E?r[0]:[r[0]]},_functionToString:function(r){return this._getTypeName(r[0])===c?r[0]:JSON.stringify(r[0])},_functionToNumber:function(r){var a=this._getTypeName(r[0]),p;return a===v?r[0]:a===c&&(p=+r[0],!isNaN(p))?p:null},_functionNotNull:function(r){for(var a=0;a<r.length;a++)if(this._getTypeName(r[a])!==M)return r[a];return null},_functionSort:function(r){var a=r[0].slice(0);return a.sort(),a},_functionSortBy:function(r){var a=r[0].slice(0);if(a.length===0)return a;var p=this._interpreter,_=r[1],T=this._getTypeName(p.visit(_,a[0]));if([v,c].indexOf(T)<0)throw new Error("TypeError");for(var $=this,B=[],et=0;et<a.length;et++)B.push([et,a[et]]);B.sort(function(Lt,vt){var H=p.visit(_,Lt[1]),$t=p.visit(_,vt[1]);if($._getTypeName(H)!==T)throw new Error("TypeError: expected "+T+", received "+$._getTypeName(H));if($._getTypeName($t)!==T)throw new Error("TypeError: expected "+T+", received "+$._getTypeName($t));return H>$t?1:H<$t?-1:Lt[0]-vt[0]});for(var _t=0;_t<B.length;_t++)a[_t]=B[_t][1];return a},_functionMaxBy:function(r){for(var a=r[1],p=r[0],_=this.createKeyFunction(a,[v,c]),T=-Infinity,$,B,et=0;et<p.length;et++)B=_(p[et]),B>T&&(T=B,$=p[et]);return $},_functionMinBy:function(r){for(var a=r[1],p=r[0],_=this.createKeyFunction(a,[v,c]),T=Infinity,$,B,et=0;et<p.length;et++)B=_(p[et]),B<T&&(T=B,$=p[et]);return $},createKeyFunction:function(r,a){var p=this,_=this._interpreter,T=function($){var B=_.visit(r,$);if(a.indexOf(p._getTypeName(B))<0){var et="TypeError: expected one of "+a+", received "+p._getTypeName(B);throw new Error(et)}return B};return T}};function xt(r){var a=new X,p=a.parse(r);return p}function It(r){var a=new U;return a.tokenize(r)}function St(r,a){var p=new X,_=new ht,T=new lt(_);_._interpreter=T;var $=p.parse(a);return T.search($,r)}t.tokenize=It,t.compile=xt,t.search=St,t.strictDeepEqual=i})(typeof Qt=="undefined"?Qt.jmespath={}:Qt)});var mn=jt((be,Ne)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof be!="undefined"?e():(e(),t.FileSaver={exports:{}}.exports)})(be,function(){"use strict";function t(h,v){return typeof v=="undefined"?v={autoBom:!1}:typeof v!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),v={autoBom:!v}),v.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function e(h,v,m){var c=new XMLHttpRequest;c.open("GET",h),c.responseType="blob",c.onload=function(){y(c.response,v,m)},c.onerror=function(){console.error("could not download file")},c.send()}function n(h){var v=new XMLHttpRequest;v.open("HEAD",h,!1);try{v.send()}catch(m){}return 200<=v.status&&299>=v.status}function i(h){try{h.dispatchEvent(new MouseEvent("click"))}catch(m){var v=document.createEvent("MouseEvents");v.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(v)}}var f=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,d=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),y=f.saveAs||(typeof window!="object"||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(h,v,m){var c=f.URL||f.webkitURL,E=document.createElement("a");v=v||h.name||"download",E.download=v,E.rel="noopener",typeof h=="string"?(E.href=h,E.origin===location.origin?i(E):n(E.href)?e(h,v,m):i(E,E.target="_blank")):(E.href=c.createObjectURL(h),setTimeout(function(){c.revokeObjectURL(E.href)},4e4),setTimeout(function(){i(E)},0))}:"msSaveOrOpenBlob"in navigator?function(h,v,m){if(v=v||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(t(h,m),v);else if(n(h))e(h,v,m);else{var c=document.createElement("a");c.href=h,c.target="_blank",setTimeout(function(){i(c)})}}:function(h,v,m,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof h=="string")return e(h,v,m);var E=h.type==="application/octet-stream",S=/constructor/i.test(f.HTMLElement)||f.safari,b=/CriOS\/[\d]+/.test(navigator.userAgent);if((b||E&&S||d)&&typeof FileReader!="undefined"){var R=new FileReader;R.onloadend=function(){var w=R.result;w=b?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=w:location=w,c=null},R.readAsDataURL(h)}else{var M=f.URL||f.webkitURL,x=M.createObjectURL(h);c?c.location=x:location.href=x,c=null,setTimeout(function(){M.revokeObjectURL(x)},4e4)}});f.saveAs=y.saveAs=y,typeof Ne!="undefined"&&(Ne.exports=y)})});var jn=jt(kt=>{"use strict";function wn(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i&&i.push(n)||t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&i.splice(i.indexOf(n)>>>0,1)},emit:function(e,n){(t.get(e)||[]).slice().map(function(i){i(n)}),(t.get("*")||[]).slice().map(function(i){i(e,n)})}}}function _n(t){return Array.isArray(t)}function Et(t){return typeof t=="function"}function mt(t){return typeof t=="string"}function En(t){return typeof t=="object"}function bt(t){return!(t===null||!En(t))&&Object.getPrototypeOf(t)===Object.prototype}function ce(t){return!!mt(t)||!!_n(t)&&t.every(mt)}Object.defineProperty(kt,"__esModule",{value:!0});function Ie(t){return function(e,n,...i){let f=Object.entries(n).map(([h,v])=>({argName:h,argType:v})),d=i.map((...h)=>((v,m,c)=>{let{argName:E,argType:S}=v[c];if(m===void 0)return`Argument undefined: "${E}"`;let b=Array.isArray(S)?S:[S],R=b.map(M=>Et(M)?((x,w,g)=>w(g)?void 0:`${w.name}(${x}) did not return true`)(E,M,m):((x,w,g)=>typeof g===w?void 0:`Argument "${x}" should be a ${w}`)(E,M,m)).filter(mt);return(b.length>1?R.length>1:R.length)?`${R.join(`
| `)}
> typeof ${E} === ${typeof m}(${JSON.stringify(m)})`:void 0})(f,...h)).filter(mt);if(!d.length)return;let y=Object.keys(n).join(", ");return`
${t||""}${e}(${y}):
${d.map(h=>`| ${h}`).join(`
`)}`}}function Me(t){let e=t.addListener?(...f)=>t.addListener(...f):(...f)=>t.on(...f),n=t.removeListener?(...f)=>t.removeListener(...f):(...f)=>t.off(...f),i=new Map;return{emit:(f,...d)=>t.emit(f,d),on:function(f,d){let y=i.get(d);y||(y={handleEvent:h=>d(...h||[]),refCount:0},i.set(d,y)),y.refCount+=1,e(f,y.handleEvent)},off:function(f,d){let y=i.get(d);y&&(n(f,y.handleEvent),y.refCount-=1,y.refCount===0&&i.delete(d))}}}function Tn(t){return t.reduce((e,n)=>e.indexOf(n)===-1?[...e,n]:e,[])}function Nr(t){return(...e)=>function(n,...i){let f=setTimeout(n,0,...i);return()=>{clearTimeout(f)}}(t,...e)}function Sn(t){let e,n=!1;return{fn:(...i)=>(n||(e=t(...i)),e),revoke:()=>{n=!0}}}function Ce(t,e,n,...i){let f=[...i].flat().reduce((h,v)=>({...h,[v]:0}),{});function d(h){let v=y(h)-1;f[h]=Math.max(v,0)}function y(h){return f[h]||0}return{increase:function(h){return f[h]=y(h)+1,()=>{d(h)}},decrease:d,countOf:y,toValue:function(){return{description:`Statebot[${t}]: ${n}:`,table:Object.keys(f).sort().map(h=>[h,f[h]]).map(([h,v])=>({[e]:h,refs:v||"None"}))}},refs:function(){return{...f}}}}function xn(t,e){function n(){return t>=1}function i(){return t>=2}function f(){return t>=3}mt(t)&&(t={info:3,log:2,warn:1,none:0}[t]||3);let{info:d,table:y,log:h,warn:v,error:m}=e||console;return{canWarn:n,canLog:i,canInfo:f,info:(...c)=>{f()&&d(...c)},table:(...c)=>{i()&&y(...c)},log:(...c)=>{i()&&h(...c)},warn:(...c)=>{n()&&v(...c)},error:(...c)=>{m(...c)}}}var Ir=/[\r\n]/,An="|",Ht="->",Mr=[An,Ht].map(t=>t.replace("|","\\|")).join("|"),Cr=new RegExp(`(${Mr})$`),Lr=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,kr=/(\/\/[^\n\r]*)/,On=Ie("statebot.");function bn(t){let e=On("decomposeRoute",{templateLiteral:ce},t);if(e)throw TypeError(e);return Rn($n(t)).flat(2)}function Le(t){let e=On("decomposeChart",{chart:ce},t);if(e)throw TypeError(e);let n=Rn($n(t)),i=n.map(Fr).flat(1).map(jr).flat(1),f=!1,d=Tn(i.map(h=>(h.includes("")&&(f=!0),h.join(Ht)))),y=Tn(n.flat(3));return{transitions:d.map(h=>h.split(Ht)),routes:d,states:f?y:y.filter(Boolean)}}function $n(t){let e=function(d){return[d].flat().reduce((y,h)=>[...y,...h.split(Ir)],[])}(t),n=[],i=!1,f=e.reduce((d,y)=>{let h=y.replace(kr,"").replace(Lr,"");return h?(i=Cr.test(h),i?d+h:(n.push(d+h),"")):d},"");return i||f?[...n,f]:[...n]}function Rn(t){return t.map(e=>e.split(Ht).map(n=>n.split(An)))}function Fr(t){let e=[];return t.reduce((n,i)=>(n===!1||e.push([n,[...i]]),[...i]),!1),e}function jr([t,e]){return t.reduce((n,i)=>[...n,...e.map(f=>[i,f])],[])}var Nn="onExiting",In="onEntering",Mn="onExited",Cn="onEntered",Kt="onSwitching",Gt="onSwitched",Yt={[Kt]:"(ANY)state:changing",[Gt]:"(ANY)state:changed"};function Ln(t,e){let n=[],i=[];return{configs:t.reduce((f,d)=>{let{routeChart:y,action:h}=d,{states:v,routes:m,transitions:c}=Le(y);return e()&&(n.push(...v),i.push(...m)),[...f,...c.map(([E,S])=>({fromState:E,toState:S,action:h}))]},[]),states:n,routes:i}}function ke(t){return bt(t)&&typeof t.__STATEBOT__=="number"}var kn=Ie("statebot."),Fn=0;function Fe(){let t=Date.now();function e(n,i){return n.toFixed(i).replace(/\.0+$/,"")}return function(){let n=Date.now()-t;return n<500?`${e(n)} ms`:n<5e3?`${e(n/1e3,2)} s `:n<6e4?`${e(n/1e3,1)} s `:`${e(n/1e3/60,1)} m `}}kt.Statebot=function(t,e){if(!mt(t))throw new TypeError(`
Statebot: Please specify a name for this machine`);let n=`Statebot[${t}]`;if(!bt(e))throw new TypeError(`
${n}: Please specify options for this machine`);let{chart:i,logLevel:f=3,historyLimit:d=2}=e||{},y=e.events===void 0?Me(wn()):En(h=e.events)&&Et(h.emit)&&(Et(h.addListener)||Et(h.on))&&(Et(h.removeListener)||Et(h.off))&&Me(e.events);var h;if(!y)throw new TypeError(`
${n}: Invalid event-emitter specified in options`);let{states:v=[],routes:m=[]}=i?Le(i):e,{startIn:c=v[0]}=e;if(!v.includes(c))throw new Error(`${n}: Starting-state not in chart: "${c}"`);let E=Ie(`${n}#`),S=xn(f,console),{canWarn:b}=S,R=[c],M=Math.max(d,2),x=0,{pause:w,resume:g,paused:s,Pausable:o}=function(F,C){C=C||function(){};let k=!!F;return{Pausable:function(P){return(...Y)=>k?(C(),!1):P(...Y)},paused:()=>k,pause:()=>{k=!0},resume:()=>{k=!1}}}(!1,()=>S.warn(`${n}: Ignoring callback, paused`)),l=Me(wn()),u=o(l.emit);function L(F,C){return l.on(F,C),()=>l.off(F,C)}let O=Ce(t,"states","Listening for the following state-changes",[...v]),D=Ce(t,"transitions","Listening for the following transitions",[...m]),z=Ce(t,"events","Listening for the following events");function Z(F,C){let k=Et(F)?F({enter:G,emit:q,Enter:ot,Emit:it}):bt(F)?F:null;if(!bt(k))throw new TypeError(`Statebot[${t}]#${C}(): Expected an object, or a function that returns an object`);let P=[],Y=[],{transitionsForEvents:at,transitionsOnly:pt}=function(U){let A={},X=[];return Object.entries(U).map(([lt,ht])=>{if(Et(ht))return void X.push({routeChart:lt,action:ht});if(!bt(ht))return;let{on:xt,then:It}=ht;mt(xt)||_n(xt)?[xt].flat().map(St=>{A[St]=A[St]||[],A[St].push({routeChart:lt,action:It})}):Et(It)&&X.push({routeChart:lt,action:ht})}),{transitionsForEvents:A,transitionsOnly:X}}(k),N=Object.entries(at).reduce(function(U,[A,X]){let{states:lt,routes:ht,configs:xt}=Ln(X,b);return b()&&(P.push(...lt),Y.push(...ht)),{...U,[A]:xt}},{}),I=Ln(pt,b),j=Object.entries(N).map(function([U,A]){return[z.increase(U),rt(U,(...X)=>{A.map(lt=>({...lt,args:X})).some(V)||st(`Event not handled: "${U}"`)})]}).concat(I.configs.map(function(U){let{fromState:A,toState:X,action:lt}=U,ht=`${A}->${X}`;return[D.increase(ht),L(ht,lt)]})).flat();if(b()){P.push(...I.states),Y.push(...I.routes);let U=P.filter(X=>!v.includes(X)),A=Y.filter(X=>!m.includes(X));U.length&&S.warn(`Statebot[${t}]#${C}(): Invalid states specified:
`+U.map(X=>`  > "${X}"`).join(`
`)),A.length&&S.warn(`Statebot[${t}]#${C}(): Invalid transitions specified:
`+A.map(X=>`  > "${X}"`).join(`
`))}return()=>j.map(U=>U());function V({fromState:U,toState:A,action:X,args:lt}){return W(U,()=>(G(A,...lt),Et(X)&&X(...lt),!0))}}function K(){return R[R.length-2]}function tt(){return R[R.length-1]}function Q(F){let C=F!==void 0?F:tt(),k=E("statesAvailableFromHere",{state:mt},C);if(k)throw new TypeError(k);return m.reduce((P,Y)=>{let[at,pt]=Y.split(Ht).map(N=>N.trim());return at===C?[...P,pt]:P},[])}function J(F,C,...k){let P=tt()===F;return C===void 0?P:P?Et(C)?C(...k):C:null}function W(...F){let C=E("inState",{state:[mt,bt]},F[0]);if(C)throw new TypeError(C);return bt(F[0])?function(k,...P){let Y=Object.entries(k).find(([at])=>J(at));return Y?J(...Y.concat(P)):null}(...F):J(...F)}let q=o((F,...C)=>{let k=E("emit",{eventName:mt},F);if(k)throw new TypeError(k);return y.emit(F,...C)}),G=o((F,...C)=>{let k=E("enter",{state:mt},F);if(k)throw new TypeError(k);let P=tt(),Y=F;if(Y===P)return st(`Already in state: "${Y}"`),!1;if(!v.includes(Y))return st(`Invalid state "${Y}", not switching`),!1;let at=`${P}->${Y}`;return m.includes(at)?(S.info(`${n}: tId<${++x}>: ${at}`),R.push(Y),R.length>M&&R.shift(),u(Yt[Kt],Y,P,...C),u(at,...C),u(Yt[Gt],Y,P,...C),!0):(st(`Invalid transition "${at}", not switching`),!1)});function rt(F,C){let k=E("onEvent",{eventName:mt,cb:Et},F,C);if(k)throw new TypeError(k);return y.on(F,C),()=>y.off(F,C)}let ut=Object.keys(Yt).reduce((F,C)=>({...F,[C]:k=>{let P=E(C,{cb:Et},k);if(P)throw new TypeError(P);let Y=O.increase(Yt[C]),at=L(Yt[C],k);return()=>{at(),Y()}}}),{}),nt=[[Nn,Kt],[In,Kt],[Mn,Gt],[Cn,Gt]].reduce((F,C)=>{let[k,P]=C,Y=k.slice(2),at=Y.toLowerCase();return{...F,[k]:(pt,N)=>{let I=E(k,{state:mt,cb:Et},pt,N);if(I)throw new TypeError(I);let j=[O.increase(pt),O.increase(`${pt}:${at}`)],V=ut[P]((U,A,...X)=>{Y.indexOf("Exit")===0?pt===A&&N(U,...X):pt===U&&N(A,...X)});return()=>{V(),j.map(U=>U())}}}},{});function it(F,...C){let k=E("Emit",{eventName:mt},F);if(k)throw new TypeError(k);return(...P)=>q(F,...C,...P)}function ot(F,...C){let k=E("Enter",{state:mt},F);if(k)throw new TypeError(k);return(...P)=>G(F,...C,...P)}function st(F){let C=K(),k=tt(),P=`${C===void 0?"[undefined]":C}->${k}`,Y=Q();Y.length?S.info(`${n}: ${F}
  > Previous transition: "${P}"
  > From "${k}", valid states are: [${Y.map(at=>`"${at}"`).join(", ")}]`):S.info(`${n}: ${F}
  > Previous transition: "${P}"
  > There are no states available from "${k}"`)}function ct(F){let{description:C,table:k}=F.toValue();S.log(C),k.length?S.table(k):S.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(...F){let C=F.flat(),k=E("canTransitionTo",{state:mt},C[0]);if(k)throw new TypeError(k);if(!C.length)return!1;let P=Q();return C.every(Y=>P.includes(Y))},currentState:tt,emit:q,Emit:it,enter:G,Enter:ot,history:()=>[...R],info:()=>(S.log(`${n}: Information about this state-machine`),ct(O),ct(D),void ct(z)),inspect:()=>({states:O.refs(),transitions:D.refs(),events:z.refs()}),inState:W,InState:function(...F){let C=E("InState",{state:[mt,bt]},F[0]);if(C)throw new TypeError(C);return bt(F[0])?function(k,...P){return(...Y)=>W(k,...P,...Y)}(...F):function(k,P,...Y){return(...at)=>W(k,P,...Y,...at)}(...F)},name:()=>t,onEntered:nt[Cn],onEntering:nt[In],onEvent:rt,onExited:nt[Mn],onExiting:nt[Nn],onSwitched:ut[Gt],onSwitching:ut[Kt],onTransitions:F=>Z(F,"onTransitions"),pause:w,paused:s,performTransitions:F=>Z(F,"performTransitions"),previousState:K,reset:function(){S.warn(`${n}: State-machine reset!`),R.length=0,R.push(c)},resume:g,statesAvailableFromHere:Q}},kt.assertRoute=function(t,e,n){let i=kn("assertRoute",{machine:ke,expectedRoute:ce},t,e);if(i)throw TypeError(i);Fn+=1;let{description:f="Assertion complete",fromState:d="",run:y=()=>{},permittedDeviations:h=0,timeoutInMs:v=1e3,logLevel:m=3}=n||{},c=xn(m),E=`Statebot[${t.name()}]: aId<${Fn}>`,S=bn(e);c.log(`
${E}: Asserting route: [${S.join(" > ")}]`),c.log(`${E}: > Assertion will start from state: "${d}"`);let b=Nr(y),R=()=>{},M=Fe(),x,w=Fe(),g=0,s=!0,o=!1,l=[...S],u=function(D,z){z=z||[];let Z=[],K=(D=D||[]).map((G,rt)=>z[rt]||"center"),tt=!1;function Q(){tt=!0}function J(...G){if(tt)return;let rt=D.reduce((ut,nt,it)=>({...ut,[nt]:G[it]||""}),{});Z.push(rt)}function W(){return Z.reduce((G,rt)=>D.map((ut,nt)=>Math.max(rt[ut].length,G[nt])),D.map(()=>0))}function q(){let G=W();function rt(ut,nt){let it=G[nt],ot=K[nt];return ot==="left"?ut.padEnd(it):ot==="right"?ut.padStart(it):ut}return Z.reduce((ut,nt)=>[...ut,D.reduce((it,ot,st)=>({...it,[ot]:rt(nt[ot],st)}),{})],[])}return{lock:Q,addRow:J,content:q}}(["state","expected","info","took"],["center","center","left","right"]),L=function(D){let{revoke:z,fn:Z}=Sn(D),K;return function(...tt){return K=Z(...tt),z(),K}}(D=>(O("","","","TOTAL: "+M()),u.lock(),c.log(`
${E}: ${f}: [${D?"FAILED":"SUCCESS"}]`),c.table(u.content()),D)),{addRow:O}=u;return new Promise((D,z)=>{if(l.length===0)return void z(L(new Error("NO ROUTE TO TEST")));let Z=J=>{for(;l.length;){let W=l.shift();O(t.currentState(),`(${W})`,J),o=!1}(W=>{clearTimeout(x),R(),Q(),z(W)})(L(new Error(J)))};t.inState(d)&&(s=!1,R=b());let{revoke:K,fn:tt}=Sn(J=>{x=setTimeout(()=>{K(),Z("TIMEOUT")},v),function(W){if(s)O(W,"-","PENDING");else{let q=l[0];q===W?(O(W,q,o?"REALIGNED":"OKAY",w()),o=!1,l.shift()):(O(W,q,"WRONG STATE",w()),o=!0,g+=1),w=Fe()}}(J),s&&J===d&&(s=!1,R=b()),g>h&&(K(),Z("TOO MANY DEVIATIONS")),l.length<=0&&(K(),((...W)=>{clearTimeout(x),R(),Q(),D(...W)})(L()))}),Q=t.onSwitching(tt)})},kt.decomposeChart=Le,kt.isStatebot=ke,kt.routeIsPossible=function(t,e){let n=kn("routeIsPossible",{machine:ke,route:ce},t,e);if(n)throw TypeError(n);let i=bn(e);return i.every((f,d)=>{if(d===i.length-1)return!0;{let y=i[d+1];return t.statesAvailableFromHere(f).includes(y)}})}});var nr=jt(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});function Dn(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i&&i.push(n)||t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&i.splice(i.indexOf(n)>>>0,1)},emit:function(e,n){(t.get(e)||[]).slice().map(function(i){i(n)}),(t.get("*")||[]).slice().map(function(i){i(e,n)})}}}function Dr(t){return zn(t)&&Tt(t.emit)&&(Tt(t.addListener)||Tt(t.on))&&(Tt(t.removeListener)||Tt(t.off))}function Un(t){return Array.isArray(t)}function Tt(t){return typeof t=="function"}function wt(t){return typeof t=="string"}function zn(t){return typeof t=="object"}function Nt(t){return t===null||!zn(t)?!1:Object.getPrototypeOf(t)===Object.prototype}function fe(t){return wt(t)?!0:Un(t)?t.every(wt):!1}var zr=(t,e,n)=>e(n)?void 0:`${e.name}(${t}) did not return true`,Ur=(t,e,n)=>typeof n===e?void 0:`Argument "${t}" should be a ${e}`,Pr=(t,e,n)=>{let{argName:i,argType:f}=t[n];if(e===void 0)return`Argument undefined: "${i}"`;let d=Array.isArray(f)?f:[f],y=d.map(m=>Tt(m)?zr(i,m,e):Ur(i,m,e)).filter(wt);if(d.length>1?y.length>1:y.length)return`${y.join(`
| `)}
> typeof ${i} === ${typeof e}(${JSON.stringify(e)})`};function je(t){return function(e,n,...i){let f=Object.entries(n).map(([h,v])=>({argName:h,argType:v})),d=i.map((...h)=>Pr(f,...h)).filter(wt);if(!d.length)return;let y=Object.keys(n).join(", ");return`
${t||""}${e}(${y}):
${d.map(h=>`| ${h}`).join(`
`)}`}}function De(t){let e=(h,...v)=>t.emit(h,v),n=t.addListener?(...h)=>t.addListener(...h):(...h)=>t.on(...h),i=t.removeListener?(...h)=>t.removeListener(...h):(...h)=>t.off(...h),f=new Map;function d(h,v){let m=f.get(v);m||(m={handleEvent:c=>v(...c||[]),refCount:0},f.set(v,m)),m.refCount+=1,n(h,m.handleEvent)}function y(h,v){let m=f.get(v);!m||(i(h,m.handleEvent),m.refCount-=1,m.refCount===0&&f.delete(v))}return{emit:e,on:d,off:y}}function Pn(t){return t.reduce((e,n)=>e.indexOf(n)===-1?[...e,n]:e,[])}function Br(t,...e){let n=setTimeout(t,0,...e);return()=>{clearTimeout(n)}}function Hr(t){return(...e)=>Br(t,...e)}function Kr(t){let{revoke:e,fn:n}=Bn(t),i;return function(...f){return i=n(...f),e(),i}}function Bn(t){let e=!1,n;return{fn:(...i)=>(e||(n=t(...i)),n),revoke:()=>{e=!0}}}function Gr(t,e){e=e||function(){};let n=!!t;function i(f){return(...d)=>n?(e(),!1):f(...d)}return{Pausable:i,paused:()=>n,pause:()=>{n=!0},resume:()=>{n=!1}}}function ze(t,e,n,...i){let f=[...i].flat().reduce((E,S)=>({...E,[S]:0}),{});function d(E){return f[E]=h(E)+1,()=>{y(E)}}function y(E){let S=h(E)-1;f[E]=Math.max(S,0)}function h(E){return f[E]||0}function v(){return{...f}}function m(){return Object.keys(f).sort().map(E=>[E,f[E]]).map(([E,S])=>({[e]:E,refs:S||"None"}))}function c(){return{description:`Statebot[${t}]: ${n}:`,table:m()}}return{increase:d,decrease:y,countOf:h,toValue:c,refs:v}}function Hn(t,e){wt(t)&&(t={info:3,log:2,warn:1,none:0}[t]||3);function n(){return t>=1}function i(){return t>=2}function f(){return t>=3}let{info:d,table:y,log:h,warn:v,error:m}=e||console;return{canWarn:n,canLog:i,canInfo:f,info:(...c)=>{f()&&d(...c)},table:(...c)=>{i()&&y(...c)},log:(...c)=>{i()&&h(...c)},warn:(...c)=>{n()&&v(...c)},error:(...c)=>{m(...c)}}}var Yr=/[\r\n]/,Kn="|",Wt="->",Wr=[Kn,Wt].map(t=>t.replace("|","\\|")).join("|"),qr=new RegExp(`(${Wr})$`),Zr=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,Jr=/(\/\/[^\n\r]*)/,Gn=je("statebot.");function qn(t){let e=Gn("decomposeRoute",{templateLiteral:fe},t);if(e)throw TypeError(e);let n=Yn(t);return Wn(n).flat(2)}function Ue(t){let e=Gn("decomposeChart",{chart:fe},t);if(e)throw TypeError(e);let n=Yn(t),i=Wn(n),d=i.map(Vr).flat(1).map(Xr).flat(1),y=!1,h=d.map(c=>(c.includes("")&&(y=!0),c.join(Wt))),v=Pn(h),m=Pn(i.flat(3));return{transitions:v.map(c=>c.split(Wt)),routes:v,states:y?m:m.filter(Boolean)}}function Qr(t){return[t].flat().reduce((e,n)=>[...e,...n.split(Yr)],[])}function Yn(t){let e=Qr(t),n=[],i=!1,f=(y,h)=>{let v=h.replace(Jr,"").replace(Zr,"");return v?(i=qr.test(v),i?y+v:(n.push(y+v),"")):y},d=e.reduce(f,"");return i||d?[...n,d]:[...n]}function Wn(t){return t.map(e=>e.split(Wt).map(n=>n.split(Kn)))}function Vr(t){let e=[];return t.reduce((n,i)=>n===!1?[...i]:(e.push([n,[...i]]),[...i]),!1),e}function Xr([t,e]){return t.reduce((n,i)=>[...n,...e.map(f=>[i,f])],[])}var Zn="onExiting",Jn="onEntering",Vn="onExited",Xn="onEntered",qt="onSwitching",Zt="onSwitched",Jt={[qt]:"(ANY)state:changing",[Zt]:"(ANY)state:changed"};function ei(t,e){if(!wt(t))throw new TypeError(`
Statebot: Please specify a name for this machine`);let n=`Statebot[${t}]`;if(!Nt(e))throw new TypeError(`
${n}: Please specify options for this machine`);let{chart:i=void 0,logLevel:f=3,historyLimit:d=2}=e||{},y=e.events===void 0?De(Dn()):Dr(e.events)&&De(e.events);if(!y)throw new TypeError(`
${n}: Invalid event-emitter specified in options`);let{states:h=[],routes:v=[]}=i?Ue(i):e,{startIn:m=h[0]}=e;if(!h.includes(m))throw new Error(`${n}: Starting-state not in chart: "${m}"`);let c=je(`${n}#`),E=Hn(f,console),{canWarn:S}=E,b=[m],R=Math.max(d,2),M=0,{pause:x,resume:w,paused:g,Pausable:s}=Gr(!1,()=>E.warn(`${n}: Ignoring callback, paused`)),o=De(Dn()),l=s(o.emit);function u(N,I){return o.on(N,I),()=>o.off(N,I)}let L=ze(t,"states","Listening for the following state-changes",[...h]),O=ze(t,"transitions","Listening for the following transitions",[...v]),D=ze(t,"events","Listening for the following events");function z(N,I){let j=Tt(N)?N({enter:rt,emit:G,Enter:st,Emit:ot}):Nt(N)?N:null;if(!Nt(j))throw new TypeError(`Statebot[${t}]#${I}(): Expected an object, or a function that returns an object`);let V=[],U=[],{transitionsForEvents:A,transitionsOnly:X}=ti(j),lt=Object.entries(A).reduce(St,{}),ht=Qn(X,S),xt=Object.entries(lt).map(a).concat(ht.configs.map(It)).flat();if(S()){V.push(...ht.states),U.push(...ht.routes);let p=V.filter(T=>!h.includes(T)),_=U.filter(T=>!v.includes(T));p.length&&E.warn(`Statebot[${t}]#${I}(): Invalid states specified:
`+p.map(T=>`  > "${T}"`).join(`
`)),_.length&&E.warn(`Statebot[${t}]#${I}(): Invalid transitions specified:
`+_.map(T=>`  > "${T}"`).join(`
`))}return()=>xt.map(p=>p());function It(p){let{fromState:_,toState:T,action:$}=p,B=`${_}->${T}`;return[O.increase(B),u(B,$)]}function St(p,[_,T]){let{states:$,routes:B,configs:et}=Qn(T,S);return S()&&(V.push(...$),U.push(...B)),{...p,[_]:et}}function r({fromState:p,toState:_,action:T,args:$}){return q(p,()=>(rt(_,...$),Tt(T)&&T(...$),!0))}function a([p,_]){return[D.increase(p),ut(p,(...T)=>{_.map(B=>({...B,args:T})).some(r)||P(`Event not handled: "${p}"`)})]}}function Z(){return b[b.length-2]}function K(){return b[b.length-1]}function tt(...N){let I=N.flat(),j=c("canTransitionTo",{state:wt},I[0]);if(j)throw new TypeError(j);if(!I.length)return!1;let V=Q();return I.every(U=>V.includes(U))}function Q(N){let I=N!==void 0?N:K(),j=c("statesAvailableFromHere",{state:wt},I);if(j)throw new TypeError(j);return v.reduce((V,U)=>{let[A,X]=U.split(Wt).map(lt=>lt.trim());return A===I?[...V,X]:V},[])}function J(N,I,...j){let V=K()===N;return I===void 0?V:V?Tt(I)?I(...j):I:null}function W(N,...I){let j=Object.entries(N).find(([V])=>J(V));return j?J(...j.concat(I)):null}function q(...N){let I=c("inState",{state:[wt,Nt]},N[0]);if(I)throw new TypeError(I);return Nt(N[0])?W(...N):J(...N)}let G=s((N,...I)=>{let j=c("emit",{eventName:wt},N);if(j)throw new TypeError(j);return y.emit(N,...I)}),rt=s((N,...I)=>{let j=c("enter",{state:wt},N);if(j)throw new TypeError(j);let V=K(),U=N;if(U===V)return P(`Already in state: "${U}"`),!1;if(!h.includes(U))return P(`Invalid state "${U}", not switching`),!1;let A=`${V}->${U}`;return v.includes(A)?(E.info(`${n}: tId<${++M}>: ${A}`),b.push(U),b.length>R&&b.shift(),l(Jt[qt],U,V,...I),l(A,...I),l(Jt[Zt],U,V,...I),!0):(P(`Invalid transition "${A}", not switching`),!1)});function ut(N,I){let j=c("onEvent",{eventName:wt,cb:Tt},N,I);if(j)throw new TypeError(j);return y.on(N,I),()=>y.off(N,I)}let nt=Object.keys(Jt).reduce((N,I)=>({...N,[I]:j=>{let V=c(I,{cb:Tt},j);if(V)throw new TypeError(V);let U=L.increase(Jt[I]),A=u(Jt[I],j);return()=>{A(),U()}}}),{}),it=[[Zn,qt],[Jn,qt],[Vn,Zt],[Xn,Zt]].reduce((N,I)=>{let[j,V]=I,U=j.slice(2),A=U.toLowerCase();return{...N,[j]:(X,lt)=>{let ht=c(j,{state:wt,cb:Tt},X,lt);if(ht)throw new TypeError(ht);let xt=[L.increase(X),L.increase(`${X}:${A}`)],It=nt[V]((St,r,...a)=>{U.indexOf("Exit")===0?X===r&&lt(St,...a):X===St&&lt(r,...a)});return()=>{It(),xt.map(St=>St())}}}},{});function ot(N,...I){let j=c("Emit",{eventName:wt},N);if(j)throw new TypeError(j);return(...V)=>G(N,...I,...V)}function st(N,...I){let j=c("Enter",{state:wt},N);if(j)throw new TypeError(j);return(...V)=>rt(N,...I,...V)}function ct(N,I,...j){return(...V)=>q(N,I,...j,...V)}function F(N,...I){return(...j)=>q(N,...I,...j)}function C(...N){let I=c("InState",{state:[wt,Nt]},N[0]);if(I)throw new TypeError(I);return Nt(N[0])?F(...N):ct(...N)}function k(){E.warn(`${n}: State-machine reset!`),b.length=0,b.push(m)}function P(N){let I=Z(),j=K(),V=`${I===void 0?"[undefined]":I}->${j}`,U=Q();U.length?E.info(`${n}: ${N}
  > Previous transition: "${V}"
  > From "${j}", valid states are: [${U.map(A=>`"${A}"`).join(", ")}]`):E.info(`${n}: ${N}
  > Previous transition: "${V}"
  > There are no states available from "${j}"`)}function Y(){return{states:L.refs(),transitions:O.refs(),events:D.refs()}}function at(){E.log(`${n}: Information about this state-machine`),pt(L),pt(O),pt(D)}function pt(N){let{description:I,table:j}=N.toValue();E.log(I),j.length?E.table(j):E.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:tt,currentState:K,emit:G,Emit:ot,enter:rt,Enter:st,history:()=>[...b],info:()=>at(),inspect:()=>Y(),inState:q,InState:C,name:()=>t,onEntered:it[Xn],onEntering:it[Jn],onEvent:ut,onExited:it[Vn],onExiting:it[Zn],onSwitched:nt[Zt],onSwitching:nt[qt],onTransitions:N=>z(N,"onTransitions"),pause:x,paused:g,performTransitions:N=>z(N,"performTransitions"),previousState:Z,reset:k,resume:w,statesAvailableFromHere:Q}}function ti(t){let e={},n=[];return Object.entries(t).map(([i,f])=>{if(Tt(f)){n.push({routeChart:i,action:f});return}if(!Nt(f))return;let{on:d,then:y}=f;if(wt(d)||Un(d)){[d].flat().map(m=>{e[m]=e[m]||[],e[m].push({routeChart:i,action:y})});return}Tt(y)&&n.push({routeChart:i,action:f})}),{transitionsForEvents:e,transitionsOnly:n}}function Qn(t,e){let n=[],i=[];return{configs:t.reduce((d,y)=>{let{routeChart:h,action:v}=y,{states:m,routes:c,transitions:E}=Ue(h);return e()&&(n.push(...m),i.push(...c)),[...d,...E.map(([S,b])=>({fromState:S,toState:b,action:v}))]},[]),states:n,routes:i}}function Pe(t){return Nt(t)&&typeof t.__STATEBOT__=="number"}var tr=je("statebot.");function ni(t,e){let n=tr("routeIsPossible",{machine:Pe,route:fe},t,e);if(n)throw TypeError(n);let i=qn(e);return i.every((f,d)=>{if(d===i.length-1)return!0;{let y=i[d+1];return t.statesAvailableFromHere(f).includes(y)}})}var er=0;function ii(t,e,n){let i=tr("assertRoute",{machine:Pe,expectedRoute:fe},t,e);if(i)throw TypeError(i);er+=1;let{description:f="Assertion complete",fromState:d="",run:y=()=>{},permittedDeviations:h=0,timeoutInMs:v=1e3,logLevel:m=3}=n||{},c=Hn(m),E=`Statebot[${t.name()}]: aId<${er}>`,S=qn(e);c.log(`
${E}: Asserting route: [${S.join(" > ")}]`),c.log(`${E}: > Assertion will start from state: "${d}"`);let b=Hr(y),R=()=>{},M=Be(),x=Be(),w,g=0,s=!0,o=!1,l=[...S],u=ri(["state","expected","info","took"],["center","center","left","right"]),L=Kr(z=>(O("","","","TOTAL: "+M()),u.lock(),c.log(`
${E}: ${f}: [${z?"FAILED":"SUCCESS"}]`),c.table(u.content()),z)),{addRow:O}=u;function D(z){if(s)O(z,"-","PENDING");else{let Z=l[0];Z===z?(O(z,Z,o?"REALIGNED":"OKAY",x()),o=!1,l.shift()):(O(z,Z,"WRONG STATE",x()),o=!0,g+=1),x=Be()}}return new Promise((z,Z)=>{if(l.length===0){Z(L(new Error("NO ROUTE TO TEST")));return}let K=(...G)=>{clearTimeout(w),R(),q(),z(...G)},tt=G=>{clearTimeout(w),R(),q(),Z(G)},Q=G=>{for(;l.length;){let rt=l.shift();O(t.currentState(),`(${rt})`,G),o=!1}tt(L(new Error(G)))};t.inState(d)&&(s=!1,R=b());let{revoke:J,fn:W}=Bn(G=>{w=setTimeout(()=>{J(),Q("TIMEOUT")},v),D(G),s&&G===d&&(s=!1,R=b()),g>h&&(J(),Q("TOO MANY DEVIATIONS")),l.length<=0&&(J(),K(L()))}),q=t.onSwitching(W)})}function ri(t,e){t=t||[],e=e||[];let n=[],i=t.map((m,c)=>e[c]||"center"),f=!1;function d(){f=!0}function y(...m){if(f)return;let c=t.reduce((E,S,b)=>{let R=m[b]||"";return{...E,[S]:R}},{});n.push(c)}function h(){return n.reduce((m,c)=>t.map((E,S)=>Math.max(c[E].length,m[S])),t.map(()=>0))}function v(){let m=h();function c(S,b){let R=m[b],M=i[b];return M==="left"?S.padEnd(R):M==="right"?S.padStart(R):S}return n.reduce((S,b)=>{let R=t.reduce((M,x,w)=>({...M,[x]:c(b[x],w)}),{});return[...S,R]},[])}return{lock:d,addRow:y,content:v}}function Be(){let t=Date.now();function e(n,i){return n.toFixed(i).replace(/\.0+$/,"")}return function(){let n=Date.now()-t;return n<500?`${e(n)} ms`:n<5e3?`${e(n/1e3,2)} s `:n<6e4?`${e(n/1e3,1)} s `:`${e(n/1e3/60,1)} m `}}Ft.Statebot=ei;Ft.assertRoute=ii;Ft.decomposeChart=Ue;Ft.isStatebot=Pe;Ft.routeIsPossible=ni});var rr=jt((vi,He)=>{"use strict";typeof process!="undefined"?He.exports=jn():He.exports=nr()});var ar=Xt(Qe()),ur=Xt(tn());var en={},we=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},nn=function(t){return new Worker(t)};try{URL.revokeObjectURL(we(""))}catch(t){we=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},nn=function(e){return new Worker(e,{type:"module"})}}var mr=function(t,e,n,i,f){var d=nn(en[e]||(en[e]=we(t)));return d.onerror=function(y){return f(y.error,null)},d.onmessage=function(y){return f(null,y.data)},d.postMessage(n,i),d},dt=Uint8Array,yt=Uint16Array,Mt=Uint32Array,te=new dt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ee=new dt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_e=new dt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rn=function(t,e){for(var n=new yt(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];for(var f=new Mt(n[30]),i=1;i<30;++i)for(var d=n[i];d<n[i+1];++d)f[d]=d-n[i]<<5|i;return[n,f]},on=rn(te,2),wr=on[0],ne=on[1];wr[28]=258,ne[258]=28;var sn=rn(ee,0),li=sn[0],Ee=sn[1],re=new yt(32768);for(var ft=0;ft<32768;++ft)Rt=(ft&43690)>>>1|(ft&21845)<<1,Rt=(Rt&52428)>>>2|(Rt&13107)<<2,Rt=(Rt&61680)>>>4|(Rt&3855)<<4,re[ft]=((Rt&65280)>>>8|(Rt&255)<<8)>>>1;var Rt,Dt=function(t,e,n){for(var i=t.length,f=0,d=new yt(e);f<i;++f)++d[t[f]-1];var y=new yt(e);for(f=0;f<e;++f)y[f]=y[f-1]+d[f-1]<<1;var h;if(n){h=new yt(1<<e);var v=15-e;for(f=0;f<i;++f)if(t[f])for(var m=f<<4|t[f],c=e-t[f],E=y[t[f]-1]++<<c,S=E|(1<<c)-1;E<=S;++E)h[re[E]>>>v]=m}else for(h=new yt(i),f=0;f<i;++f)t[f]&&(h[f]=re[y[t[f]-1]++]>>>15-t[f]);return h},Ct=new dt(288);for(var ft=0;ft<144;++ft)Ct[ft]=8;for(var ft=144;ft<256;++ft)Ct[ft]=9;for(var ft=256;ft<280;++ft)Ct[ft]=7;for(var ft=280;ft<288;++ft)Ct[ft]=8;var Pt=new dt(32);for(var ft=0;ft<32;++ft)Pt[ft]=5;var an=Dt(Ct,9,0);var un=Dt(Pt,5,0);var Te=function(t){return(t/8|0)+(t&7&&1)},Se=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var i=new(t instanceof yt?yt:t instanceof Mt?Mt:dt)(n-e);return i.set(t.subarray(e,n)),i};var Ot=function(t,e,n){n<<=e&7;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8},zt=function(t,e,n){n<<=e&7;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8,t[i+2]|=n>>>16},se=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var f=n.length,d=n.slice();if(!f)return[oe,0];if(f==1){var y=new dt(n[0].s+1);return y[n[0].s]=1,[y,1]}n.sort(function(l,u){return l.f-u.f}),n.push({s:-1,f:25001});var h=n[0],v=n[1],m=0,c=1,E=2;for(n[0]={s:-1,f:h.f+v.f,l:h,r:v};c!=f-1;)h=n[n[m].f<n[E].f?m++:E++],v=n[m!=c&&n[m].f<n[E].f?m++:E++],n[c++]={s:-1,f:h.f+v.f,l:h,r:v};for(var S=d[0].s,i=1;i<f;++i)d[i].s>S&&(S=d[i].s);var b=new yt(S+1),R=ie(n[c-1],b,0);if(R>e){var i=0,M=0,x=R-e,w=1<<x;for(d.sort(function(u,L){return b[L.s]-b[u.s]||u.f-L.f});i<f;++i){var g=d[i].s;if(b[g]>e)M+=w-(1<<R-b[g]),b[g]=e;else break}for(M>>>=x;M>0;){var s=d[i].s;b[s]<e?M-=1<<e-b[s]++-1:++i}for(;i>=0&&M;--i){var o=d[i].s;b[o]==e&&(--b[o],++M)}R=e}return[new dt(b),R]},ie=function(t,e,n){return t.s==-1?Math.max(ie(t.l,e,n+1),ie(t.r,e,n+1)):e[t.s]=n},xe=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new yt(++e),i=0,f=t[0],d=1,y=function(v){n[i++]=v},h=1;h<=e;++h)if(t[h]==f&&h!=e)++d;else{if(!f&&d>2){for(;d>138;d-=138)y(32754);d>2&&(y(d>10?d-11<<5|28690:d-3<<5|12305),d=0)}else if(d>3){for(y(f),--d;d>6;d-=6)y(8304);d>2&&(y(d-3<<5|8208),d=0)}for(;d--;)y(f);d=1,f=t[h]}return[n.subarray(0,i),e]},Ut=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},Bt=function(t,e,n){var i=n.length,f=Te(e+2);t[f]=i&255,t[f+1]=i>>>8,t[f+2]=t[f]^255,t[f+3]=t[f+1]^255;for(var d=0;d<i;++d)t[f+d+4]=n[d];return(f+4+i)*8},Ae=function(t,e,n,i,f,d,y,h,v,m,c){Ot(e,c++,n),++f[256];for(var E=se(f,15),S=E[0],b=E[1],R=se(d,15),M=R[0],x=R[1],w=xe(S),g=w[0],s=w[1],o=xe(M),l=o[0],u=o[1],L=new yt(19),O=0;O<g.length;++O)L[g[O]&31]++;for(var O=0;O<l.length;++O)L[l[O]&31]++;for(var D=se(L,7),z=D[0],Z=D[1],K=19;K>4&&!z[_e[K-1]];--K);var tt=m+5<<3,Q=Ut(f,Ct)+Ut(d,Pt)+y,J=Ut(f,S)+Ut(d,M)+y+14+3*K+Ut(L,z)+(2*L[16]+3*L[17]+7*L[18]);if(tt<=Q&&tt<=J)return Bt(e,c,t.subarray(v,v+m));var W,q,G,rt;if(Ot(e,c,1+(J<Q)),c+=2,J<Q){W=Dt(S,b,0),q=S,G=Dt(M,x,0),rt=M;var ut=Dt(z,Z,0);Ot(e,c,s-257),Ot(e,c+5,u-1),Ot(e,c+10,K-4),c+=14;for(var O=0;O<K;++O)Ot(e,c+3*O,z[_e[O]]);c+=3*K;for(var nt=[g,l],it=0;it<2;++it)for(var ot=nt[it],O=0;O<ot.length;++O){var st=ot[O]&31;Ot(e,c,ut[st]),c+=z[st],st>15&&(Ot(e,c,ot[O]>>>5&127),c+=ot[O]>>>12)}}else W=an,q=Ct,G=un,rt=Pt;for(var O=0;O<h;++O)if(i[O]>255){var st=i[O]>>>18&31;zt(e,c,W[st+257]),c+=q[st+257],st>7&&(Ot(e,c,i[O]>>>23&31),c+=te[st]);var ct=i[O]&31;zt(e,c,G[ct]),c+=rt[ct],ct>3&&(zt(e,c,i[O]>>>5&8191),c+=ee[ct])}else zt(e,c,W[i[O]]),c+=q[i[O]];return zt(e,c,W[256]),c+q[256]},cn=new Mt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),oe=new dt(0),fn=function(t,e,n,i,f,d){var y=t.length,h=new dt(i+y+5*(1+Math.ceil(y/7e3))+f),v=h.subarray(i,h.length-f),m=0;if(!e||y<8)for(var c=0;c<=y;c+=65535){var E=c+65535;E<y?m=Bt(v,m,t.subarray(c,E)):(v[c]=d,m=Bt(v,m,t.subarray(c,y)))}else{for(var S=cn[e-1],b=S>>>13,R=S&8191,M=(1<<n)-1,x=new yt(32768),w=new yt(M+1),g=Math.ceil(n/3),s=2*g,o=function(I){return(t[I]^t[I+1]<<g^t[I+2]<<s)&M},l=new Mt(25e3),u=new yt(288),L=new yt(32),O=0,D=0,c=0,z=0,Z=0,K=0;c<y;++c){var tt=o(c),Q=c&32767,J=w[tt];if(x[Q]=J,w[tt]=Q,Z<=c){var W=y-c;if((O>7e3||z>24576)&&W>423){m=Ae(t,v,0,l,u,L,D,z,K,c-K,m),z=O=D=0,K=c;for(var q=0;q<286;++q)u[q]=0;for(var q=0;q<30;++q)L[q]=0}var G=2,rt=0,ut=R,nt=Q-J&32767;if(W>2&&tt==o(c-nt))for(var it=Math.min(b,W)-1,ot=Math.min(32767,c),st=Math.min(258,W);nt<=ot&&--ut&&Q!=J;){if(t[c+G]==t[c+G-nt]){for(var ct=0;ct<st&&t[c+ct]==t[c+ct-nt];++ct);if(ct>G){if(G=ct,rt=nt,ct>it)break;for(var F=Math.min(nt,ct-2),C=0,q=0;q<F;++q){var k=c-nt+q+32768&32767,P=x[k],Y=k-P+32768&32767;Y>C&&(C=Y,J=k)}}}Q=J,J=x[Q],nt+=Q-J+32768&32767}if(rt){l[z++]=268435456|ne[G]<<18|Ee[rt];var at=ne[G]&31,pt=Ee[rt]&31;D+=te[at]+ee[pt],++u[257+at],++L[pt],Z=c+G,++O}else l[z++]=t[c],++u[t[c]]}}m=Ae(t,v,d,l,u,L,D,z,K,c-K,m),!d&&m&7&&(m=Bt(v,m+1,oe))}return Se(h,0,i+Te(m)+f)},_r=function(){for(var t=new Mt(256),e=0;e<256;++e){for(var n=e,i=9;--i;)n=(n&1&&3988292384)^n>>>1;t[e]=n}return t}(),Er=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=_r[n&255^e[i]]^n>>>8;t=n},d:function(){return~t}}};var ln=function(t,e,n,i,f){return fn(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,n,i,!f)},Oe=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},hn=function(t,e,n){for(var i=t(),f=t.toString(),d=f.slice(f.indexOf("[")+1,f.lastIndexOf("]")).replace(/ /g,"").split(","),y=0;y<i.length;++y){var h=i[y],v=d[y];if(typeof h=="function"){e+=";"+v+"=";var m=h.toString();if(h.prototype)if(m.indexOf("[native code]")!=-1){var c=m.indexOf(" ",8)+1;e+=m.slice(c,m.indexOf("(",c))}else{e+=m;for(var E in h.prototype)e+=";"+v+".prototype."+E+"="+h.prototype[E].toString()}else e+=m}else n[v]=h}return[e,n]},ae=[],Tr=function(t){var e=[];for(var n in t)(t[n]instanceof dt||t[n]instanceof yt||t[n]instanceof Mt)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e},Sr=function(t,e,n,i){var f;if(!ae[n]){for(var d="",y={},h=t.length-1,v=0;v<h;++v)f=hn(t[v],d,y),d=f[0],y=f[1];ae[n]=hn(t[h],d,y)}var m=Oe({},ae[n][1]);return mr(ae[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,m,Tr(m),i)};var xr=function(){return[dt,yt,Mt,te,ee,_e,ne,Ee,an,Ct,un,Pt,re,cn,oe,Dt,Ot,zt,se,ie,xe,Ut,Bt,Ae,Te,Se,fn,ln,$e,pn]};var pn=function(t){return postMessage(t,[t.buffer])};var Ar=function(t,e,n,i,f,d){var y=Sr(n,i,f,function(h,v){y.terminate(),d(h,v)});return y.postMessage([t,e],e.consume?[t.buffer]:[]),function(){y.terminate()}};var gt=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function Or(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Ar(t,e,[xr],function(i){return pn($e(i.data[0],i.data[1]))},0,n)}function $e(t,e){return ln(t,e||{},0,0)}var vn=function(t,e,n,i){for(var f in t){var d=t[f],y=e+f;d instanceof dt?n[y]=[d,i]:Array.isArray(d)?n[y]=[d[0],Oe(i,d[1])]:vn(d,y+"/",n,i)}},dn=typeof TextEncoder!="undefined"&&new TextEncoder,$r=typeof TextDecoder!="undefined"&&new TextDecoder,Rr=0;try{$r.decode(oe,{stream:!0}),Rr=1}catch(t){}function ue(t,e){if(e){for(var n=new dt(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(dn)return dn.encode(t);for(var f=t.length,d=new dt(t.length+(t.length>>1)),y=0,h=function(c){d[y++]=c},i=0;i<f;++i){if(y+5>d.length){var v=new dt(y+8+(f-i<<1));v.set(d),d=v}var m=t.charCodeAt(i);m<128||e?h(m):m<2048?(h(192|m>>6),h(128|m&63)):m>55295&&m<57344?(m=65536+(m&1023<<10)|t.charCodeAt(++i)&1023,h(240|m>>18),h(128|m>>12&63),h(128|m>>6&63),h(128|m&63)):(h(224|m>>12),h(128|m>>6&63),h(128|m&63))}return Se(d,0,y)}var Re=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;if(i>65535)throw"extra field too long";e+=i+4}return e},yn=function(t,e,n,i,f,d,y,h){var v=i.length,m=n.extra,c=h&&h.length,E=Re(m);gt(t,e,y!=null?33639248:67324752),e+=4,y!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(d==null&&8),t[e++]=f&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var S=new Date(n.mtime==null?Date.now():n.mtime),b=S.getFullYear()-1980;if(b<0||b>119)throw"date not in range 1980-2099";if(gt(t,e,b<<25|S.getMonth()+1<<21|S.getDate()<<16|S.getHours()<<11|S.getMinutes()<<5|S.getSeconds()>>>1),e+=4,d!=null&&(gt(t,e,n.crc),gt(t,e+4,d),gt(t,e+8,n.size)),gt(t,e+12,v),gt(t,e+14,E),e+=16,y!=null&&(gt(t,e,c),gt(t,e+6,n.attrs),gt(t,e+10,y),e+=14),t.set(i,e),e+=v,E)for(var R in m){var M=m[R],x=M.length;gt(t,e,+R),gt(t,e+2,x),t.set(M,e+4),e+=4+x}return c&&(t.set(h,e),e+=c),e},br=function(t,e,n,i,f){gt(t,e,101010256),gt(t,e+8,n),gt(t,e+10,n),gt(t,e+12,i),gt(t,e+16,f)};function gn(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";var i={};vn(t,"",i,e);var f=Object.keys(i),d=f.length,y=0,h=0,v=d,m=new Array(d),c=[],E=function(){for(var M=0;M<c.length;++M)c[M]()},S=function(){var M=new dt(h+22),x=y,w=h-y;h=0;for(var g=0;g<v;++g){var s=m[g];try{var o=s.c.length;yn(M,h,s,s.f,s.u,o);var l=30+s.f.length+Re(s.extra),u=h+l;M.set(s.c,u),yn(M,y,s,s.f,s.u,o,h,s.m),y+=16+l+(s.m?s.m.length:0),h=u+o}catch(L){return n(L,null)}}br(M,y,m.length,w,x),n(null,M)};d||S();for(var b=function(M){var x=f[M],w=i[x],g=w[0],s=w[1],o=Er(),l=g.length;o.p(g);var u=ue(x),L=u.length,O=s.comment,D=O&&ue(O),z=D&&D.length,Z=Re(s.extra),K=s.level==0?0:8,tt=function(Q,J){if(Q)E(),n(Q,null);else{var W=J.length;m[M]=Oe(s,{size:l,crc:o.d(),c:J,f:u,m:D,u:L!=x.length||D&&O.length!=z,compression:K}),y+=30+L+Z+W,h+=76+2*(L+Z)+(z||0)+W,--d||S()}};if(L>65535&&tt("filename too long",null),!K)tt(null,g);else if(l<16e4)try{tt(null,$e(g,s))}catch(Q){tt(Q,null)}else c.push(Or(g,s,tt))},R=0;R<v;++R)b(R);return E}var cr=Xt(mn()),Ke=Xt(rr());(function(){if(typeof window.CustomEvent=="function")return!1;function t(e,n){n=n||{bubbles:!1,cancelable:!1,detail:null};let i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),i}window.CustomEvent=t})();var le=function(){let t;try{t=window}catch(v){t=self}let e="message-bus",n=new Map;function i(v,...m){let c={eventName:v,args:m,timestamp:Date.now()},E=new CustomEvent(e,{detail:c});t.dispatchEvent(E)}function f(v,m){if(typeof m!="function")throw new TypeError("Callback is not a function");let c=n.has(v)?n.get(v):n.set(v,new Map).get(v);if(c.has(m))throw new Error("Callback already deals with this event");let E=typeof v=="string"&&v.indexOf("*")===-1,S=typeof v=="string"?y(v):v instanceof RegExp?v:null;if(S===null){let R="Could not figure-out eventNameOrPattern";throw new Error(`${R} = ${v}`)}let b=R=>{let{eventName:M,args:x}=R.detail;S.test(M)&&(E?m(...x):m(M,...x))};return c.set(m,b),t.addEventListener(e,b),()=>d(v,m)}function d(v,m){if(typeof m!="function")throw new TypeError("Callback is not a function");if(!n.has(v))throw new Error("No event-listener for that name/pattern");let c=n.get(v);if(!c.has(m))throw new Error("Event callback not found for name/pattern");let E=c.get(m);t.removeEventListener(e,E),c.delete(m)}function y(v){if(!v.length)throw new Error("String should not be empty");let m=v.split("*").map(E=>E.trim()).map(h),c=m.join(".*");return m.length===1?c=`^${c}$`:(m[0]!==""&&(c=`^${c}`),m[m.length-1]!==""&&(c=`${c}$`)),new RegExp(c)}function h(v){return v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return{emit:i,on:f,off:d}}();var ir=function(){oi();function t(e,n){let{rx:i,cb:f}=n;if(typeof f!="function")throw TypeError("Callback is not a function");window.addEventListener(e,d=>{let y=d.detail,h=y.url,v=!0;i instanceof RegExp?v=i.test(h):typeof i=="string"&&(v=i.indexOf(h)!==-1),v&&f(y)})}return function(e){let{name:n,description:i,rx:f,onBeforeOpen:d,onBeforeSend:y,onFullResponse:h}=e||{};console.info(`AjaxListener[${n}]: ${i}`),typeof d=="function"&&t("ajax:onBeforeOpen",{rx:f,cb:d}),typeof y=="function"&&t("ajax:onBeforeSend",{rx:f,cb:y}),typeof h=="function"&&t("ajax:onFullResponse",{rx:f,cb:h})}}();function or(t){let{name:e,description:n,method:i,url:f,setHeaders:d,setPayload:y}=t,h=(i||"get").toUpperCase(),v=(...E)=>{let S;return typeof y=="function"?S=y(...E):S=y,S||""},m=(...E)=>{let S;return typeof d=="function"?S=d(...E):S=d,S||{}};return(...E)=>{console.info(`AjaxRequester[${e}]: ${n}`);let S=m(...E),b=new XMLHttpRequest;b.open(h,f),Object.keys(S).forEach(R=>{let M=S[R];R&&M&&b.setRequestHeader(R,M)}),b.send(v(...E))}}function oi(){function t(y,h){let v=new CustomEvent(y,{detail:h});window.dispatchEvent(v)}let e=window.XMLHttpRequest.prototype.open,n=window.XMLHttpRequest.prototype.send;function i(y,h,v=!0,m,c){return this._options={method:y,url:h,async:v,user:m,password:c,xhr:this},t("ajax:onBeforeOpen",this._options),e.apply(this,arguments)}function f(y){return this._options.data=y,this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=d,t("ajax:onBeforeSend",this._options),n.apply(this,arguments)}function d(){if(this.readyState===4&&(this._options.status=this.status,this._options.responseText=this.responseText,t("ajax:onFullResponse",this._options)),this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)}window.XMLHttpRequest.prototype.open=i,window.XMLHttpRequest.prototype.send=f,console.log("attachAjaxEventRepeater")}var sr={FIRST_RUN:"first-run",STORE_HYDRATED:"ui/store-hydrated",STORE_UPDATED:"ui/store-updated",ui:{RENDERING:"ui/rendering",RENDERED:"ui/rendered",TOGGLE_OPEN:"ui/toggle-open",FIND_ACCOUNTS:"ui/find-accounts",FIND_STATEMENTS:"ui/find-statements",VIEW_STATEMENTS:"ui/view-statements",DOWNLOAD_STATEMENTS:"ui/download-statements",DOWNLOADED_STATEMENTS:"ui/downloaded-statements",UPDATE_PROGRESS_BAR:"ui/update-progress-bar",STATEMENTS_WINDOW_READY:"ui/statements-window-ready",STATEMENTS_WINDOW_CLOSED:"ui/statements-window-closed",CLOSE_STATEMENTS_WINDOW:"ui/close-statements-window",CHANGE_STATEMENT:"ui/change-statement"},get:{ACCOUNTS:"get/accounts",STATEMENTS:"get/statements",ENTRIES:"get/entries"},error:{ACCOUNTS:"error/accounts",STATEMENTS:"error/statements",ENTRIES:"error/entries"},got:{ACCOUNTS:"got/accounts",STATEMENTS:"got/statements",ENTRIES:"got/entries"},add:{ACCOUNTS:"add/accounts",STATEMENTS:"add/statements",ENTRIES:"add/entries"},update:{ACCOUNTS:"update/accounts",STATEMENTS:"update/statements",ENTRIES:"update/entries"}};le.on(sr.ui.RENDERING,t=>{t.Fragment={view:function(e){return e.children}}});var si=`

  // Happy path
  //
    [idle] -> getting-accounts ->
    [found-accounts] -> getting-statements ->
    [found-statements] -> getting-entries ->
    [found-entries]

  // Downloading Zip
  //
    found-entries -> [download-all] -> found-entries

  // Failures
  //
    (getting-accounts -> failed-accounts -> idle)
    (getting-statements -> failed-statements -> found-accounts)
    (getting-entries -> failed-entries -> found-statements)

`;ai(window.obis);function ai(t){t.deps={addAjaxListener:ir,AjaxRequester:or,fflate:{zip:gn,strToU8:ue},jmespath:ur.default,messages:le,saveAs:cr.saveAs,SparkMD5:ar.default,Statebot:Ke.Statebot},t.fetchMachine=(0,Ke.Statebot)("fetcher",{events:le,startIn:"idle",chart:si,logLevel:2});let{rootPath:e}=t,n=[`${e}/plugins.js`],i=[`${e}/ui.css`,`${e}/ui.js`];t.loadPlugin=y=>{t.plugin=y(),n.push(...i)},t.registerPlugins=y=>{y.find(f)||console.error("No plugin detected. Nothing to do.")};function f(y){let{name:h,description:v,urls:m}=y;if(m.some(E=>location.href.includes(E)))return console.log("Detected "+v+": Adding plugin"),n.push(`${e}/plugins/${h}.js`),!0}t.loadStyle=(y,h)=>{let v=document.createElement("link");v.href=y,v.rel="stylesheet",v.type="text/css",console.log("Loading: "+y),h instanceof Function&&(v.onload=()=>h(y,!0),v.onerror=()=>h(y,!1)),document.getElementsByTagName("head")[0].appendChild(v)};let d=()=>{if(!n.length){console.log("Done loading scripts");return}let y=n.shift();/\.css$/.test(y)?t.loadStyle(y,(h,v)=>{v?d():console.error("Could not load style: "+h)}):t.loadScript(y,(h,v)=>{v?d():console.error("Could not load script: "+h)})};d()}})();
